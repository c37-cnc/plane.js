/*!
 * C37 in 18-05-2014 at 10:19:05 
 *
 * plane version: 1.0.0
 * licensed by Creative Commons Attribution-ShareAlike 3.0
 *
 * Copyright - C37 http://c37.co - 2014
 */
window.Plane=function(){"use strict";function a(a,b,c,d){if(a){Plane.Layers.Create();for(var e=0;b>e;e+=50){Plane.Shape.Create({type:"line",x:[e,0],y:[e,c],strokeColor:d,strokeWidth:.6});for(var f=1;4>=f;f++){var g=Math.round(e+10*f);Plane.Shape.Create({type:"line",x:[g,0],y:[g,c],strokeColor:d,strokeWidth:.3})}}for(var h=0;c+40>h;h+=50){Plane.Shape.Create({type:"line",x:[0,h],y:[b,h],strokeColor:d,strokeWidth:.6});for(var i=1;4>=i;i++){var j=Math.round(h-10*i);Plane.Shape.Create({type:"line",x:[0,j],y:[b,j],strokeColor:d,strokeWidth:.3})}}Plane.Render.Update()}}return{Initialize:function(b){if(null==b||"function"==typeof b)throw new Error("Plane - Initialize - Config is not valid - See the documentation");Plane.Events.Initialize(b),Plane.Render.Initialize(b),Plane.Layers.Initialize(b),Plane.Tools.Initialize(b);var c=Plane.Utility.Object.merge({metricSystem:"mm",backgroundColor:"rgb(255, 255, 255)",gridEnable:!0,gridColor:"rgb(218, 222, 215)"},b.style||{});this.style=c;var d=c.gridEnable,e=c.gridColor,f=b.viewPort.clientWidth,g=b.viewPort.clientHeight;return a(d,f,g,e),!0},set style(a){this._style=a},get style(){return this._style},set zoom(a){this._zoom=a},get zoom(){return this._zoom},set center(a){this._center=a},get center(){return this._center},importJSON:function(){},importSVG:function(){},importDxf:function(){},exportJSON:function(){},exportSVG:function(){},exportDxf:function(){},exportPng:function(){},exportPdf:function(){}}}(window),Plane.Events=function(a,b){"use strict";var c=null;return{Initialize:function(d){if("function"==typeof d||null==d||null==d.viewPort)throw new Error("Events - Initialize - Config is not valid - See the documentation");return c=d.viewPort,b.__proto__=new b.Utility.Event,b.Render.__proto__=new b.Utility.Event,b.Layers.__proto__=new b.Utility.Event,b.Tools.__proto__=new b.Utility.Event,a.onresize=function(a){b.dispatchEvent("onResize",a)},a.onkeydown=function(a){a={type:"onKeyDown",key:a.keyIdentifier.indexOf("+")>-1?String.fromCharCode(a.keyCode):a.keyIdentifier},b.dispatchEvent("onKeyDown",a)},c.onclick=function(a){var d={x:a.clientX,y:a.clientY};d=b.Utility.Graphic.mousePosition(c,d),b.Tools.dispatchEvent("onClick",{type:"onClick",x:d.x,y:d.y})},c.ondblclick=function(a){b.Tools.dispatchEvent("onDblClick",a)},c.onmousedown=function(a){b.Tools.dispatchEvent("onMouseDown",a)},c.onmouseup=function(a){b.Tools.dispatchEvent("onMouseUp",a)},c.onmousemove=function(a){b.Tools.dispatchEvent("onMouseMove",a)},c.onmousewheel=function(a){b.Tools.dispatchEvent("onMouseWheel",a)},c.oncontextmenu=function(a){b.Tools.dispatchEvent("onContextMenu",a)},!0}}}(window,Plane),Plane.Layers=function(a){"use strict";function b(){}var c=null;return b.prototype={set uuid(a){this._uuid=a},get uuid(){return this._uuid},set name(a){return null!=a&&void 0!=a&&""!=a?this._name=a:void 0},get name(){return this._name},set locked(a){this._locked=a},get locked(){return this._locked},set visible(a){this._visible=a},get visible(){return this._visible},set style(a){this._style=a},get style(){return this._style}},{Initialize:function(b){if("function"==typeof b||null==b)throw new Error("Layer - Initialize - Config is not valid - See the documentation");return c=new a.Utility.Dictionary,!0},Create:function(d,e){if(d&&"string"!=typeof d||e&&"object"!=typeof e)throw new Error("Layer - Create - Layer Name is not valid - See the documentation");d=d||"New Layer "+c.count(),e=e||{fillColor:"rgb(255,0,0)",lineCap:"round",lineWidth:10,lineColor:"rgb(255,0,0)"};var f=new b,g=a.Utility.Uuid(9,16);return f.uuid=g,f.name=d,f.style=e,c.add(g,f),this.Active=g,a.Render.Create(g),!0},Remove:function(a){return c.remove(a)},List:function(a){return"function"==typeof a?a.call(this,c.list()):c.list()},get Active(){return this._active},set Active(a){this.dispatchEvent("onDeactive",{type:"onDeactive",layer:this.Active}),this._active=c.find(a),this.dispatchEvent("onActive",{type:"onActive",layer:this.Active})}}}(Plane),Plane.Render=function(a,b){"use strict";var c=null,d=null;return{Initialize:function(e){if("function"==typeof e||null==e)throw new Error("Render - Initialize - Config is not valid - See the documentation");if(!b.createElement("canvas").getContext)throw new Error("No canvas support for this device");return c=e.viewPort,d=new a.Utility.Dictionary,!0},Create:function(e){var f=b.createElement("canvas");f.width=c.clientWidth,f.height=c.clientHeight,f.style.position="absolute",f.style.backgroundColor=0==d.count()?a.style.backgroundColor:"transparent";var g=f.getContext("2d");return g.translate(0,f.height),g.scale(1,-1),c.appendChild(f),d.add(e,f),!0},Update:function(){a.dispatchEvent("onChange",{type:"onChange",now:(new Date).toISOString()});var b=a.Layers.Active.uuid,c=a.Shape.Search(b),e=d.find(b),f=e.getContext("2d");f.clearRect(0,0,e.width,e.height),c.forEach(function(a){switch(f.save(),f.beginPath(),a.type){case"line":f.lineWidth=a.strokeWidth||1,f.strokeStyle=a.strokeColor||"black",f.moveTo(a.x[0],a.x[1]),f.lineTo(a.y[0],a.y[1]);break;case"rectangle":f.lineWidth=a.strokeWidth||1,f.strokeStyle=a.strokeColor||"black",f.strokeRect(a.x,a.y,a.width,a.height);break;case"arc":break;case"circle":f.arc(a.x,a.y,a.radius,0,2*Math.PI,!0),f.closePath();break;case"ellipse":break;case"polygon":if(a.sides<3)throw new Error("shape.sides < 3");var b=2*Math.PI/a.sides;f.translate(a.x,a.y),f.moveTo(a.radius,0);for(var c=1;c<a.sides;c++)f.lineTo(a.radius*Math.cos(b*c),a.radius*Math.sin(b*c));f.closePath()}f.fill(),f.stroke(),f.restore()})}}}(Plane,window.document),Plane.Shape=function(a){"use strict";var b=[];return{Create:function(c){var d=a.Layers.Active.uuid;return b[d]||(b[d]=[]),b[d].push(c),this},Search:function(a){return b[a]},Remove:function(){return this}}}(Plane),Plane.Tools=function(a){"use strict";function b(){}var c=null;return b.prototype={set uuid(a){this._uuid=a},get uuid(){return this._uuid},set name(a){return null!=a&&void 0!=a&&""!=a?this._name=a:void 0},get name(){return this._name},set active(a){(1==a||0==a)&&(this.dispatchEvent(a?"onActive":"onDeactive",{type:a?"onActive":"onDeactive",now:(new Date).toISOString()}),this._active=a)},get active(){return this._active}},{Initialize:function(b){if("function"==typeof b||null==b)throw new Error("Tools - Initialize - Config is not valid - See the documentation");return c=new a.Utility.Dictionary,this.addEventListener("onResize",function(a){c.list().forEach(function(b){b.active&&b.dispatchEvent("onResize",a)})}),this.addEventListener("onKeyPress",function(a){c.list().forEach(function(b){b.active&&b.dispatchEvent("onKeyPress",a)})}),this.addEventListener("onClick",function(a){c.list().forEach(function(b){b.active&&b.dispatchEvent("onClick",a)})}),this.addEventListener("onDblClick",function(a){c.list().forEach(function(b){b.active&&b.dispatchEvent("onClick",a)})}),this.addEventListener("onMouseDown",function(a){c.list().forEach(function(b){b.active&&b.dispatchEvent("onMouseDown",a)})}),this.addEventListener("onMouseUp",function(a){c.list().forEach(function(b){b.active&&b.dispatchEvent("onMouseUp",a)})}),this.addEventListener("onMouseMove",function(a){c.list().forEach(function(b){b.active&&b.dispatchEvent("onMouseMove",a)})}),this.addEventListener("onMouseWheel",function(a){c.list().forEach(function(b){b.active&&b.dispatchEvent("onMouseWheel",a)})}),this.addEventListener("onContextMenu",function(a){c.list().forEach(function(b){b.active&&b.dispatchEvent("onContextMenu",a)})}),!0},Create:function(d){if(d&&"string"!=typeof d)throw new Error("Tools - Create - Layer Name is not valid - See the documentation");d=d||"New Tool "+c.count();var e=new b,f=a.Utility.Uuid(9,16);return e.__proto__.__proto__=new a.Utility.Event,e.uuid=f,e.name=d,e.active=!1,c.add(f,e),e},Remove:function(a){return c.remove(a)},List:function(a){return"function"==typeof a?a.call(this,c.list()):c.list()}}}(Plane),Plane.Utility=function(){"use strict";return{Uuid:function(a,b){var c,d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),e=[];if(b=b||d.length,a)for(c=0;a>c;c++)e[c]=d[0|Math.random()*b];else{var f;for(e[8]=e[13]=e[18]=e[23]="-",e[14]="4",c=0;36>c;c++)e[c]||(f=0|16*Math.random(),e[c]=d[19==c?3&f|8:f])}return e.join("").toLowerCase()},Event:function(){function a(){this.listeners={}}return a.prototype.addEventListener=function(a,b){void 0===this.listeners[a]&&(this.listeners[a]=[]),this.listeners[a].push(b)},a.prototype.dispatchEvent=function(a,b){if(void 0!==this.listeners[a])for(var c in this.listeners[a])this.listeners[a][c].call(this,b)},a.prototype.removeEventListener=function(a,b){if(void 0!==this.listeners[a]){var c=this.listeners[a].indexOf(b);-1!==c&&this.listeners[a].splice(c,1)}},a}(),Dictionary:function(){function a(){this.store=new Array}return a.prototype={add:function(a,b){this.store[a]=b},find:function(a){return this.store[a]},remove:function(a){delete this.store[a]},count:function(){return Object.keys(this.store).length},list:function(){var a=this;return Object.keys(this.store).map(function(b){return a.store[b]})}},a}(),Graphic:{mousePosition:function(a,b){var c=a.getBoundingClientRect(),d=(b.x-c.left)*(a.clientWidth/c.width),e=(b.y-c.top)*(a.clientHeight/c.height);return e=-1*(e-a.clientHeight),{x:d,y:e}}},Object:{merge:function(a,b){if(null==a||null==b)return a;for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}}}}(Plane);