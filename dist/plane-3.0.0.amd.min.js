/*!
 * C37 in 12-01-2015 at 11:09:43 
 *
 * plane version: 3.0.0
 * licensed by Creative Commons Attribution-ShareAlike 3.0
 *
 * Copyright - C37 - http://c37.co - 2015
 */
define("plane/core/group",["require","exports"],function(a,b){function c(){}function d(a){if("function"==typeof a)throw new Error("Tool - create - attrs is not valid \n http://requirejs.org/docs/errors.html#errorCode");return new c}c.prototype={initialize:function(){return!0},contains:function(){return!1},intersect:function(){return!0},toObject:function(){return!0}},b.create=d}),define("plane/core/layer",["require","exports"],function(a,b){function c(a){this.uuid=a.uuid,this.name=a.name,this.status=a.status,this.style=a.style,this.children=a.children,this.events=a.events}function d(a){if("function"==typeof a)throw new Error("layer - create - attrs is not valid \n http://requirejs.org/docs/errors.html#errorCode");var b=h.math.uuid(9,16);a=h.object.merge({uuid:b,name:"Layer ".concat(b),style:{lineCap:"butt",lineJoin:"miter",lineWidth:.7,lineColor:"rgb(0, 0, 0)"},status:"visible",children:h.data.dictionary.create(),events:h.object.event.create()},a);var d=new c(a);return i.add(d.uuid,d),j=d,d}function e(){return i.list()}function f(a){return i.find(a)}function g(a){if(a){var b=null;"string"==h.conversion.toType(a)&&(b=a),"object"==h.conversion.toType(a)&&(b=a.uuid),i.remove(b);var c=i.list().filter(function(a){return"system"!=a.status});return j=c[c.length-1],!0}return i.list().forEach(function(a){"system"!=a.status&&i.remove(a.uuid)}),!0}var h=a("utility"),i=h.data.dictionary.create(),j=null;c.prototype.toObject=function(){return{uuid:this.uuid,name:this.name,status:this.status,style:this.style,children:this.children.list().map(function(a){return a.toObject()})}},Object.defineProperty(b,"active",{get:function(){return j},set:function(a){if(null!=a&&void 0!=a){var b=null;"string"==h.conversion.toType(a)&&(b=a),"object"==h.conversion.toType(a)&&(b=a.uuid),j.uuid!=b&&(j&&"system"!=j.status&&i.find(b)&&"system"!=i.find(b).status&&this.events.notify("onDeactive",{type:"onDeactive",layer:j}),j=i.find(b),j&&"system"!=j.status&&i.find(b)&&"system"!=i.find(b).status&&this.events.notify("onActive",{type:"onActive",layer:j}))}}}),b.events=h.object.event.create(),b.create=d,b.list=e,b.find=f,b.remove=g}),define("plane/core/point",["require","exports"],function(a,b){function c(a,b){this.x=a,this.y=b}function d(){if(2==arguments.length&&null!=arguments[0]&&null!=arguments[1])return new c(arguments[0],arguments[1]);if(1==arguments.length&&"object"==e.conversion.toType(arguments[0])&&null!=arguments[0].x&&null!=arguments[0].y)return new c(arguments[0].x,arguments[0].y);if(1==arguments.length&&"array"==e.conversion.toType(arguments[0])&&2==arguments[0].length)return new c(arguments[0][0],arguments[0][1]);throw new Error("Point - create - attrs is not valid \n http://requirejs.org/docs/errors.html#errorCode")}var e=a("utility");c.prototype={sum:function(a){return new c(this.x+a.x,this.y+a.y)},subtract:function(a){return new c(this.x-a.x,this.y-a.y)},negate:function(){return new c(-this.x,-this.y)},multiply:function(a){return new c(this.x*a,this.y*a)},distanceTo:function(a){var b=this.x-a.x,c=this.y-a.y;return Math.sqrt(b*b+c*c)},midTo:function(a){return new c(this.x+(a.x-this.x)/2,this.y+(a.y-this.y)/2)},angleTo:function(a){return Math.atan2(a.y-this.y,a.x-this.x)},interpolationLinear:function(a,b){return new c(this.x+(a.x-this.x)*b,this.y+(a.y-this.y)*b)},minimum:function(a){return new c(Math.min(this.x,a.x),Math.min(this.y,a.y))},maximum:function(a){return new c(Math.max(this.x,a.x),Math.max(this.y,a.y))},equals:function(a){return this.x==a.x&&this.y==a.y},lessThan:function(a){return this.x<=a.x&&this.y<=a.y},less:function(a){return this.x<a.x&&this.y<a.y},greaterThan:function(a){return this.x>=a.x&&this.y>=a.y},greater:function(a){return this.x>a.x&&this.y>a.y}},b.create=d}),define("plane/core/shape",["require","exports"],function(a,b){function c(a){if("function"==typeof a||null==a)throw new Error("shape - create - attrs is not valid \n http://requirejs.org/docs/errors.html#errorCode");if(-1==["polyline","polygon","rectangle","line","arc","circle","ellipse","bezier-cubic","bezier-quadratic","spline"].indexOf(a.type))throw new Error("shape - create - type is not valid \n http://requirejs.org/docs/errors.html#errorCode");a=j.object.merge({uuid:j.math.uuid(9,16)},a);var b=l[a.type].create(a);return k.active.children.add(b.uuid,b),b}function d(a){return e(a),c(a),!0}function e(a){if(null!=a&&void 0!=a){if("string"==j.conversion.toType(a))return k.active.children.remove(a);if("object"==j.conversion.toType(a))return k.active.children.remove(a.uuid);throw new Error("Shape - remove - param is not valid \n http://requirejs.org/docs/errors.html#errorCode")}}function f(){return k.active.children.clear()}function g(){return k.active.children.list()}function h(a){if(null!=a&&void 0!=a){if("string"==j.conversion.toType(a))return k.active.children.find(a);if("object"==j.conversion.toType(a))return k.active.children.find(a.uuid);throw new Error("Shape - find - param is not valid \n http://requirejs.org/docs/errors.html#errorCode")}}function i(a){return"inView"==a.type?k.active.children.list().filter(function(){}):""}var j=a("utility"),k=(a("plane/math/intersection"),a("plane/math/matrix"),a("plane/core/point"),a("plane/core/layer")),l={arc:a("plane/object/arc"),"bezier-cubic":a("plane/object/bezier-cubic"),"bezier-quadratic":a("plane/object/bezier-quadratic"),circle:a("plane/object/circle"),ellipse:a("plane/object/ellipse"),line:a("plane/object/line"),polygon:a("plane/object/polygon"),polyline:a("plane/object/polyline"),rectangle:a("plane/object/rectangle"),spline:a("plane/object/spline")};b.create=c,b.update=d,b.remove=e,b.clear=f,b.list=g,b.find=h,b.search=i}),define("plane/core/tool",["require","exports"],function(a,b){function c(a){this.uuid=a.uuid,this.name=a.name,this.events=a.events,Object.defineProperty(this,"active",{get:function(){return this._active||!1},set:function(a){this._active!=a&&(this.events.notify(a?"onActive":"onDeactive",{type:a?"onActive":"onDeactive",now:(new Date).toISOString()}),this._active=a)}}),this.active=a.active}function d(a){function b(a){8==a.keyCode&&"INPUT"!=a.target.tagName&&"P"!=a.target.tagName&&a.preventDefault(),a={type:"onKeyDown",altKey:a.altKey,ctrlKey:a.ctrlKey,shiftKey:a.shiftKey,key:i.string.fromKeyPress(a.keyCode),now:(new Date).toISOString()};for(var b=j.list(),c=b.length;c--;)b[c].active&&b[c].events.notify("onKeyDown",a)}function c(a){var b=i.graphic.mousePosition(l,a.x,a.y),c=m.transform.inverseTransform(b);n=c,a={type:"onMouseDown",button:0==a.button?"left":1==a.button?"wheel":"right",target:a.target,point:{inDocument:k.create(a.x,a.y),inCanvas:k.create(b),inView:k.create(c)},now:(new Date).toISOString()};for(var d=j.list(),e=d.length;e--;)d[e].active&&d[e].events.notify("onMouseDown",a)}function d(a){var b=i.graphic.mousePosition(l,a.x,a.y),c=m.transform.inverseTransform(b);n=null,a={type:"onMouseUp",button:0==a.button?"left":1==a.button?"wheel":"right",point:{inDocument:k.create(a.x,a.y),inCanvas:k.create(b),inView:k.create(c)},now:(new Date).toISOString()};for(var d=j.list(),e=d.length;e--;)d[e].active&&d[e].events.notify("onMouseUp",a)}function e(a){if(n){var b=i.graphic.mousePosition(l,a.x,a.y),c=m.transform.inverseTransform(b),d=k.create(n),e=k.create(c);if(!d.equals(e)){a={type:"onMouseDrag",point:{inDocument:k.create(a.x,a.y),inCanvas:k.create(b),first:d,last:e},now:(new Date).toISOString()};for(var f=j.list(),g=f.length;g--;)f[g].active&&f[g].events.notify("onMouseDrag",a)}}}function f(a){var b=i.graphic.mousePosition(l,a.x,a.y),c=m.transform.inverseTransform(b);a={type:"onMouseMove",point:{inDocument:k.create(a.x,a.y),inCanvas:k.create(b),inView:k.create(c)},now:(new Date).toISOString()};for(var d=j.list(),e=d.length;e--;)d[e].active&&d[e].events.notify("onMouseMove",a)}function g(){n=null}function h(a){var b=i.graphic.mousePosition(l,a.x,a.y),c=m.transform.inverseTransform(b);a={type:"onMouseWheel",delta:a.deltaY,point:k.create(c),now:(new Date).toISOString()};for(var d=j.list(),e=d.length;e--;)d[e].active&&d[e].events.notify("onMouseWheel",a)}return l=a.viewPort,m=a.view,window.addEventListener("keydown",b,!1),l.onmousedown=c,l.onmouseup=d,l.addEventListener("mousemove",e,!1),l.addEventListener("mousemove",f,!1),l.onmouseleave=g,l.onmousewheel=h,!0}function e(a){if("function"==typeof a)throw new Error("Tool - create - attrs is not valid \n http://requirejs.org/docs/errors.html#errorCode");var b=i.math.uuid(9,16);a=i.object.merge({uuid:b,name:"tool - ".concat(b),events:i.object.event.create(),active:!1},a);var d=new c(a);return j.add(d.uuid,d),d}function f(){return j.list()}function g(a){return j.find(a)}function h(a){return j.remove(a)}var i=a("utility"),j=i.data.dictionary.create(),k=a("plane/core/point"),l=null,m=null,n=null;b.initialize=d,b.create=e,b.list=f,b.find=g,b.remove=h}),define("plane/core/view",["require","exports"],function(a,b){function c(a){k=a.viewPort,l=a.canvas,m=l.getContext("2d"),m.translate(0,k.clientHeight),m.scale(1,-1),n=g.create(),p=p.sum(i.create(k.clientWidth/2,k.clientHeight/2)),q.height=k.clientHeight,q.width=k.clientWidth,window.onresize=function(){l.width=k.clientWidth,l.height=k.clientHeight,q.height=k.clientHeight,q.width=k.clientWidth,l.getContext("2d").translate(0,k.clientHeight),l.getContext("2d").scale(1,-1),d(),r.notify("onResize",{size:q,now:(new Date).toISOString()})}}function d(){m.clearRect(0,0,k.clientWidth+1,k.clientHeight+1);var a=h.list(),b=a.length;a.sort(function(a){return"system"!=a.status?-1:"system"==a.status?1:0});for(var c=navigator.hardwareConcurrency;b--;){var d=a[b].children.list(),e=d.length;if(m.lineCap=a[b].style.lineCap,m.lineJoin=a[b].style.lineJoin,m.beginPath(),e>500){var f=j.array.split(d,c);f.forEach(function(a){j.thread.add(function(){for(var b=a,c=a.length;c--;)b[c].render(m,n);return!1})}),j.thread.start()}else for(;e--;)d[e].render(m,n);m.stroke()}return this}function e(a,b){var c;c=a/o,n.scale({x:c,y:c},p),o=a;var e=b.subtract(p);e=e.negate();var f=g.create();return f.translate(e.x,e.y),n.concate(f),p=b,d(),!0}function f(){e(1,i.create(q.width/2,q.height/2)),n=g.create()}var g=a("plane/math/matrix"),h=a("plane/core/layer"),i=a("plane/core/point"),j=a("utility"),k=null,l=null,m=null,n=null,o=1,p=i.create(0,0),q={height:0,width:0};Object.defineProperty(b,"context",{get:function(){return m}}),Object.defineProperty(b,"transform",{get:function(){return n}}),Object.defineProperty(b,"size",{get:function(){return q}}),Object.defineProperty(b,"bounds",{get:function(){var a=Math.sqrt(n.a*n.d);return{x:n.tx,y:n.ty,height:q.height*a,width:q.width*a}}}),Object.defineProperty(b,"center",{get:function(){return p},set:function(a){var b=a.subtract(p);b=b.negate();var c=g.create();return c.translate(b.x,b.y),n.concate(c),p=a,d(),!0}}),Object.defineProperty(b,"zoom",{get:function(){return o},set:function(a){var b;return b=a/o,n.scale({x:b,y:b},p),o=a,d(),!0}});var r=j.object.event.create();b.initialize=c,b.update=d,b.zoomTo=e,b.reset=f,b.events=r}),define("plane/data/exporter",["require","exports"],function(a,b){function c(){return!0}function d(){return!0}function e(){return!0}function f(){return!0}b.toSvg=c,b.toDxf=d,b.toPng=e,b.toPdf=f}),define("plane/data/importer",["require","exports"],function(a,b){function c(a){function b(a){switch(a.type){case"arc":var b='{"type": "arc", "center": [{0}, {1}], "radius": {2}, "startAngle": {3}, "endAngle": {4} },';return g.string.format(b,[a.x,a.y,a.r,a.a0,a.a1]);case"circle":var c='{ "type": "circle", "center": [{0}, {1}], "radius": {2} },';return g.string.format(c,[a.x,a.y,a.r]);case"ellipse":for(var d='{ "type": "ellipse", "center": [{0}, {1}], "radiusY": {2}, "radiusX": {3}, "startAngle": {4}, "endAngle": {5}, "angle": {6} },',e=a.r,f=a.startAngle,h=a.endAngle||2*Math.PI;f>h;)h+=2*Math.PI;var i={x:0-a.x1,y:0-a.y1};i=Math.sqrt(i.x*i.x+i.y*i.y);var j=i*e,k=Math.atan2(a.y1,a.x1);return g.string.format(d,[a.x,a.y,j,i,f,h,k]);case"line":var l='{ "type": "line", "from": [{0}, {1}], "to": [{2}, {3}] },';return g.string.format(l,[a.x,a.y,a.x1,a.y1]);case"lwpolyline":if(a.vertices){for(var m='{"type": "polyline", "points": [{0}]},',n="",o=0;o<a.vertices.length;o++){var p=o==a.vertices.length-1?'{"x": {0}, "y": {1}}':'{"x": {0}, "y": {1}},';n+=g.string.format(p,[a.vertices[o].x,a.vertices[o].y])}return g.string.format(m,[n])}return"";case"polyline":if(a.vertices){for(var m='{"type": "polyline", "points": [{0}]},',n="",o=0;o<a.vertices.length;o++){var p=o==a.vertices.length-1?'{"x": {0}, "y": {1}}':'{"x": {0}, "y": {1}},';n+=g.string.format(p,[a.vertices[o].x,a.vertices[o].y])}return g.string.format(m,[n])}return"";case"spline":if(a.points){for(var q='{"type": "spline", "degree": {0}, "knots": [{1}], "points": [{2}]},',n="",o=0;o<a.points.length;o++){var p=o==a.points.length-1?'{"x": {0}, "y": {1}}':'{"x": {0}, "y": {1}},';n+=g.string.format(p,[a.points[o][0],a.points[o][1]])}return g.string.format(q,[a.degree,a.knots.join(),n])}return""}}a=a.replace(/\r\n/g,"\n").replace(/\r/g,"\n");for(var c=["line","circle","arc","ellipse","lwpolyline","polyline","spline"],d=!1,e=null,f="",h="",i="",j=a.split("\n"),k=0;k<=j.length-1;k++)i=j[k].toLowerCase(),d=d?d:"entities"==i,c.indexOf(i)>-1?e={type:i}:e&&(" 10"!=f?" 10"!=i?" 11"!=f?" 11"!=i?" 20"!=f?" 20"!=i?" 21"!=f?" 21"!=i?" 40"!=f?" 40"!=i?" 41"!=f?" 41"!=i?" 42"!=f?" 42"!=i?" 50"!=f?" 50"!=i?" 51"!=f?" 51"!=i?" 71"!=f?" 71"!=i?(e&&e.type&&"polyline"!=e.type&&"  0"==j[k]&&(h+=b(e),e=null),e&&e.type&&"polyline"==e.type&&"SEQEND"==j[k]&&(h+=b(e),e=null)):f=i:(e.degree=g.math.parseFloat(i,5),f=""):f=i:(e.a1=g.math.parseFloat(i,5),f=""):f=i:(e.a0=g.math.parseFloat(i,5),f=""):f=i:(e.endAngle=g.math.parseFloat(i,5),f=""):f=i:(e.startAngle=g.math.parseFloat(i,5),f=""):f=i:("spline"==e.type?(e.knots=e.knots||[],e.knots.push(g.math.parseFloat(i,5))):e.r=g.math.parseFloat(i,5),f=""):f=i:(e.y1=g.math.parseFloat(i,5),f=""):f=i:("spline"==e.type?e.points[e.points.length-1][1]=g.math.parseFloat(i,5):e.y=g.math.parseFloat(i,5),("lwpolyline"==e.type||"polyline"==e.type)&&e.x&&e.y&&(e.vertices=e.vertices||[],e.vertices.push({x:e.x,y:e.y})),f=""):f=i:(e.x1=g.math.parseFloat(i,5),f=""):f=i:("spline"==e.type?(e.points=e.points||[],e.points.push([g.math.parseFloat(i,5),0])):e.x=g.math.parseFloat(i,5),f=""));return h?"["+h.substring(0,h.length-1)+"]":"[]"}function d(){return!0}function e(){return!0}function f(){return!0}var g=a("utility");b.parseDxf=c,b.parseDwg=d,b.parseJson=e,b.parseSvg=f}),define("plane/math/intersection",["require","exports"],function(a,b){function c(a,b){var c=a[0]*b[1]-b[0]*a[1],d=a[0]*b[2]-b[0]*a[2],e=a[0]*b[3]-b[0]*a[3],f=a[0]*b[4]-b[0]*a[4],g=a[0]*b[5]-b[0]*a[5],h=a[1]*b[2]-b[1]*a[2],i=a[1]*b[4]-b[1]*a[4],j=a[1]*b[5]-b[1]*a[5],k=a[2]*b[3]-b[2]*a[3],l=a[3]*b[4]-b[3]*a[4],m=a[3]*b[5]-b[3]*a[5],o=j+l,p=i-k;return n.create(c*h-d*d,c*p+e*h-2*d*f,c*o+e*p-f*f-2*d*g,c*m+e*o-2*f*g,e*m-g*g)}function d(a,b,c,d,e,f){var g=c.minimum(e),h=c.maximum(e),i=d.minimum(f),j=d.maximum(f);return g.x<=a&&a<=h.x&&i.y<=b&&b<=j.y}function e(a,b,c,e,g){var h=f(b,c,a),i=f(c,g,a),j=f(g,e,a),k=f(e,b,a);if(h||i||j||k)return!0;for(var l=0;l<a.length;l++)if(d(a[l].x,a[l].y,e,b,c,g))return!0;return!1}function f(a,b,c){for(var d=c.length,e=0;d>e;e++){var f=c[e],h=c[(e+1)%d];if(g(a,b,f,h))return!0}return!1}function g(a,b,c,d){var e,f=(d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x),g=(b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x),h=(d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y);if(0!==h){var i=f/h,j=g/h;i>=0&&1>=i&&j>=0&&1>=j?(e=[],e.push(o.create(a.x+i*(b.x-a.x),a.y+i*(b.y-a.y)))):e=!1}else e=0===f||0===g?!1:!1;return e}function h(a,b,c,d){var e,f=(d.x-c.x)*(d.x-c.x)+(d.y-c.y)*(d.y-c.y),g=2*((d.x-c.x)*(c.x-a.x)+(d.y-c.y)*(c.y-a.y)),h=a.x*a.x+a.y*a.y+c.x*c.x+c.y*c.y-2*(a.x*c.x+a.y*c.y)-b*b,i=g*g-4*f*h;if(0>i)e=!1;else if(0==i)e=!1;else{var j=Math.sqrt(i),k=(-g+j)/(2*f),l=(-g-j)/(2*f);e=(0>k||k>1)&&(0>l||l>1)?0>k&&0>l||k>1&&l>1?!1:!1:!0}return e}function i(a,b,c,d,e){var f=o.create(c.x+e,c.y),g=o.create(c.x+e,c.y+d),i=o.create(c.x,c.y+d),j=o.create(c.x,c.y),k=h(a,b,f,g),l=h(a,b,g,i),m=h(a,b,i,j),n=h(a,b,j,f);return k||l||m||n}function j(a,b,c,d){var e,f=b+d,g=Math.abs(b-d),h=a.distanceTo(c);if(h>f)e=!1;else if(g>h)e=!1;else{e={points:[]};var i=(b*b-d*d+h*h)/(2*h),j=Math.sqrt(b*b-i*i),k=a.interpolationLinear(c,i/h),l=j/h;e.points.push(o.create(k.x-l*(c.y-a.y),k.y+l*(c.x-a.x))),e.points.push(o.create(k.x+l*(c.y-a.y),k.y-l*(c.x-a.x)))}return e}function k(a,b,c,d,e,f,g){var h=j(a,b,c,d);if(h.points)for(var i=e/360*2*Math.PI,k=f/360*2*Math.PI,l=i>k?(i-k)/2:(k-i)/2,m=o.create(c.x+Math.cos(i)*d,c.y+Math.sin(i)*d),n=o.create(c.x+Math.cos(k)*d,c.y+Math.sin(k)*d),p=o.create(c.x+Math.cos(l)*d,g?c.y-Math.sin(l)*d:c.y+Math.sin(l)*d),q=(Math.PI+Math.PI,0);q<=h.points.length-1;q++){var r=h.points[q].distanceTo(c),s=d;if(r>=s-4&&s+4>=r){var t=c.angleTo(m),u=c.angleTo(p),v=c.angleTo(n),w=c.angleTo(h.points[q]);if(u>=t&&v>=u)return w>=t&&v>=w?!0:!1;if(u>=v&&t>=u)return g?w>=v&&t>=w?!0:!1:w>=v&&t>=w?!1:!0;if(u>=t&&u>=v){if(v>t)return g?w>t&&v>w?!1:!0:w>t&&v>w?!0:!1;if(t>v)return w>v&&t>w?!1:!0}else if(t>=u&&v>=u){if(v>t)return g?w>t&&v>w?!1:!0:w>t&&v>w?!0:!1;if(t>v)return w>v&&t>w?!1:!0}}return!1}return!1}function l(a,b,d,e,f,g){for(var h=[b*b,0,d*d,-2*b*b*a.x,-2*d*d*a.y,b*b*a.x*a.x+d*d*a.y*a.y-d*d*b*b],i=[f*f,0,g*g,-2*f*f*e.x,-2*g*g*e.y,f*f*e.x*e.x+g*g*e.y*e.y-g*g*f*f],j=c(h,i),k=j.getRoots(),l=.001,m=(h[0]*h[0]+2*h[1]*h[1]+h[2]*h[2])*l,o=(i[0]*i[0]+2*i[1]*i[1]+i[2]*i[2])*l,p=0;p<k.length;p++)for(var q=n.create(h[0],h[3]+k[p]*h[1],h[5]+k[p]*(h[4]+k[p]*h[2])),r=q.getRoots(),s=0;s<r.length;s++){var t=(h[0]*r[s]+h[1]*k[p]+h[3])*r[s]+(h[2]*k[p]+h[4])*k[p]+h[5];if(Math.abs(t)<m&&(t=(i[0]*r[s]+i[1]*k[p]+i[3])*r[s]+(i[2]*k[p]+i[4])*k[p]+i[5],Math.abs(t)<o))return!0}return!1}function m(a,b,c,d,e,f){var g,h,i,j,k,l={};g=b.multiply(-2),i=a.sum(g.sum(c)),g=a.multiply(-2),h=b.multiply(2),j=g.sum(h),k=o.create(a.x,a.y);var m=e,p=f,q=n.create(p*i.x*i.x+m*i.y*i.y,2*(p*i.x*j.x+m*i.y*j.y),p*(2*i.x*k.x+j.x*j.x)+m*(2*i.y*k.y+j.y*j.y)-2*(p*d.x*i.x+m*d.y*i.y),2*(p*j.x*(k.x-d.x)+m*j.y*(k.y-d.y)),p*(k.x*k.x+d.x*d.x)+m*(k.y*k.y+d.y*d.y)-2*(p*d.x*k.x+m*d.y*k.y)-m*p).getRoots();if(q.length>1){l.points=[];for(var r=0;r<q.length;r++){var s=q[r];s>=0&&1>=s&&l.points.push(i.multiply(s*s).sum(j.multiply(s).sum(k)))}return l.points.length>0}return!1}var n=a("plane/math/polynomial"),o=a("plane/core/point");b.circleLine=h,b.circleRectangle=i,b.circleCircle=j,b.circleArc=k,b.circleEllipse=l,b.circleBezier=m,b.lineLine=g,b.segmentsRectangle=e}),define("plane/math/matrix",["require","exports"],function(a,b){function c(a,b,c,d,e,f){this.a=a||1,this.c=c||0,this.b=b||0,this.d=d||1,this.tx=e||0,this.ty=f||0}function d(a){return a.a*a.d-a.b*a.c}function e(a,b,c){return c?{x:b[0]*a.x+b[1]*a.y,y:b[2]*a.x+b[3]*a.y}:{x:b[0]*a.x+b[1]*a.y+b[4],y:b[2]*a.x+b[3]*a.y+b[5]}}function f(){return new c}c.prototype={rotate:function(a,b,c){var d=Math.cos(a),e=Math.sin(a);return this.transform(d,e,-e,d,b-b*d+c*e,c-b*e-c*d)},scale:function(a,b){return b&&this.translate(b.x,b.y),this.a*=a.x,this.c*=a.x,this.b*=a.y,this.d*=a.y,b&&this.translate(-b.x,-b.y),this},translate:function(a,b){return this.tx+=a*this.a+b*this.b,this.ty+=a*this.c+b*this.d,this},reset:function(){return this.a=this.d=1,this.c=this.b=this.tx=this.ty=0,this},clone:function(){return new c(this.a,this.b,this.c,this.d,this.tx,this.ty)},concate:function(a){var b=this.a,c=this.b,d=this.c,e=this.d,f=a.a,g=a.b,h=a.c,i=a.d,j=a.tx,k=a.ty;return this.a=f*b+h*c,this.b=g*b+i*c,this.c=f*d+h*e,this.d=g*d+i*e,this.tx+=j*b+k*c,this.ty+=j*d+k*e,this},shear:function(a,b){b&&this.translate(b.x,b.y);var c=this.a,d=this.c;return this.a+=a.y*this.b,this.c+=a.y*this.d,this.b+=a.x*c,this.d+=a.x*d,b&&this.translate(-b.x,-b.y),this},skew:function(a,b){var c=Math.PI/180,d={x:Math.tan(a.x*c),y:Math.tan(a.y*c)};return this.shear(d,b)},inverse:function(){var a=this.toArray(),b=1/(this.a*this.d-this.b*this.c);a=[b*this.d,-b*this.b,-b*this.c,b*this.a,0,0];var c=e({x:this.tx,y:this.ty},a);return a[4]=-c.x,a[5]=-c.y,a},inverted:function(){var a=d(this);return a&&new c(this.d/a,-this.c/a,-this.b/a,this.a/a,(this.b*this.ty-this.d*this.tx)/a,(this.c*this.tx-this.a*this.ty)/a)},inverseTransform:function(a){var b=d(this),c=a.x-this.tx,e=a.y-this.ty;return{x:(c*this.d-e*this.b)/b,y:(e*this.a-c*this.c)/b}},transform:function(a,b,c,d,e,f){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=e,this.ty=f,this},toCenter:function(){},toArray:function(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]},_transformCoordinates:function(a,b,c){for(var d=0,e=0,f=2*c;f>d;){var g=a[d++],h=a[d++];b[e++]=g*this._a+h*this._b+this._tx,b[e++]=g*this._c+h*this._d+this._ty}return b},_transformCorners:function(a){var b=a.x,c=a.y,d=b+a.width,e=c+a.height,f=[b,c,d,c,d,e,b,e];return this._transformCoordinates(f,f,4)},_transformBounds:function(a,b,c){for(var d=this._transformCorners(a),e=d.slice(0,2),f=d.slice(),g=2;8>g;g++){var h=d[g],i=1&g;h<e[i]?e[i]=h:h>f[i]&&(f[i]=h)}return b||(b=new Rectangle),b.set(e[0],e[1],f[0]-e[0],f[1]-e[1],c)}},b.create=f,b.toPoint=e}),define("plane/math/polynomial",["require","exports"],function(a,b){function c(a){this.coefs=new Array;for(var b=a.length-1;b>=0;b--)this.coefs.push(a[b]);this._variable="t",this._s=0}function d(){return new c(arguments)}c.prototype.simplify=function(){for(var a=this.getDegree();a>=0&&Math.abs(this.coefs[a])<=c.TOLERANCE;a--)this.coefs.pop()},c.prototype.getDegree=function(){return this.coefs.length-1},c.prototype.getLinearRoot=function(){var a=new Array,b=this.coefs[1];return 0!=b&&a.push(-this.coefs[0]/b),a},c.prototype.getQuadraticRoots=function(){var a=new Array;if(2==this.getDegree()){var b=this.coefs[2],c=this.coefs[1]/b,d=this.coefs[0]/b,e=c*c-4*d;if(e>0){var f=Math.sqrt(e);a.push(.5*(-c+f)),a.push(.5*(-c-f))}else 0==e&&a.push(.5*-c)}return a},c.prototype.getCubicRoots=function(){var a=new Array;if(3==this.getDegree()){var b=this.coefs[3],d=this.coefs[2]/b,e=this.coefs[1]/b,f=this.coefs[0]/b,g=(3*e-d*d)/3,h=(2*d*d*d-9*e*d+27*f)/27,i=d/3,j=h*h/4+g*g*g/27,k=h/2;if(Math.abs(j)<=c.TOLERANCE&&(j=0),j>0){var l,m,n=Math.sqrt(j);l=-k+n,m=l>=0?Math.pow(l,1/3):-Math.pow(-l,1/3),l=-k-n,l>=0?m+=Math.pow(l,1/3):m-=Math.pow(-l,1/3),a.push(m-i)}else if(0>j){var o=Math.sqrt(-g/3),p=Math.atan2(Math.sqrt(-j),-k)/3,q=Math.cos(p),r=Math.sin(p),s=Math.sqrt(3);a.push(2*o*q-i),a.push(-o*(q+s*r)-i),a.push(-o*(q-s*r)-i)}else{var l;l=k>=0?-Math.pow(k,1/3):Math.pow(-k,1/3),a.push(2*l-i),a.push(-l-i)}}return a},c.prototype.getQuarticRoots=function(){var a=new Array;if(4==this.getDegree()){var b=this.coefs[4],e=this.coefs[3]/b,f=this.coefs[2]/b,g=this.coefs[1]/b,h=this.coefs[0]/b,i=d(1,-f,e*g-4*h,-e*e*h+4*f*h-g*g).getCubicRoots(),j=i[0],k=e*e/4-f+j;if(Math.abs(k)<=c.TOLERANCE&&(k=0),k>0){var l=Math.sqrt(k),m=3*e*e/4-l*l-2*f,n=(4*e*f-8*g-e*e*e)/(4*l),o=m+n,p=m-n;if(Math.abs(o)<=c.TOLERANCE&&(o=0),Math.abs(p)<=c.TOLERANCE&&(p=0),o>=0){var q=Math.sqrt(o);a.push(-e/4+(l+q)/2),a.push(-e/4+(l-q)/2)}if(p>=0){var q=Math.sqrt(p);a.push(-e/4+(q-l)/2),a.push(-e/4-(q+l)/2)}}else if(0>k);else{var n=j*j-4*h;if(n>=-c.TOLERANCE){if(0>n&&(n=0),n=2*Math.sqrt(n),m=3*e*e/4-2*f,m+n>=c.TOLERANCE){var r=Math.sqrt(m+n);a.push(-e/4+r/2),a.push(-e/4-r/2)}if(m-n>=c.TOLERANCE){var r=Math.sqrt(m-n);a.push(-e/4+r/2),a.push(-e/4-r/2)}}}}return a},c.prototype.getRoots=function(){var a;switch(this.simplify(),this.getDegree()){case 0:a=new Array;break;case 1:a=this.getLinearRoot();break;case 2:a=this.getQuadraticRoots();break;case 3:a=this.getCubicRoots();break;case 4:a=this.getQuarticRoots();break;default:a=new Array}return a},b.create=d}),define("plane/object/arc",["require","exports"],function(a,b){function c(a){if("function"==typeof a)throw new Error("Arc - create - attrs is not valid \n http://requirejs.org/docs/errors.html#errorCode");return a.center=d.create(a.center),delete a.segments,new g(a)}var d=(a("plane/math/intersection"),a("plane/math/matrix"),a("plane/core/point")),e=a("plane/object/shape"),f=a("utility"),g=f.object.inherits(function(a){this.uuid=null,this.type=null,this.name=null,this.segments=[],this.status=null,this.style=null,this.center=null,this.radius=null,this.startAngle=null,this.endAngle=null,this.initialize(a)},e.Base);g.prototype.calculeSegments=function(){var a=this.endAngle-this.startAngle;0>a&&(a+=360);var b=.7/180*Math.PI,c=this.startAngle/180*Math.PI,d=a/180*Math.PI;0>d&&(b=-b);for(var e=Math.abs(d/b)+2,f=0,g=c;e-1>f;){var h=this.center.x+this.radius*Math.cos(g),i=this.center.y+this.radius*Math.sin(g);this.segments.push({x:h,y:i}),++f,g+=b}var j=this.center.x+this.radius*Math.cos(c+d),k=this.center.y+this.radius*Math.sin(c+d);return this.segments[this.segments.length-1].x=j,this.segments[this.segments.length-1].y=k,!0},b.create=c}),define("plane/object/bezier-cubic",["require","exports"],function(a,b){function c(a){if("function"==typeof a)throw new Error("Bezier Cubic - create - attrs is not valid \n http://requirejs.org/docs/errors.html#errorCode");return a.points[0]=d.create(a.points[0]),a.points[1]=d.create(a.points[1]),a.points[2]=d.create(a.points[2]),a.points[3]=d.create(a.points[3]),delete a.segments,new g(a)}var d=(a("plane/math/intersection"),a("plane/math/matrix"),a("plane/core/point")),e=a("plane/object/shape"),f=a("utility"),g=f.object.inherits(function(a){this.uuid=null,this.type=null,this.name=null,this.segments=[],this.status=null,this.style=null,this.points=a.points,this.initialize(a)},e.Base);g.prototype.calculeSegments=function(){for(var a=100,b=function(a,b){for(var c=0,d=0;d<a.length;d++)c+=a[d]*b[d];return c},c=function(a,c){var d=a[0],e=a[1],f=a[2],g=a[3],h=c*c*c,i=c*c,j=b([d.x,e.x,f.x,g.x],[(1-c)*(1-c)*(1-c),3*(1-c)*(1-c)*c,3*(1-c)*i,h]),k=b([d.y,e.y,f.y,g.y],[(1-c)*(1-c)*(1-c),3*(1-c)*(1-c)*c,3*(1-c)*i,h]);return{x:j,y:k}},d=0;a+1>d;d++)this.segments.push(c(this.points,d/a));return!0},b.create=c}),define("plane/object/bezier-quadratic",["require","exports"],function(a,b){function c(a){if("function"==typeof a)throw new Error("Bezier Quadratic - create - attrs is not valid \n http://requirejs.org/docs/errors.html#errorCode");return a.points[0]=d.create(a.points[0]),a.points[1]=d.create(a.points[1]),a.points[2]=d.create(a.points[2]),delete a.segments,new g(a)}var d=(a("plane/math/intersection"),a("plane/math/matrix"),a("plane/core/point")),e=a("plane/object/shape"),f=a("utility"),g=f.object.inherits(function(a){this.uuid=null,this.type=null,this.name=null,this.segments=[],this.status=null,this.style=null,this.points=a.points,this.initialize(a)},e.Base);g.prototype.calculeSegments=function(){for(var a=100,b=function(a,b){for(var c=0,d=0;d<a.length;d++)c+=a[d]*b[d];return c},c=function(a,c){var d=a[0],e=a[1],f=a[2],g=c*c,h=b([d.x,e.x,f.x],[(1-c)*(1-c),2*c*(1-c),g]),i=b([d.y,e.y,f.y],[(1-c)*(1-c),2*c*(1-c),g]);return{x:h,y:i}},d=0;a+1>d;d++)this.segments.push(c(this.points,d/a));return!0},b.create=c}),define("plane/object/circle",["require","exports"],function(a,b){function c(a){if("function"==typeof a)throw new Error("Circle - create - attrs is not valid \n http://requirejs.org/docs/errors.html#errorCode");return a.center=d.create(a.center),delete a.segments,new g(a)}var d=(a("plane/math/intersection"),a("plane/math/matrix"),a("plane/core/point")),e=a("plane/object/shape"),f=a("utility"),g=f.object.inherits(function(a){this.uuid=null,this.type=null,this.name=null,this.segments=[],this.status=null,this.style=null,this.center=null,this.radius=null,this.initialize(a)},e.Base);g.prototype.calculeSegments=function(){for(var a=Math.PI/58,b=Math.abs(2*Math.PI/a)+2,c=0,d=0;b-1>c;)this.segments.push({x:this.center.x+this.radius*Math.cos(d),y:this.center.y+this.radius*Math.sin(d)}),++c,d+=a;return!0},g.prototype.isInside=function(a){var b=a.x-this.center.x,c=a.y-this.center.y;return b*b+c*c<=this.radius*this.radius},b.create=c}),define("plane/object/ellipse",["require","exports"],function(a,b){function c(a){if("function"==typeof a)throw new Error("Ellipse - create - attrs is not valid \n http://requirejs.org/docs/errors.html#errorCode");return a.center=d.create(a.center),delete a.segments,new g(a)}var d=(a("plane/math/intersection"),a("plane/math/matrix"),a("plane/core/point")),e=a("plane/object/shape"),f=a("utility"),g=f.object.inherits(function(a){this.uuid=null,this.type=null,this.name=null,this.segments=[],this.status=null,this.style=null,this.center=null,this.radiusY=null,this.radiusX=null,this.angle=null,this.startAngle=null,this.endAngle=null,this.initialize(a)},e.Base);g.prototype.calculeSegments=function(){for(var a=void 0!=this.startAngle&&void 0!=this.endAngle?this.angle:f.math.radians(this.angle)||0,b=this.startAngle||0,c=this.endAngle||2*Math.PI;b>c;)c+=2*Math.PI;for(var d=this.radiusX,e=this.radiusY,g=Math.PI/60,h=Math.cos(a),i=Math.sin(a);;){b>c&&(g-=b-c,b=c);var j={x:d*Math.cos(b),y:e*Math.sin(b)};if(j={x:j.x*h+j.y*-i,y:j.x*i+j.y*h},j={x:this.center.x+j.x,y:this.center.y+j.y},this.segments.push(j),b==c)break;b+=g}return!0},b.create=c}),define("plane/object/line",["require","exports"],function(a,b){function c(a){if("function"==typeof a)throw new Error("Arc - create - attrs is not valid \n http://requirejs.org/docs/errors.html#errorCode");return a.from=d.create(a.from),a.to=d.create(a.to),delete a.segments,new g(a)}var d=(a("plane/math/intersection"),a("plane/math/matrix"),a("plane/core/point")),e=a("plane/object/shape"),f=a("utility"),g=f.object.inherits(function(a){this.uuid=null,this.type=null,this.name=null,this.segments=[],this.status=null,this.style=null,this.from=null,this.to=null,this.initialize(a)},e.Base);g.prototype.calculeSegments=function(){return this.segments.push({x:this.from.x,y:this.from.y}),this.segments.push({x:this.to.x,y:this.to.y}),!0},b.create=c}),define("plane/object/polygon",["require","exports"],function(a,b){function c(a){if("function"==typeof a)throw new Error("Polygon - create - attrs is not valid \n http://requirejs.org/docs/errors.html#errorCode");return a.center=d.create(a.center),delete a.segments,new g(a)}var d=(a("plane/math/intersection"),a("plane/math/matrix"),a("plane/core/point")),e=a("plane/object/shape"),f=a("utility"),g=f.object.inherits(function(a){this.uuid=null,this.type=null,this.name=null,this.segments=[],this.status=null,this.style=null,this.center=null,this.sides=null,this.radius=null,this.initialize(a)},e.Base);g.prototype.calculeSegments=function(){for(var a=0;a<=this.sides;a++){var b=this.radius*Math.cos(2*Math.PI/this.sides*a)+this.center.x,c=this.radius*Math.sin(2*Math.PI/this.sides*a)+this.center.y;this.segments.push({x:b,y:c})}return!0},b.create=c}),define("plane/object/polyline",["require","exports"],function(a,b){function c(a){if("function"==typeof a)throw new Error("Arc - create - attrs is not valid \n http://requirejs.org/docs/errors.html#errorCode");return a.points=a.points.map(function(a){return d.create(a)}),delete a.segments,new g(a)}var d=(a("plane/math/intersection"),a("plane/math/matrix"),a("plane/core/point")),e=a("plane/object/shape"),f=a("utility"),g=f.object.inherits(function(a){this.uuid=null,this.type=null,this.name=null,this.segments=[],this.status=null,this.style=null,this.points=null,this.initialize(a)},e.Base);g.prototype.calculeSegments=function(){return this.segments=this.points,!0},b.create=c}),define("plane/object/rectangle",["require","exports"],function(a,b){function c(a){if("function"==typeof a)throw new Error("Arc - create - attrs is not valid \n http://requirejs.org/docs/errors.html#errorCode");return a.from=d.create(a.from),a.to=d.create(a.to),delete a.segments,new g(a)}var d=(a("plane/math/intersection"),a("plane/math/matrix"),a("plane/core/point")),e=a("plane/object/shape"),f=a("utility"),g=f.object.inherits(function(a){this.uuid=null,this.type=null,this.name=null,this.segments=[],this.status=null,this.style=null,this.from=null,this.to=null,this.initialize(a)},e.Base);g.prototype.calculeSegments=function(){return this.segments.push({x:this.from.x,y:this.from.y}),this.segments.push({x:this.from.x,y:this.to.y}),this.segments.push({x:this.to.x,y:this.to.y}),this.segments.push({x:this.to.x,y:this.from.y}),this.segments.push({x:this.from.x,y:this.from.y}),!0
},b.create=c}),define("plane/object/shape",["require","exports"],function(a,b){function c(){}var d=a("plane/math/intersection"),e=(a("plane/math/matrix"),a("plane/core/point")),f=a("utility");c.prototype={initialize:function(a){return a.name=f.string.format("{0} - {1}",[a.type,a.uuid]),f.object.extend(this,a),this.calculeSegments(),!0},contains:function(a,b){for(var c=Math.sqrt(b.a*b.d),f=e.create(b.tx,b.ty),g=null,h=null,i=0;i<this.segments.length;i++)if(i+1==this.segments.length?(g=this.segments[i],h=this.segments[0]):(g=this.segments[i],h=this.segments[i+1]),d.circleLine(a,4,e.create(g.x*c+f.x,g.y*c+f.y),e.create(h.x*c+f.x,h.y*c+f.y)))return!0;return!1},intersect:function(a){var b=e.create(a.from.x,a.to.y),c=e.create(a.to.x,a.to.y),f=e.create(a.from.x,a.from.y),g=e.create(a.to.x,a.from.y);return d.segmentsRectangle(this.segments,b,c,f,g)},render:function(a,b){this.style&&(a.save(),this.style.lineDash&&a.setLineDash([5,2]),this.style.fillColor&&(a.fillStyle=this.style.fillColor,a.strokeStyle=this.style.fillColor),a.lineWidth=this.style.lineWidth?this.style.lineWidth:a.lineWidth,a.strokeStyle=this.style.lineColor?this.style.lineColor:a.lineColor);var c=Math.sqrt(b.a*b.d),d={x:b.tx,y:b.ty};a.moveTo(this.segments[0].x*c+d.x,this.segments[0].y*c+d.y);for(var e=0;e<this.segments.length;e++){var f=this.segments[e].x*c+d.x,g=this.segments[e].y*c+d.y;a.lineTo(f,g)}this.style&&this.style.fillColor&&a.fill(),this.style&&a.restore()},toObject:function(){return!0}},b.Base=c}),define("plane/object/spline",["require","exports"],function(a,b){function c(a){if("function"==typeof a)throw new Error("Spline - create - attrs is not valid \n http://requirejs.org/docs/errors.html#errorCode");return a.points=a.points.map(function(a){return d.create(a)}),delete a.segments,new g(a)}var d=(a("plane/math/intersection"),a("plane/math/matrix"),a("plane/core/point")),e=a("plane/object/shape"),f=a("utility"),g=f.object.inherits(function(a){this.uuid=null,this.type=null,this.name=null,this.segments=[],this.status=null,this.style=null,this.degree=a.degree,this.knots=a.knots,this.points=a.points,this.initialize(a)},e.Base);g.prototype.calculeSegments=function(){var a=function(a,b,c){var d=c.length-a-1;if(b>=c[d])return d-1;if(b<=c[a])return a;for(var e=a,f=d,g=Math.floor((e+f)/2);b<c[g]||b>=c[g+1];)b<c[g]?f=g:e=g,g=Math.floor((e+f)/2);return g},b=function(a,b,c,d){var e=[],f=[],g=[];e[0]=1;for(var h=1;c>=h;++h){f[h]=b-d[a+1-h],g[h]=d[a+h]-b;for(var i=0,j=0;h>j;++j){var k=g[j+1],l=f[h-j],m=e[j]/(k+l);e[j]=i+k*m,i=l*m}e[h]=i}return e},c=function(c,d,e,f){for(var g=a(c,f,d),h=b(g,f,c,d),i={x:0,y:0},j=0;c>=j;++j){var k=e[g-c+j],l=h[j];i.x+=k.x*l,i.y+=k.y*l}return i},d=function(a,b,d,e){for(var f=[],g=0;g<d.length-1;++g){var h=d[g],i=d[g+1];if(i>h)for(var j=0;(0==a?12:a)>=j;++j){var k=c(b,d,e,h+(i-h)*j/(0==a?12:a));f.push(k)}}return f};return this.segments=d(17,this.degree,this.knots,this.points),!0},b.create=c}),define("plane",["require","exports"],function(a,b){function c(a){if(null==a)throw new Error("plane - initialize - config is not valid \n http://requirejs.org/docs/errors.html#errorCode");if("function"==typeof a)throw new Error("plane - initialize - config is not valid \n http://requirejs.org/docs/errors.html#errorCode");if(null==a.viewPort)throw new Error("plane - initialize - config is not valid \n http://requirejs.org/docs/errors.html#errorCode");n=a.viewPort;var b=document.createElement("canvas");return b.id=f.math.uuid(9,16),b.width=n.clientWidth,b.height=n.clientHeight,b.style.position="absolute",b.style.backgroundColor="transparent",n.appendChild(b),l.initialize({viewPort:n,canvas:b}),k.initialize({viewPort:n,view:l}),g.create(),!0}function d(){return l.reset(),g.remove(),g.create(),!0}function e(){return l.reset(),g.remove(),!0}var f=a("utility"),g=(a("plane/math/matrix"),a("plane/core/layer")),h=a("plane/core/point"),i=a("plane/core/shape"),j=a("plane/core/group"),k=a("plane/core/tool"),l=a("plane/core/view"),m=a("plane/data/importer"),n=(a("plane/data/exporter"),null);b.initialize=c,b.clear=d,b.view=l,b.point=h,b.shape=i,b.group=j,b.layer=g,b.tool=k,b.importer={fromDxf:function(a){e();var b=m.parseDxf(a),c=JSON.parse(b);if(b){g.create();for(var d in c)i.create(c[d])}},fromJson:function(a){var b=JSON.parse(a);return e(),b.layers.forEach(function(a){g.create({uuid:a.uuid,name:a.name,status:a.status,style:a.style}),a.children.forEach(function(a){i.create(a)})}),l.zoomTo(b.zoom,h.create(b.center)),!0}},b.exporter={toJson:function(){var a={center:_view.center,zoom:_view.zoom,layers:g.list().map(function(a){return"system"!=a.status?a.toObject():null}).filter(function(a){return void 0!=a})};return JSON.stringify(a)}}}),define("utility",["require","exports"],function(a,b){var c={id:0,threads:[],add:function(a){this.threads.push(a)},start:function(){this.id||!function(){if(c.threads.length>0)for(var a=0;a<c.threads.length;a++)c.threads[a]()===!1&&(c.threads.splice(a,1),a--)}()},stop:function(){clearTimeout(this.id),this.id=0}},d={uuid:function(a,b){var c,d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),e=[];if(b=b||d.length,a)for(c=0;a>c;c++)e[c]=d[0|Math.random()*b];else{var f;for(e[8]=e[13]=e[18]=e[23]="-",e[14]="4",c=0;36>c;c++)e[c]||(f=0|16*Math.random(),e[c]=d[19==c?3&f|8:f])}return e.join("").toLowerCase()},parseFloat:function(a,b){return Number(parseFloat(a).toFixed(b))},radians:function(a){return a*(Math.PI/180)},degrees:function(a){return a*(180/Math.PI)}},e={format:function(){}},f={find:function(a,b){return a[a.indexOf(b)]},split:function(a,b){for(var c=a.length,d=[],e=0;c>e;){var f=Math.ceil((c-e)/b--);d.push(a.slice(e,e+f)),e+=f}return d}},g={format:function(a,b){return a.replace(/{(\d+)}/g,function(a,c){return"undefined"!=typeof b[c]?b[c]:a})},contains:function(){return-1!==String.prototype.indexOf.apply(this,arguments)},fromKeyPress:function(a){var b={8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause/Break",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"LeftArrow",38:"UpArrow",39:"RightArrow",40:"DownArrow",45:"Insert",46:"Delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",124:"F13",144:"NumLock",145:"ScrollLock",186:";:",187:"+=",189:"-_",191:"/?",192:"`~"};return b[a]}},h={mousePosition:function(a,b,c){var d=a.getBoundingClientRect();return b=(b-d.left)*(a.clientWidth/d.width),c=(c-d.top)*(a.clientHeight/d.height),c=-1*(c-a.clientHeight),{x:b,y:c}}},i={dictionary:function(){function a(){this.store=[]}return a.prototype={add:function(a,b){return this.store[a]=b},update:function(a,b){return this.store[a]=b},find:function(a){return this.store[a]},remove:function(a){delete this.store[a]},count:function(){return Object.keys(this.store).length},clear:function(){return this.store=new Array},list:function(){var a=this;return Object.keys(this.store).map(function(b){return a.store[b]})}},a.create=function(){return new a},a}(),list:function(){function a(){this.store=[],this.size=0,this.position=0}return a.prototype={add:function(a){this.store[this.size++]=a},find:function(a){for(var b=0;b<this.store.length;++b)if(this.store[b]==a)return b;return-1},remove:function(a){var b=this.find(a);return b>-1?(this.store.splice(b,1),--this.size,!0):!1},contains:function(a){for(var b=0;b<this.store.length;++b)if(this.store[b]==a)return!0;return!1},length:function(){return this.size},clear:function(){delete this.store,this.store=[],this.size=this.position=0},list:function(){return this.store},first:function(){this.position=0},last:function(){this.position=this.size-1},previous:function(){this.position>0&&--this.position},next:function(){this.position<this.size-1&&++this.position},currentPosition:function(){return this.position},moveTo:function(a){this.position=a},getElement:function(){return this.store[this.position]}},a.create=function(){return new a},a}()},j={toType:function(a){return{}.toString.call(a).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},toJson:function(){return""},toObject:function(){return{}}},k={inherits:function(a,b){return a.prototype=new b,a.constructor=a,a},extend:function(a,b){for(var c in b){var d=Object.getOwnPropertyDescriptor(b,c);d?Object.defineProperty(a,c,d):a[c]=b[c]}return this},merge:function(a,b){for(var c in b)a.hasOwnProperty[c]||(a[c]=b[c]);return a},restrict:function(a,b){for(var c in a)c in b||delete a[c];return a},subtract:function(a,b){for(var c in b)delete a[c];return a},union:function(a,b){return k.extend(k.extend({},a),b)},intersection:function(a,b){return k.restrict(k.extend({},a),b)},keys:function(a){if("object"!=typeof a)throw typeError();var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},event:function(){function a(){this.listeners={}}return a.prototype.listen=function(a,b){(this.listeners[a]=this.listeners[a]||[]).push(b)},a.prototype.notify=function(a,b){if(void 0!==this.listeners[a])for(var c in this.listeners[a])this.listeners[a][c].call(this,b)},a.prototype.unListen=function(a,b){if(void 0!==this.listeners[a]){var c=this.listeners[a].indexOf(b);-1!==c&&this.listeners[a].splice(c,1)}},a.create=function(){return new a},a}(),mediator:function(){var a={},b=function(b,c){return a[b]||(a[b]=[]),a[b].push({context:this,callback:c}),this},c=function(b){if(!a[b])return!1;for(var c=Array.prototype.slice.call(arguments,1),d=0,e=a[b].length;e>d;d++){var f=a[b][d];f.callback.apply(f.context,c)}return this};return{publish:c,subscribe:b,installTo:function(a){a.subscribe=b,a.publish=c}}}()};b.thread=c,b.math=d,b.string=g,b.array=f,b.graphic=h,b.data=i,b.date=e,b.object=k,b.conversion=j});