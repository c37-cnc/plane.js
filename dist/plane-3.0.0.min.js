/*!
 * C37 in 05-07-2014 at 11:50:13 
 *
 * plane version: 3.0.0
 * licensed by Creative Commons Attribution-ShareAlike 3.0
 *
 * Copyright - C37 http://c37.co - 2014
 */
!function(a){"use strict";var b,c;!function(){var a={},d={};b=function(b,c,d){a[b]={deps:c,callback:d}},c=function(b){if(d[b])return d[b];d[b]={};var e=a[b];if(!e)throw new Error("Module '"+b+"' not found.");for(var f,g=e.deps,h=e.callback,i=[],j=0,k=g.length;k>j;j++)i.push("require"===g[j]?c:"exports"===g[j]?f={}:c(g[j]));var l=h.apply(this,i);return d[b]=f||l}}(),b("geometric/bÃ©zier",["require","exports"],function(){}),b("geometric/group",["require","exports"],function(){}),b("geometric/intersection",["require","exports"],function(a,b){function c(a,b){var c=a[0]*b[1]-b[0]*a[1],d=a[0]*b[2]-b[0]*a[2],e=a[0]*b[3]-b[0]*a[3],f=a[0]*b[4]-b[0]*a[4],g=a[0]*b[5]-b[0]*a[5],h=a[1]*b[2]-b[1]*a[2],j=a[1]*b[4]-b[1]*a[4],k=a[1]*b[5]-b[1]*a[5],l=a[2]*b[3]-b[2]*a[3],m=a[3]*b[4]-b[3]*a[4],n=a[3]*b[5]-b[3]*a[5],o=k+m,p=j-l;return i.create(c*h-d*d,c*p+e*h-2*d*f,c*o+e*p-f*f-2*d*g,c*n+e*o-2*f*g,e*n-g*g)}function d(a,b,c,d){var e,f=(d.x-c.x)*(d.x-c.x)+(d.y-c.y)*(d.y-c.y),g=2*((d.x-c.x)*(c.x-a.x)+(d.y-c.y)*(c.y-a.y)),h=a.x*a.x+a.y*a.y+c.x*c.x+c.y*c.y-2*(a.x*c.x+a.y*c.y)-b*b,i=g*g-4*f*h;if(0>i)e=!1;else if(0==i)e=!1;else{var j=Math.sqrt(i),k=(-g+j)/(2*f),l=(-g-j)/(2*f);e=(0>k||k>1)&&(0>l||l>1)?0>k&&0>l||k>1&&l>1?!1:!1:!0}return e}function e(a,b,c,e,f){var g=j.create(c.x+f,c.y),h=j.create(c.x+f,c.y+e),i=j.create(c.x,c.y+e),k=j.create(c.x,c.y),l=d(a,b,g,h),m=d(a,b,h,i),n=d(a,b,i,k),o=d(a,b,k,g);return l||m||n||o}function f(a,b,c,d){var e,f=b+d,g=Math.abs(b-d),h=a.distanceTo(c);if(h>f)e=!1;else if(g>h)e=!1;else{e={points:[]};var i=(b*b-d*d+h*h)/(2*h),k=Math.sqrt(b*b-i*i),l=a.interpolationLinear(c,i/h),m=k/h;e.points.push(j.create(l.x-m*(c.y-a.y),l.y+m*(c.x-a.x))),e.points.push(j.create(l.x+m*(c.y-a.y),l.y-m*(c.x-a.x)))}return e}function g(a,b,c,d,e,g,h){var i=f(a,b,c,d);if(i.points)for(var k=e/360*2*Math.PI,l=g/360*2*Math.PI,m=k>l?(k-l)/2:(l-k)/2,n=j.create(c.x+Math.cos(k)*d,c.y+Math.sin(k)*d),o=j.create(c.x+Math.cos(l)*d,c.y+Math.sin(l)*d),p=j.create(c.x+Math.cos(m)*d,h?c.y-Math.sin(m)*d:c.y+Math.sin(m)*d),q=(Math.PI+Math.PI,0);q<=i.points.length-1;q++){var r=i.points[q].distanceTo(c),s=d;if(r>=s-4&&s+4>=r){var t=c.angleTo(n),u=c.angleTo(p),v=c.angleTo(o),w=c.angleTo(i.points[q]);if(u>=t&&v>=u)return w>=t&&v>=w?!0:!1;if(u>=v&&t>=u)return h?w>=v&&t>=w?!0:!1:w>=v&&t>=w?!1:!0;if(u>=t&&u>=v){if(v>t)return h?w>t&&v>w?!1:!0:w>t&&v>w?!0:!1;if(t>v)return w>v&&t>w?!1:!0}else if(t>=u&&v>=u){if(v>t)return h?w>t&&v>w?!1:!0:w>t&&v>w?!0:!1;if(t>v)return w>v&&t>w?!1:!0}}return!1}return!1}function h(a,b,d,e,f,g){for(var h=[b*b,0,d*d,-2*b*b*a.x,-2*d*d*a.y,b*b*a.x*a.x+d*d*a.y*a.y-d*d*b*b],j=[f*f,0,g*g,-2*f*f*e.x,-2*g*g*e.y,f*f*e.x*e.x+g*g*e.y*e.y-g*g*f*f],k=c(h,j),l=k.getRoots(),m=.001,n=(h[0]*h[0]+2*h[1]*h[1]+h[2]*h[2])*m,o=(j[0]*j[0]+2*j[1]*j[1]+j[2]*j[2])*m,p=0;p<l.length;p++)for(var q=i.create(h[0],h[3]+l[p]*h[1],h[5]+l[p]*(h[4]+l[p]*h[2])),r=q.getRoots(),s=0;s<r.length;s++){var t=(h[0]*r[s]+h[1]*l[p]+h[3])*r[s]+(h[2]*l[p]+h[4])*l[p]+h[5];if(Math.abs(t)<n&&(t=(j[0]*r[s]+j[1]*l[p]+j[3])*r[s]+(j[2]*l[p]+j[4])*l[p]+j[5],Math.abs(t)<o))return!0}return!1}var i=a("geometric/polynomial"),j=a("geometric/point");b.circleLine=d,b.circleRectangle=e,b.circleCircle=f,b.circleArc=g,b.circleEllipse=h}),b("geometric/point",["require","exports"],function(a,b){function c(a,b){this.x=a,this.y=b}function d(a,b){return new c(a,b)}c.prototype={sum:function(a){return new c(this.x+a.x,this.y+a.y)},subtract:function(a){return new c(this.x-a.x,this.y-a.y)},multiply:function(a){return new c(this.x*a,this.y*a)},distanceTo:function(a){var b=this.x-a.x,c=this.y-a.y;return Math.sqrt(b*b+c*c)},midTo:function(a){return new c(this.x+(a.x-this.x)/2,this.y+(a.y-this.y)/2)},angleTo:function(a){return Math.atan2(a.y-this.y,a.x-this.x)},interpolationLinear:function(a,b){return new c(this.x+(a.x-this.x)*b,this.y+(a.y-this.y)*b)}},b.create=d}),b("geometric/polynomial",["require","exports"],function(a,b){function c(a){this.coefs=new Array;for(var b=a.length-1;b>=0;b--)this.coefs.push(a[b]);this._variable="t",this._s=0}function d(){return new c(arguments)}c.prototype.simplify=function(){for(var a=this.getDegree();a>=0&&Math.abs(this.coefs[a])<=c.TOLERANCE;a--)this.coefs.pop()},c.prototype.getDegree=function(){return this.coefs.length-1},c.prototype.getLinearRoot=function(){var a=new Array,b=this.coefs[1];return 0!=b&&a.push(-this.coefs[0]/b),a},c.prototype.getQuadraticRoots=function(){var a=new Array;if(2==this.getDegree()){var b=this.coefs[2],c=this.coefs[1]/b,d=this.coefs[0]/b,e=c*c-4*d;if(e>0){var f=Math.sqrt(e);a.push(.5*(-c+f)),a.push(.5*(-c-f))}else 0==e&&a.push(.5*-c)}return a},c.prototype.getCubicRoots=function(){var a=new Array;if(3==this.getDegree()){var b=this.coefs[3],d=this.coefs[2]/b,e=this.coefs[1]/b,f=this.coefs[0]/b,g=(3*e-d*d)/3,h=(2*d*d*d-9*e*d+27*f)/27,i=d/3,j=h*h/4+g*g*g/27,k=h/2;if(Math.abs(j)<=c.TOLERANCE&&(j=0),j>0){var l,m,n=Math.sqrt(j);l=-k+n,m=l>=0?Math.pow(l,1/3):-Math.pow(-l,1/3),l=-k-n,l>=0?m+=Math.pow(l,1/3):m-=Math.pow(-l,1/3),a.push(m-i)}else if(0>j){var o=Math.sqrt(-g/3),p=Math.atan2(Math.sqrt(-j),-k)/3,q=Math.cos(p),r=Math.sin(p),s=Math.sqrt(3);a.push(2*o*q-i),a.push(-o*(q+s*r)-i),a.push(-o*(q-s*r)-i)}else{var l;l=k>=0?-Math.pow(k,1/3):Math.pow(-k,1/3),a.push(2*l-i),a.push(-l-i)}}return a},c.prototype.getQuarticRoots=function(){var a=new Array;if(4==this.getDegree()){var b=this.coefs[4],e=this.coefs[3]/b,f=this.coefs[2]/b,g=this.coefs[1]/b,h=this.coefs[0]/b,i=d(1,-f,e*g-4*h,-e*e*h+4*f*h-g*g).getCubicRoots(),j=i[0],k=e*e/4-f+j;if(Math.abs(k)<=c.TOLERANCE&&(k=0),k>0){var l=Math.sqrt(k),m=3*e*e/4-l*l-2*f,n=(4*e*f-8*g-e*e*e)/(4*l),o=m+n,p=m-n;if(Math.abs(o)<=c.TOLERANCE&&(o=0),Math.abs(p)<=c.TOLERANCE&&(p=0),o>=0){var q=Math.sqrt(o);a.push(-e/4+(l+q)/2),a.push(-e/4+(l-q)/2)}if(p>=0){var q=Math.sqrt(p);a.push(-e/4+(q-l)/2),a.push(-e/4-(q+l)/2)}}else if(0>k);else{var n=j*j-4*h;if(n>=-c.TOLERANCE){if(0>n&&(n=0),n=2*Math.sqrt(n),m=3*e*e/4-2*f,m+n>=c.TOLERANCE){var r=Math.sqrt(m+n);a.push(-e/4+r/2),a.push(-e/4-r/2)}if(m-n>=c.TOLERANCE){var r=Math.sqrt(m-n);a.push(-e/4+r/2),a.push(-e/4-r/2)}}}}return a},c.prototype.getRoots=function(){var a;switch(this.simplify(),this.getDegree()){case 0:a=new Array;break;case 1:a=this.getLinearRoot();break;case 2:a=this.getQuadraticRoots();break;case 3:a=this.getCubicRoots();break;case 4:a=this.getQuarticRoots();break;default:a=new Array}return a},b.create=d}),b("geometric/shape",["require","exports"],function(a,b){function c(){}function d(a){var b=h.math.uuid(9,16);switch(a=h.object.merge({uuid:b,name:"shape ".concat(b),style:null,status:null},a),a.type){case"line":return a.points=[i.create(a.x[0],a.x[1]),i.create(a.y[0],a.y[1])],new n(a);case"rectangle":return a.point=i.create(a.x,a.y),a.height=a.height,a.width=a.width,new q(a);case"arc":return a.point=i.create(a.x,a.y),a.radius=a.radius,a.startAngle=a.startAngle,a.endAngle=a.endAngle,a.clockWise=a.clockWise,new k(a);case"circle":return a.point=i.create(a.x,a.y),a.radius=a.radius,new l(a);case"ellipse":return a.point=i.create(a.x,a.y),a.radiusY=a.radiusY,a.radiusX=a.radiusX,new m(a);case"polygon":a.point=i.create(a.x,a.y),a.points=[];for(var c=0;c<a.sides;c++){var d=a.radius*Math.cos(2*Math.PI/a.sides*c)+a.point.x,e=a.radius*Math.sin(2*Math.PI/a.sides*c)+a.point.y;a.points.push(i.create(d,e))}return new o(a);case"polyline":for(var c=0;c<a.points.length;c++)a.points[c]=i.create(a.points[c].x,a.points[c].y);return new p(a)}}function e(){}function f(){}function g(){}var h=a("utility/types"),i=a("geometric/point"),j=a("geometric/intersection");c.prototype={rotateTo:function(){return!0},scaleTo:function(a){switch(this.type){case"arc":this.point.x*=a,this.point.y*=a,this.radius*=a;break;case"circle":this.point.x*=a,this.point.y*=a,this.radius*=a;break;case"ellipse":this.point.x*=a,this.point.y*=a,this.radiusX*=a,this.radiusY*=a;break;case"line":this.points.forEach(function(b){b.x*=a,b.y*=a});break;case"polygon":this.point.x*=a,this.point.y*=a,this.points.forEach(function(b){b.x*=a,b.y*=a});break;case"polyline":this.points.forEach(function(b){b.x*=a,b.y*=a});break;case"rectangle":this.point.x*=a,this.point.y*=a,this.height*=a,this.width*=a}this.Scale=a},moveTo:function(a){if(this.point&&(this.point=this.point.sum(a)),this.points)for(var b=0;b<=this.points.length-1;b++)this.points[b]=this.points[b].sum(a);return!0},contains:function(a){switch(this.type){case"line":var b=this.points[0],c=this.points[1];if(j.circleLine(a,2,b,c))return!0;break;case"rectangle":if(j.circleRectangle(a,2,this.point,this.height,this.width))return!0;break;case"arc":if(j.circleArc(i.create(a.x,a.y),2,this.point,this.radius,this.startAngle,this.endAngle,this.clockWise))return!0;break;case"circle":if(j.circleCircle(a=i.create(a.x,a.y),2,this.point,this.radius))return!0;break;case"ellipse":return j.circleEllipse(a,2,2,this.point,this.radiusY,this.radiusX);case"polygon":for(var b=null,c=null,d=0;d<this.points.length;d++)if(d+1==this.points.length?(b=this.points[d],c=this.points[0]):(b=this.points[d],c=this.points[d+1]),j.circleLine(a,2,b,c))return!0;break;case"polyline":for(var b=null,c=null,d=0;d<this.points.length;d++)if(d+1==this.points.length?(b=this.points[d],c=this.points[0]):(b=this.points[d],c=this.points[d+1]),j.circleLine(a,2,b,c))return!0}return!1},render:function(a,b){switch("over"==this.status&&(a.strokeStyle="rgb(61, 142, 193)"),"selected"==this.status&&(a.strokeStyle="rgb(68, 121, 154)",this.point&&a.strokeRect(this.point.x-Math.round(2*b)/2,this.point.y-Math.round(2*b)/2,Math.round(2*b),Math.round(2*b)),this.points&&this.points.forEach(function(c){a.strokeRect(c.x-Math.round(2*b)/2,c.y-Math.round(2*b)/2,Math.round(2*b),Math.round(2*b))})),this.type){case"arc":return a.translate(this.point.x,this.point.y),a.arc(0,0,this.radius,Math.PI/180*this.startAngle,Math.PI/180*this.endAngle,this.clockWise),!0;case"circle":return a.translate(this.point.x,this.point.y),a.arc(0,0,this.radius,0,2*Math.PI,!0),!0;case"ellipse":return a.translate(this.point.x,this.point.y),a.ellipse(0,0,this.radiusX,this.radiusY,0,0,2*Math.PI),!0;case"line":return"Over"!=this.status&&(a.lineWidth=this.style&&this.style.lineWidth?this.style.lineWidth:a.lineWidth,a.strokeStyle=this.style&&this.style.lineColor?this.style.lineColor:a.strokeStyle),a.moveTo(this.points[0].x,this.points[0].y),a.lineTo(this.points[1].x,this.points[1].y),!0;case"polygon":return a.moveTo(this.points[0].x,this.points[0].y),this.points.forEach(function(b){a.lineTo(b.x,b.y)}),a.closePath(),!0;case"polyline":return a.moveTo(this.points[0].x,this.points[0].y),this.points.forEach(function(b){a.lineTo(b.x,b.y)}),!0;case"rectangle":return a.translate(this.point.x,this.point.y),a.strokeRect(0,0,this.width,this.height),!0}},toObject:function(){switch(this.type){case"arc":return{uuid:this.uuid,type:this.type,name:this.name,status:this.status,x:h.math.parseFloat(this.point.x,5),y:h.math.parseFloat(this.point.y,5),radius:h.math.parseFloat(this.radius,5),startAngle:h.math.parseFloat(this.startAngle,5),endAngle:h.math.parseFloat(this.endAngle,5),clockWise:this.clockWise};case"circle":return{uuid:this.uuid,type:this.type,name:this.name,status:this.status,x:h.math.parseFloat(this.point.x,5),y:h.math.parseFloat(this.point.y,5),radius:h.math.parseFloat(this.radius,5)};case"ellipse":return{uuid:this.uuid,type:this.type,name:this.name,status:this.status,x:h.math.parseFloat(this.point.x,5),y:h.math.parseFloat(this.point.y,5),radiusX:h.math.parseFloat(this.radiusX,5),radiusY:h.math.parseFloat(this.radiusY,5)};case"line":return{uuid:this.uuid,type:this.type,name:this.name,status:this.status,x:[h.math.parseFloat(this.points[0].x,5),h.math.parseFloat(this.points[0].y,5)],y:[h.math.parseFloat(this.points[1].x,5),h.math.parseFloat(this.points[1].y,5)]};case"polygon":return{uuid:this.uuid,type:this.type,name:this.name,status:this.status,x:h.math.parseFloat(this.point.x,5),y:h.math.parseFloat(this.point.y,5),sides:this.sides};case"polyline":return{uuid:this.uuid,type:this.type,name:this.name,status:this.status,points:this.points.map(function(a){return{x:h.math.parseFloat(a.x,5),y:h.math.parseFloat(a.y,5)}})};case"rectangle":return{uuid:this.uuid,type:this.type,name:this.name,status:this.status,x:h.math.parseFloat(this.point.x,5),y:h.math.parseFloat(this.point.y,5),height:h.math.parseFloat(this.height,5),width:h.math.parseFloat(this.width,5)}}}};var k=h.object.inherits(function(a){this.uuid=a.uuid,this.name=a.name,this.status=a.status,this.type="arc",this.point=a.point,this.radius=a.radius,this.startAngle=a.startAngle,this.endAngle=a.endAngle,this.clockWise=a.clockWise},c),l=h.object.inherits(function(a){this.uuid=a.uuid,this.name=a.name,this.status=a.status,this.type="circle",this.point=a.point,this.radius=a.radius},c),m=h.object.inherits(function(a){this.uuid=a.uuid,this.name=a.name,this.status=a.status,this.type="ellipse",this.point=a.point,this.radiusY=a.radiusY,this.radiusX=a.radiusX},c),n=h.object.inherits(function(a){this.uuid=a.uuid,this.name=a.name,this.status=a.status,this.type="line",this.points=a.points,this.style=a.style},c),o=h.object.inherits(function(a){this.uuid=a.uuid,this.name=a.name,this.status=a.status,this.type="polygon",this.point=a.point,this.points=a.points,this.sides=a.sides},c),p=h.object.inherits(function(a){this.uuid=a.uuid,this.name=a.name,this.status=a.status,this.type="polyline",this.points=a.points},c),q=h.object.inherits(function(a){this.uuid=a.uuid,this.name=a.name,this.status=a.status,this.type="rectangle",this.point=a.point,this.height=a.height,this.width=a.width},c);b.create=d,b.remove=e,b.list=f,b.find=g}),b("plane",["require","exports"],function(a,b){function c(a,b,c,e){if(k.settings.gridEnable){if(i)i.shapes.clear();else{var h={viewPort:j,name:"Plane - System",status:"system",style:{backgroundColor:k.settings.backgroundColor}};i=f.create(h)}b=Math.round(c>1?b*c:b/c),a=Math.round(c>1?a*c:a/c);var l=0;if(e.x>0)for(var m=e.x*c;m>=0;m-=10*c){var n=g.create({uuid:d.math.uuid(9,16),type:"line",x:[m,0],y:[m,a],style:{lineColor:k.settings.gridColor,lineWidth:l%5==0?.8:.3}});i.shapes.add(n.uuid,n),l++}l=0;for(var m=e.x*c;b>=m;m+=10*c){var n=g.create({uuid:d.math.uuid(9,16),type:"line",x:[m,0],y:[m,a],style:{lineColor:k.settings.gridColor,lineWidth:l%5==0?.8:.3}});i.shapes.add(n.uuid,n),l++}if(l=0,e.y>0)for(var o=e.y*c;o>=0;o-=10*c){var n=g.create({uuid:d.math.uuid(9,16),type:"line",x:[0,o],y:[b,o],style:{lineColor:k.settings.gridColor,lineWidth:l%5==0?.8:.3}});i.shapes.add(n.uuid,n),l++}l=0;for(var o=e.y*c;a>=o;o+=10*c){var n=g.create({uuid:d.math.uuid(9,16),type:"line",x:[0,o],y:[b,o],style:{lineColor:k.settings.gridColor,lineWidth:l%5==0?.8:.3}});i.shapes.add(n.uuid,n),l++}k.update(i)}}var d=a("utility/types"),e=a("utility/importer"),f=(a("utility/exporter"),a("structure/layer")),g=a("geometric/shape"),h=a("structure/tool"),i=null,j=null,k=d.object.extend(d.object.event.create(),{initialize:function(a){if(null==a)throw new Error("plane - initialize - config is not valid \n http://requirejs.org/docs/errors.html#errorCode");if("function"==typeof a)throw new Error("plane - initialize - config is not valid \n http://requirejs.org/docs/errors.html#errorCode");if(null==a.viewPort)throw new Error("plane - initialize - config is not valid \n http://requirejs.org/docs/errors.html#errorCode");return j=a.viewPort,k.settings=a.settings?a.settings:k.settings,c(j.clientHeight,j.clientWidth,k.zoom,k.scroll),h.event.start({viewPort:j,update:k.update}),!0},update:function(a){var b=a?a.style:f.active().style,c=a?a.shapes.list():f.active().shapes.list(),d=a?a.render:f.active().render,e=d.getContext("2d");return e.clearRect(0,0,j.clientWidth,j.clientHeight),e.lineCap=b.lineCap,e.lineJoin=b.lineJoin,c.forEach(function(a){e.save(),e.beginPath(),a.render(e,k.zoom),e.stroke(),e.restore()}),!0},clear:function(){return(0!=k.scroll.x||0!=k.scroll.y)&&(k.scroll={x:0,y:0}),1!=k.zoom&&(k.zoom=1),f.remove(),!0},layer:d.object.extend(d.object.event.create(),{create:function(a){if("function"==typeof a)throw new Error("layer - create - attrs is not valid \n http://requirejs.org/docs/errors.html#errorCode");return a=d.object.union(a,{viewPort:j}),f.create(a)},list:function(){return f.list()},remove:function(a){f.remove(a)},get active(){return f.active()},set active(a){this.notify("onDeactive",{type:"onDeactive",Layer:f.active()}),f.active(a),this.notify("onActive",{type:"onActive",Layer:f.active()})}}),shape:{create:function(a){if("function"==typeof a||null==a)throw new Error("shape - create - attrs is not valid \n http://requirejs.org/docs/errors.html#errorCode");if(-1==["polyline","polygon","rectangle","line","arc","circle","ellipse"].indexOf(a.type))throw new Error("shape - create - type is not valid \n http://requirejs.org/docs/errors.html#errorCode");if("polyline"!=a.type&&(void 0==a.x||void 0==a.y))throw new Error("shape - create - x and y is not valid \n http://requirejs.org/docs/errors.html#errorCode");var b=g.create(a);return f.active().shapes.add(b.uuid,b),!0}},tool:{create:function(a){if("function"==typeof a)throw new Error("Tool - create - attrs is not valid \n http://requirejs.org/docs/errors.html#errorCode");return h.create(a)}},get zoom(){return this._zoom||1},set zoom(a){var b=f.active(),d=a/k.zoom;c(j.clientHeight,j.clientWidth,a,this.scroll),b&&(f.list().forEach(function(a){f.active(a.uuid),f.active().shapes.list().forEach(function(a){a.scaleTo(d)}),k.update()}),f.active(b.uuid)),this._zoom=a},get scroll(){return this._scroll||{x:0,y:0}},set scroll(a){var b=f.active(),d={x:a.x+this.scroll.x,y:a.y+this.scroll.y};c(j.clientHeight,j.clientWidth,this.zoom,d),b&&(a.x=a.x*this.zoom,a.y=a.y*this.zoom,f.list().forEach(function(b){f.active(b.uuid),f.active().shapes.list().forEach(function(b){b.moveTo(a)}),k.update()}),f.active(b.uuid)),this._scroll=d},get settings(){return this._settings||{metricSystem:"mm",backgroundColor:"rgb(255, 255, 255)",gridEnable:!0,gridColor:"rgb(218, 222, 215)"}},set settings(a){this._settings=a},importer:{fromJson:function(a){var b=JSON.parse(a);return k.clear(),k.settings=b.settings,k.zoom=b.zoom,k.scroll=b.scroll,b.layers.forEach(function(a){f.create({uuid:a.uuid,name:a.name,locked:a.locked,Visible:a.Visible,style:a.style,viewPort:j}),a.shapes.forEach(function(a){k.shape.create(a)}),k.update()}),!0},fromSvg:null,fromDxf:function(a){k.clear();var b=e.fromDxf(a),c=JSON.parse(b.replace(/u,/g,"").replace(/undefined,/g,""));if(b){k.layer.create();for(var d in c)k.shape.create(c[d]);k.update()}},fromDwg:null},exporter:{toJson:function(){var a={settings:k.settings,zoom:d.math.parseFloat(k.zoom,5),scroll:k.scroll,layers:f.list().map(function(a){var b=a.toObject();return b.shapes=b.shapes.map(function(a){return a.toObject()}),b})};return JSON.stringify(a)}}});b.public=k}),b("structure/layer",["require","exports"],function(a,b){function c(a){var b=g.math.uuid(9,16),c=document.createElement("canvas");c.id=g.math.uuid(9,16),c.width=a.viewPort.clientWidth,c.height=a.viewPort.clientHeight,c.style.position="absolute",c.style.backgroundColor="system"==a.status?a.style.backgroundColor:"transparent";var d=c.getContext("2d");d.translate(0,c.height),d.scale(1,-1),a=g.object.merge({uuid:b,name:"New Layer ".concat(b),style:{lineCap:"butt",lineJoin:"miter",lineWidth:.7,lineColor:"rgb(0, 0, 0)"},status:"visible",shapes:g.data.dictionary.create(),render:c},a);var e=new j(a);return a.viewPort.appendChild(e.render),"system"!=e.status?(h.add(e.uuid,e),this.active(e.uuid),!0):e}function d(a){return a?i=h.find(a):i}function e(){h.list().forEach(function(a){var b=document.getElementById(a.render.id);b&&b.parentNode&&b.parentNode.removeChild(b),h.remove(a.uuid)})}function f(){return h.list()}var g=a("utility/types"),h=g.data.dictionary.create(),i=null,j=g.object.inherits(function(a){this.uuid=a.uuid,this.name=a.name,this.status=a.status,this.style=a.style,this.render=a.render,this.shapes=a.shapes},g.object.event);j.prototype.toObject=function(){return{uuid:this.uuid,name:this.name,locked:this.locked,status:this.status,style:this.style,shapes:this.shapes.list()}},b.create=c,b.active=d,b.list=f,b.remove=e}),b("structure/tool",["require","exports"],function(a,b){function c(a){var b=d.math.uuid(9,16);a=d.object.merge({uuid:b,name:"Tool ".concat(b)},a);var c=new j(a);return e.add(c.uuid,c),c}var d=a("utility/types"),e=d.data.dictionary.create(),f=d.data.dictionary.create(),g=a("structure/layer"),h=null,i=null,j=d.object.inherits(function(a){this.uuid=a.uuid,this.name=a.name,Object.defineProperty(this,"active",{get:function(){return this._active||!1},set:function(a){this.notify(a?"onActive":"onDeactive",{type:a?"onActive":"onDeactive",Now:(new Date).toISOString()}),this._active=a}})},d.object.event),k=d.object.extend(d.object.event.create(),{start:function(a){h=a.viewPort,i=a.update,h.onmousemove=function(a){g.active()&&(g.active().shapes.list().forEach(function(b){"selected"!=b.status&&(b.status=b.contains(d.graphic.mousePosition(h,a.clientX,a.clientY))?"over":"out")}),i())},h.onclick=function(a){g.active()&&(g.active().shapes.list().forEach(function(b){b.contains(d.graphic.mousePosition(h,a.clientX,a.clientY))&&(b.status="selected"!=b.status?"selected":"over","selected"==b.status?f.add(b.uuid,b):f.remove(b.uuid))}),i(),e.list().forEach(function(a){a.active&&a.notify("onMouseClick",{type:"onMouseClick",shapes:f.list()})}))}}});b.event=k,b.create=c}),b("utility/exporter",["require","exports"],function(a,b){function c(){return!0}function d(){return!0}function e(){return!0}function f(){return!0}function g(){return!0}b.toJson=c,b.toSvg=d,b.toDxf=e,b.toPng=f,b.toPdf=g}),b("utility/importer",["require","exports"],function(a,b){function c(a){function b(a){switch(a.type){case"LINE":var b='{ "type": "line", "x": [{0}, {1}], "y": [{2}, {3}] }';return g.string.format(b,[a.x,a.y,a.x1,a.y1]);case"CIRCLE":var c='{ "type": "circle", "x": {0}, "y": {1}, "radius": {2} }';return g.string.format(c,[a.x,a.y,a.r]);case"ARC":var d='{"type": "arc", "x": {0}, "y": {1}, "radius": {2},"startAngle": {3}, "endAngle": {4}, "clockWise": {5} }';return g.string.format(d,[a.x,a.y,a.r,a.a0,a.a1,!1]);case"ELLIPSE":var e='{"type": "ellipse", "x": {0}, "y": {1}, "radiusY": {2},"radiusX": {3} }',f=Math.abs(a.x1),h=f*a.r;return g.string.format(e,[a.x,a.y,h,f]);case"LWPOLYLINE":if(a.vertices){for(var i='{"type": "polyline", "points": [{0}]}',j="",k=0;k<a.vertices.length;k++){var l=k==a.vertices.length-1?'{"x": {0}, "y": {1}}':'{"x": {0}, "y": {1}},';j+=g.string.format(l,[a.vertices[k].x,a.vertices[k].y])}return g.string.format(i,[j])}}}var c={0:"entitytype",2:"blockname",10:"x",11:"x1",20:"y",21:"y1",40:"r",50:"a0",51:"a1"},d=["LINE","CIRCLE","ARC","ELLIPSE","LWPOLYLINE"],e=0,f=null,h=!1,i={},j="[";return a=a.replace(/\r\n/g,"\n"),a=a.replace(/\r/g,"\n"),a.split("\n").forEach(function(a){if(a=a.trim(),e++%2===0)f=parseInt(a);else{var g=a,k=c[f];"blockname"===k&&"ENTITIES"===g?h=!0:h&&("entitytype"===k?(i.type&&(j+="["==j.substring(j.length-1,j.length)?"":",",j+=b(i)),i=d.indexOf(g)>-1?{type:g}:{},"ENDSEC"===g&&(h=!1)):i.type&&"undefined"!=typeof k&&(i[k]=parseFloat(g),"LWPOLYLINE"==i.type&&"y"===k&&(i.vertices||(i.vertices=[]),i.vertices.push({x:i.x,y:i.y}))))}}),j+="]"}function d(){return!0}function e(){return!0}function f(){return!0}var g=a("utility/types");b.fromDxf=c,b.fromDwg=d,b.fromJson=e,b.fromSvg=f}),b("utility/types",["require","exports"],function(a,b){var c={uuid:function(a,b){var c,d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),e=[];if(b=b||d.length,a)for(c=0;a>c;c++)e[c]=d[0|Math.random()*b];else{var f;for(e[8]=e[13]=e[18]=e[23]="-",e[14]="4",c=0;36>c;c++)e[c]||(f=0|16*Math.random(),e[c]=d[19==c?3&f|8:f])}return e.join("").toLowerCase()},parseFloat:function(a,b){return Number(parseFloat(a).toFixed(b))}},d={format:function(a,b){return a.replace(/{(\d+)}/g,function(a,c){return"undefined"!=typeof b[c]?b[c]:a})},contains:function(){return-1!==String.prototype.indexOf.apply(this,arguments)}},e={mousePosition:function(a,b,c){var d=a.getBoundingClientRect();return b=(b-d.left)*(a.clientWidth/d.width),c=(c-d.top)*(a.clientHeight/d.height),c=-1*(c-a.clientHeight),{x:b,y:c}}},f={dictionary:function(){function a(){this.store=[]}return a.prototype={add:function(a,b){this.store[a]=b},find:function(a){return this.store[a]},remove:function(a){delete this.store[a]},count:function(){return Object.keys(this.store).length},clear:function(){return this.store=new Array},list:function(){var a=this;return Object.keys(this.store).map(function(b){return a.store[b]})}},a.create=function(){return new a},a}()},g={inherits:function(a,b){return a.prototype=new b,a},extend:function(a,b){for(var c in b)Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c));return a},merge:function(a,b){for(var c in b)a.hasOwnProperty[c]||(a[c]=b[c]);return a},restrict:function(a,b){for(var c in a)c in b||delete a[c];return a},subtract:function(a,b){for(var c in b)delete a[c];return a},union:function(a,b){return g.extend(g.extend({},a),b)},intersection:function(a,b){return g.restrict(g.extend({},a),b)},keys:function(a){if("object"!=typeof a)throw typeError();var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},event:function(){function a(){this.listeners={}}return a.prototype.listen=function(a,b){(this.listeners[a]=this.listeners[a]||[]).push(b)},a.prototype.notify=function(a,b){if(void 0!==this.listeners[a])for(var c in this.listeners[a])this.listeners[a][c].call(this,b)},a.prototype.unListen=function(a,b){if(void 0!==this.listeners[a]){var c=this.listeners[a].indexOf(b);-1!==c&&this.listeners[a].splice(c,1)}},a.create=function(){return new a},a}()};b.math=c,b.string=d,b.graphic=e,b.data=f,b.object=g}),a.plane=c("plane").public}(window);