/*!
 * C37 in 22-06-2014 at 07:53:53 
 *
 * plane version: 3.0.0
 * licensed by Creative Commons Attribution-ShareAlike 3.0
 *
 * Copyright - C37 http://c37.co - 2014
 */
!function(a){"use strict";var b,c;!function(){var a={},d={};b=function(b,c,d){a[b]={deps:c,callback:d}},c=function(b){if(d[b])return d[b];d[b]={};var e=a[b];if(!e)throw new Error("Module '"+b+"' not found.");for(var f,g=e.deps,h=e.callback,i=[],j=0,k=g.length;k>j;j++)i.push("require"===g[j]?c:"exports"===g[j]?f={}:c(g[j]));var l=h.apply(this,i);return d[b]=f||l}}(),b("geometric/group",["require","exports"],function(){}),b("geometric/intersection",["require","exports"],function(a,b){function c(a,b){var c=a[0]*b[1]-b[0]*a[1],d=a[0]*b[2]-b[0]*a[2],e=a[0]*b[3]-b[0]*a[3],f=a[0]*b[4]-b[0]*a[4],g=a[0]*b[5]-b[0]*a[5],h=a[1]*b[2]-b[1]*a[2],j=a[1]*b[4]-b[1]*a[4],k=a[1]*b[5]-b[1]*a[5],l=a[2]*b[3]-b[2]*a[3],m=a[3]*b[4]-b[3]*a[4],n=a[3]*b[5]-b[3]*a[5],o=k+m,p=j-l;return new i(c*h-d*d,c*p+e*h-2*d*f,c*o+e*p-f*f-2*d*g,c*n+e*o-2*f*g,e*n-g*g)}function d(a,b,c,d){var e,f=(d.x-c.x)*(d.x-c.x)+(d.y-c.y)*(d.y-c.y),g=2*((d.x-c.x)*(c.x-a.x)+(d.y-c.y)*(c.y-a.y)),h=a.x*a.x+a.y*a.y+c.x*c.x+c.y*c.y-2*(a.x*c.x+a.y*c.y)-b*b,i=g*g-4*f*h;if(0>i)e=!1;else if(0==i)e=!1;else{var k=j.sqrt(i),l=(-g+k)/(2*f),m=(-g-k)/(2*f);e=(0>l||l>1)&&(0>m||m>1)?0>l&&0>m||l>1&&m>1?!1:!1:!0}return e}function e(a,b,c,d,e){var f=Point.Create(c.x+e,c.y),g=Point.Create(c.x+e,c.y+d),h=Point.Create(c.x,c.y+d),i=Point.Create(c.x,c.y),j=this.circleLine(a,b,f,g),k=this.circleLine(a,b,g,h),l=this.circleLine(a,b,h,i),m=this.circleLine(a,b,i,f);return j||k||l||m}function f(a,b,c,d){var e,f=b+d,g=j.abs(b-d),h=a.distanceTo(c);if(h>f)e=!1;else if(g>h)e=!1;else{e={points:[]};var i=(b*b-d*d+h*h)/(2*h),k=j.sqrt(b*b-i*i),l=a.interpolationLinear(c,i/h),m=k/h;e.points.push(Point.Create(l.x-m*(c.y-a.y),l.y+m*(c.x-a.x))),e.points.push(Point.Create(l.x+m*(c.y-a.y),l.y-m*(c.x-a.x)))}return e}function g(a,b,c,d,e,f,g){var h=this.circleCircle(a,b,c,d);if(h.points)for(var i=e/360*2*j.PI,k=f/360*2*j.PI,l=i>k?(i-k)/2:(k-i)/2,m=Point.Create(c.x+j.cos(i)*d,c.y+j.sin(i)*d),n=Point.Create(c.x+j.cos(k)*d,c.y+j.sin(k)*d),o=Point.Create(c.x+j.cos(l)*d,g?c.y-j.sin(l)*d:c.y+j.sin(l)*d),p=(j.PI+j.PI,0);p<=h.points.length-1;p++){var q=h.points[p].distanceTo(c),r=d;if(q>=r-4&&r+4>=q){var s=c.angleTo(m),t=c.angleTo(o),u=c.angleTo(n),v=c.angleTo(h.points[p]);if(t>=s&&u>=t)return g?v>=s&&u>=v?!0:!1:v>=s&&u>=v?!1:!0;if(t>=u&&s>=t)return g?v>=u&&s>=v?!0:!1:v>=u&&s>=v?!1:!0;if(t>=s&&t>=u){if(u>s)return g?v>s&&u>v?!1:!0:v>s&&u>v?!0:!1;if(s>u)return v>u&&s>v?!1:!0}else if(s>=t&&u>=t){if(u>s)return g?v>s&&u>v?!1:!0:v>s&&u>v?!0:!1;if(s>u)return v>u&&s>v?!1:!0}}return!1}return!1}function h(a,b,d,e,f,g){for(var h=[b*b,0,d*d,-2*b*b*a.x,-2*d*d*a.y,b*b*a.x*a.x+d*d*a.y*a.y-d*d*b*b],i=[f*f,0,g*g,-2*f*f*e.x,-2*g*g*e.y,f*f*e.x*e.x+g*g*e.y*e.y-g*g*f*f],k=c(h,i),l=k.getRoots(),m=.001,n=(h[0]*h[0]+2*h[1]*h[1]+h[2]*h[2])*m,o=(i[0]*i[0]+2*i[1]*i[1]+i[2]*i[2])*m,p=0;p<l.length;p++)for(var q=new utility.geometry.polynomial(h[0],h[3]+l[p]*h[1],h[5]+l[p]*(h[4]+l[p]*h[2])),r=q.getRoots(),s=0;s<r.length;s++){var t=(h[0]*r[s]+h[1]*l[p]+h[3])*r[s]+(h[2]*l[p]+h[4])*l[p]+h[5];if(j.abs(t)<n&&(t=(i[0]*r[s]+i[1]*l[p]+i[3])*r[s]+(i[2]*l[p]+i[4])*l[p]+i[5],j.abs(t)<o))return!0}return!1}var i=a("geometric/polynomial").Polynomial,j=Math;b.CircleLine=d,b.CircleRectangle=e,b.CircleCircle=f,b.CircleArc=g,b.CircleEllipse=h}),b("geometric/point",["require","exports"],function(a,b){function c(a,b){this.x=a,this.y=b}function d(a,b){return new c(a,b)}var e=Math;c.prototype={Operations:{Sum:function(a){return new c(this.x+a.x,this.y+a.y)},Subtract:function(a){return new c(this.x-a.x,this.y-a.y)}},Measures:{DistanceTo:function(a){var b=this.x-a.x,c=this.y-a.y;return e.sqrt(b*b+c*c)},MidTo:function(a){return new c(this.x+(a.x-this.x)/2,this.y+(a.y-this.y)/2)},AngleTo:function(a){return e.atan2(a.y-this.y,a.x-this.x)}},Functions:{InterpolationLinear:function(a,b){return new c(this.x+(a.x-this.x)*b,this.y+(a.y-this.y)*b)}}},b.Create=d}),b("geometric/polynomial",["require","exports"],function(a,b){function c(){this.init(arguments)}c.prototype.init=function(a){this.coefs=new Array;for(var b=a.length-1;b>=0;b--)this.coefs.push(a[b]);this._variable="t",this._s=0},c.prototype.simplify=function(){for(var a=this.getDegree();a>=0&&Math.abs(this.coefs[a])<=c.TOLERANCE;a--)this.coefs.pop()},c.prototype.getDegree=function(){return this.coefs.length-1},c.prototype.getLinearRoot=function(){var a=new Array,b=this.coefs[1];return 0!=b&&a.push(-this.coefs[0]/b),a},c.prototype.getQuadraticRoots=function(){var a=new Array;if(2==this.getDegree()){var b=this.coefs[2],c=this.coefs[1]/b,d=this.coefs[0]/b,e=c*c-4*d;if(e>0){var f=Math.sqrt(e);a.push(.5*(-c+f)),a.push(.5*(-c-f))}else 0==e&&a.push(.5*-c)}return a},c.prototype.getCubicRoots=function(){var a=new Array;if(3==this.getDegree()){var b=this.coefs[3],d=this.coefs[2]/b,e=this.coefs[1]/b,f=this.coefs[0]/b,g=(3*e-d*d)/3,h=(2*d*d*d-9*e*d+27*f)/27,i=d/3,j=h*h/4+g*g*g/27,k=h/2;if(Math.abs(j)<=c.TOLERANCE&&(j=0),j>0){var l,m,n=Math.sqrt(j);l=-k+n,m=l>=0?Math.pow(l,1/3):-Math.pow(-l,1/3),l=-k-n,l>=0?m+=Math.pow(l,1/3):m-=Math.pow(-l,1/3),a.push(m-i)}else if(0>j){var o=Math.sqrt(-g/3),p=Math.atan2(Math.sqrt(-j),-k)/3,q=Math.cos(p),r=Math.sin(p),s=Math.sqrt(3);a.push(2*o*q-i),a.push(-o*(q+s*r)-i),a.push(-o*(q-s*r)-i)}else{var l;l=k>=0?-Math.pow(k,1/3):Math.pow(-k,1/3),a.push(2*l-i),a.push(-l-i)}}return a},c.prototype.getQuarticRoots=function(){var a=new Array;if(4==this.getDegree()){var b=this.coefs[4],d=this.coefs[3]/b,e=this.coefs[2]/b,f=this.coefs[1]/b,g=this.coefs[0]/b,h=new c(1,-e,d*f-4*g,-d*d*g+4*e*g-f*f).getCubicRoots(),i=h[0],j=d*d/4-e+i;if(Math.abs(j)<=c.TOLERANCE&&(j=0),j>0){var k=Math.sqrt(j),l=3*d*d/4-k*k-2*e,m=(4*d*e-8*f-d*d*d)/(4*k),n=l+m,o=l-m;if(Math.abs(n)<=c.TOLERANCE&&(n=0),Math.abs(o)<=c.TOLERANCE&&(o=0),n>=0){var p=Math.sqrt(n);a.push(-d/4+(k+p)/2),a.push(-d/4+(k-p)/2)}if(o>=0){var p=Math.sqrt(o);a.push(-d/4+(p-k)/2),a.push(-d/4-(p+k)/2)}}else if(0>j);else{var m=i*i-4*g;if(m>=-c.TOLERANCE){if(0>m&&(m=0),m=2*Math.sqrt(m),l=3*d*d/4-2*e,l+m>=c.TOLERANCE){var q=Math.sqrt(l+m);a.push(-d/4+q/2),a.push(-d/4-q/2)}if(l-m>=c.TOLERANCE){var q=Math.sqrt(l-m);a.push(-d/4+q/2),a.push(-d/4-q/2)}}}}return a},c.prototype.getRoots=function(){var a;switch(this.simplify(),this.getDegree()){case 0:a=new Array;break;case 1:a=this.getLinearRoot();break;case 2:a=this.getQuadraticRoots();break;case 3:a=this.getCubicRoots();break;case 4:a=this.getQuarticRoots();break;default:a=new Array}return a},b.Polynomial=c}),b("geometric/shape",["require","exports"],function(a,b){function c(a,b,c,d,e){this.uuid=a,this.name=b,this.locked=c,this.visible=d,this.selected=e}function d(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o={uuid:a,name:"Shape ".concat(a),style:e,locked:!1,visible:!0,selected:!1};switch(b){case"line":return o.points=[Point.Create(c[0],c[1]),Point.Create(d[0],d[1])],new Line(o);case"rectangle":return o.point=Point.Create(c,d),o.height=k,o.width=l,new Rectangle(o);case"arc":return o.point=Point.Create(c,d),o.radius=f,o.startAngle=g,o.endAngle=h,o.clockWise=i,new Arc(o);case"circle":return o.point=Point.Create(c,d),o.radius=f,new Circle(o);case"ellipse":return o.point=Point.Create(c,d),o.radiusY=m,o.radiusX=n,new Ellipse(o);case"polygon":o.points=[],o.sides=j;for(var p=0;j>p;p++){var q=f*math.cos(2*math.PI/j*p)+c,r=f*math.sin(2*math.PI/j*p)+d;o.points.push(Point.Create(q,r))}return new Polygon(o)}}c.prototype={rotate:function(){return!0},scale:function(){return this},move:function(){return!0},contains:function(){return!1},toJson:function(){return JSON.stringify(this)}},b.Create=d}),b("plane",["require","exports"],function(a,b){var c=a("utility/object"),d=a("utility/types"),e=a("structure/tools").ToolsProxy,f=(new d.Data.Dictionary,null),g=null,h=ObjectUtil.Extend(new ObjectUtil.Event,{Initialize:function(a){if(null==a)throw new Error("Plane - Initialize - Config is not valid \n http://requirejs.org/docs/errors.html#errorCode");if("function"==typeof a)throw new Error("Plane - Initialize - Config is not valid \n http://requirejs.org/docs/errors.html#errorCode");if(null==a.viewPort)throw new Error("Plane - Initialize - Config is not valid \n http://requirejs.org/docs/errors.html#errorCode");return f=a.viewPort,g=c.Merge({metricSystem:"mm",backgroundColor:"rgb(255, 255, 255)",gridEnable:!0,gridColor:"rgb(218, 222, 215)"},a.settings||{}),f.onmousemove=function(a){e.notify("onMouseMove",a)},f.onclick=function(a){e.notify("onClick",a)},!0}});b.PlaneProxy=h}),b("shapes/arc",["require","exports"],function(a,b){var c=a("geometric/shape").Shape,d=function(a){function b(b){this.type="arc",this.point=b.point,this.radius=b.radius,this.startAngle=b.startAngle,this.endAngle=b.endAngle,this.clockWise=b.clockWise,a.call(this,b.uuid,b.name,b.locked,b.visible,b.selected)}return b.prototype=c.prototype,b}(c);b.Arc=d}),b("geometric/b√©zier",["require","exports"],function(a,b){var c=function(){alert("f001 - b")};b.f001=c}),b("shapes/circle",["require","exports"],function(a,b){var c=a("geometric/shape").Shape,d=function(a){function b(b){this.type="circle",this.point=b.point,this.radius=b.radius,a.call(this,b.uuid,b.name,b.locked,b.visible,b.selected)}return b.prototype=c.prototype,b}(c);b.Circle=d}),b("shapes/ellipse",["require","exports"],function(a,b){var c=a("geometric/shape").Shape,d=function(a){function b(b){this.type="ellipse",this.point=b.point,this.radiusY=b.radiusY,this.radiusX=b.radiusX,a.call(this,b.uuid,b.name,b.locked,b.visible,b.selected)}return b.prototype=c.prototype,b}(c);b.Ellipse=d}),b("shapes/line",["require","exports"],function(a,b){var c=a("geometric/shape").Shape,d=function(a){function b(b){this.type="line",this.points=b.points,this.style=b.style,a.call(this,b.uuid,b.name,b.locked,b.visible,b.selected)}return b.prototype=c.prototype,b}(c);b.Line=d}),b("shapes/polygon",["require","exports"],function(a,b){var c=a("geometric/shape").Shape,d=function(a){function b(b){this.type="polygon",this.points=b.points,this.sides=b.sides,a.call(this,b.uuid,b.name,b.locked,b.visible,b.selected)}return b.prototype=c.prototype,b}(c);b.Polygon=d}),b("shapes/rectangle",["require","exports"],function(a,b){var c=a("geometric/shape").Shape,d=function(a){function b(b){this.type="rectangle",this.point=b.point,this.height=b.height,this.width=b.width,a.call(this,b.uuid,b.name,b.locked,b.visible,b.selected)}return b.prototype=c.prototype,b}(c);b.Rectangle=d}),b("structure/layer",["require","exports"],function(a,b){function c(a){this.uuid=a.uuid,this.name=a.name,this.locked=a.locked,this.visible=a.visible,this.system=a.system,this.style=a.style}function d(a,b,d,e){var f={uuid:a,name:b,style:d,locked:!1,visible:!0,system:e};return new c(f)}var e=a("utility/object");c.prototype=new e.Event,c.prototype.toJson=function(){return JSON.stringify(this).replace(/_/g,"")},b.Create=d}),b("structure/render",["require","exports"],function(a,b){function c(a,b,c,d){var e=document.createElement("canvas");e.width=b,e.height=c,e.style.position="absolute",e.style.backgroundColor=d||"transparent";var f=e.getContext("2d");return f.translate(0,e.height),f.scale(1,-1),e}function d(){var a=layerFacade.Active.uuid,b=layerFacade.Active.style,c=shapeStore[a].list(),d=renderStore[a],e=d.getContext("2d");e.clearRect(0,0,d.width,d.height),e.translate(planeFacade.center.x,planeFacade.center.y),e.lineCap=b.lineCap,e.lineJoin=b.lineJoin,c.forEach(function(a){switch(e.save(),e.beginPath(),e.lineWidth=a.style&&a.style.lineWidth?a.style.lineWidth:b.lineWidth,e.strokeStyle=a.style&&a.style.lineColor?a.style.lineColor:b.lineColor,a.type){case"line":e.moveTo(a.points[0].x,a.points[0].y),e.lineTo(a.points[1].x,a.points[1].y);break;case"rectangle":e.translate(a.point.x,a.point.y),e.strokeRect(0,0,a.width,a.height);break;case"arc":e.translate(a.point.x,a.point.y),e.arc(0,0,a.radius,math.PI/180*a.startAngle,math.PI/180*a.endAngle,a.clockWise);break;case"circle":e.translate(a.point.x,a.point.y),e.arc(0,0,a.radius,0,2*math.PI,!0);break;case"ellipse":e.translate(a.point.x,a.point.y),e.ellipse(0,0,a.radiusX,a.radiusY,0,0,2*math.PI);break;case"polygon":e.moveTo(a.points[0].x,a.points[0].y),a.points.forEach(function(a){e.lineTo(a.x,a.y)}),e.closePath()}e.stroke(),e.restore()})}b.Create=c,b.Update=d}),b("structure/shape",["require","exports"],function(){}),b("structure/tools",["require","exports"],function(a,b){function c(a){this.uuid=a.uuid,this.name=a.name,this.__defineGetter__("active",function(){return this._active||!1}),this.__defineSetter__("active",function(a){this.notify(a?"onActive":"onDeactive",{type:a?"onActive":"onDeactive",now:(new Date).toISOString()}),this._active=a}),utility.object.event.call(this)}var d=a("utility/object"),e=a("utility/types"),f=a("utility/math"),g=new e.Data.Dictionary;c.prototype=d.Event.prototype;var h=d.Extend(new d.Event,{Create:function(a){if("function"==typeof a)throw new Error("Tool - Create - Attrs is not valid \n http://requirejs.org/docs/errors.html#errorCode");a=Object.Merge({uuid:f.Uuid(9,16),name:"Tool ".concat(g.count())},a);var b=c.Create(a.uuid,a.name);return toolStore.add(a.uuid,b),!0}});b.ToolsProxy=h}),b("utility/export",["require","exports"],function(a,b){function c(){return!0}function d(){return!0}function e(){return!0}function f(){return!0}function g(){return!0}b.ToJson=c,b.ToSvg=d,b.ToDxf=e,b.ToPng=f,b.ToPdf=g}),b("utility/graphic",["require","exports"],function(a,b){function c(a,b){var c=a.getBoundingClientRect(),d=(b.x-c.left)*(a.clientWidth/c.width),e=(b.y-c.top)*(a.clientHeight/c.height);return e=-1*(e-a.clientHeight),{x:d,y:e}}b.MousePosition=c}),b("utility/import",["require","exports"],function(a,b){function c(a){function b(a){switch(a.type){case"LINE":var b='{ "type": "line", "x": [{0}, {1}], "y": [{2}, {3}] }';return b.format(a.x,a.y,a.x1,a.y1);case"CIRCLE":var c='{ "type": "circle", "x": {0}, "y": {1}, "radius": {2} }';return c.format(a.x,a.y,a.r);case"ARC":var d='{"type": "arc", "x": {0}, "y": {1}, "radius": {2},"startAngle": {3}, "endAngle": {4}, "clockWise": {5} }';return d.format(a.x,a.y,a.r,a.a0,a.a1,!1);case"ELLIPSE":var e='{"type": "ellipse", "x": {0}, "y": {1}, "radiusY": {2},"radiusX": {3} }',f=math.abs(a.x1),g=f*a.r;return e.format(a.x,a.y,g,f)}}var c={0:"entityType",2:"blockName",10:"x",11:"x1",20:"y",21:"y1",40:"r",50:"a0",51:"a1"},d=["LINE","CIRCLE","ARC","ELLIPSE"],e=0,f=null,g=!1,h={},i="[";return a=a.replace(/\r\n/g,"\n"),a=a.replace(/\r/g,"\n"),a.split("\n").forEach(function(a){if(a=a.trim(),e++%2===0)f=parseInt(a);else{var j=a,k=c[f];"blockName"===k&&"ENTITIES"===j?g=!0:g&&("entityType"===k?(h.type&&(i+="["==i.substring(i.length-1,i.length)?"":",",i+=b(h)),h=d.indexOf(j)>-1?{type:j}:{},"ENDSEC"===j&&(g=!1)):h.type&&"undefined"!=typeof k&&(h[k]=parseFloat(j)))}}),i+="]"}function d(){return!0}function e(){return!0}function f(){return!0}b.FromDxf=c,b.FromDwg=d,b.FromJson=e,b.FromSvg=f}),b("utility/math",["require","exports"],function(a,b){function c(a,b){var c,d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),e=[];if(b=b||d.length,a)for(c=0;a>c;c++)e[c]=d[0|Math.random()*b];else{var f;for(e[8]=e[13]=e[18]=e[23]="-",e[14]="4",c=0;36>c;c++)e[c]||(f=0|16*Math.random(),e[c]=d[19==c?3&f|8:f])}return e.join("").toLowerCase()}b.Uuid=c}),b("utility/object",["require","exports"],function(a,b){function c(a,b){for(var c in b)a[c]=b[c];return a}function d(a,b){for(var c in b)a.hasOwnProperty[c]||(a[c]=b[c]);return a}function e(a,b){for(var c in a)c in b||delete a[c];return a}function f(a,b){for(var c in b)delete a[c];return a}function g(a,b){return extend(extend({},a),b)}function h(a,b){return restrict(extend({},a),b)}function i(a){if("object"!=typeof a)throw TypeError();var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b}function j(){this.listeners={}}j.prototype.listen=function(a,b){void 0===this.listeners[a]&&(this.listeners[a]=[]),this.listeners[a].push(b)},j.prototype.notify=function(a,b){if(void 0!==this.listeners[a])for(var c in this.listeners[a])this.listeners[a][c].call(this,b)},j.prototype.unlisten=function(a,b){if(void 0!==this.listeners[a]){var c=this.listeners[a].indexOf(b);-1!==c&&this.listeners[a].splice(c,1)}},b.Extend=c,b.Merge=d,b.Restrict=e,b.Subtract=f,b.Union=g,b.Intersection=h,b.Keys=i,b.Event=j}),b("utility/types",["require","exports"],function(a,b){var c={Format:function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,c){return"undefined"!=typeof a[c]?a[c]:b})},Contains:function(){return-1!==c.prototype.indexOf.apply(this,arguments)}},d={Dictionary:function(){function a(){this.store=new Array}return a.prototype={add:function(a,b){this.store[a]=b},find:function(a){return this.store[a]},remove:function(a){delete this.store[a]},count:function(){return Object.keys(this.store).length},list:function(){var a=this;return Object.keys(this.store).map(function(b){return a.store[b]})}},a}()};b.String=c,b.Data=d}),a.Plane=c("plane")}(window);