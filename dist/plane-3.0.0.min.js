/*!
 * C37 in 26-06-2014 at 18:14:51 
 *
 * plane version: 3.0.0
 * licensed by Creative Commons Attribution-ShareAlike 3.0
 *
 * Copyright - C37 http://c37.co - 2014
 */
!function(a){"use strict";var b,c;!function(){var a={},d={};b=function(b,c,d){a[b]={deps:c,callback:d}},c=function(b){if(d[b])return d[b];d[b]={};var e=a[b];if(!e)throw new Error("Module '"+b+"' not found.");for(var f,g=e.deps,h=e.callback,i=[],j=0,k=g.length;k>j;j++)i.push("require"===g[j]?c:"exports"===g[j]?f={}:c(g[j]));var l=h.apply(this,i);return d[b]=f||l}}(),b("geometric/bÃ©zier",["require","exports"],function(){}),b("geometric/group",["require","exports"],function(){}),b("geometric/intersection",["require","exports"],function(a,b){function c(a,b){var c=a[0]*b[1]-b[0]*a[1],d=a[0]*b[2]-b[0]*a[2],e=a[0]*b[3]-b[0]*a[3],f=a[0]*b[4]-b[0]*a[4],g=a[0]*b[5]-b[0]*a[5],h=a[1]*b[2]-b[1]*a[2],j=a[1]*b[4]-b[1]*a[4],k=a[1]*b[5]-b[1]*a[5],l=a[2]*b[3]-b[2]*a[3],m=a[3]*b[4]-b[3]*a[4],n=a[3]*b[5]-b[3]*a[5],o=k+m,p=j-l;return new i(c*h-d*d,c*p+e*h-2*d*f,c*o+e*p-f*f-2*d*g,c*n+e*o-2*f*g,e*n-g*g)}function d(a,b,c,d){var e,f=(d.X-c.X)*(d.X-c.X)+(d.Y-c.Y)*(d.Y-c.Y),g=2*((d.X-c.X)*(c.X-a.X)+(d.Y-c.Y)*(c.Y-a.Y)),h=a.X*a.X+a.Y*a.Y+c.X*c.X+c.Y*c.Y-2*(a.X*c.X+a.Y*c.Y)-b*b,i=g*g-4*f*h;if(0>i)e=!1;else if(0==i)e=!1;else{var j=Math.sqrt(i),k=(-g+j)/(2*f),l=(-g-j)/(2*f);e=(0>k||k>1)&&(0>l||l>1)?0>k&&0>l||k>1&&l>1?!1:!1:!0}return e}function e(a,b,c,e,f){var g=j.Create(c.X+f,c.Y),h=j.Create(c.X+f,c.Y+e),i=j.Create(c.X,c.Y+e),k=j.Create(c.X,c.Y),l=d(a,b,g,h),m=d(a,b,h,i),n=d(a,b,i,k),o=d(a,b,k,g);return l||m||n||o}function f(a,b,c,d){var e,f=b+d,g=Math.abs(b-d),h=a.DistanceTo(c);if(h>f)e=!1;else if(g>h)e=!1;else{e={points:[]};var i=(b*b-d*d+h*h)/(2*h),k=Math.sqrt(b*b-i*i),l=a.InterpolationLinear(c,i/h),m=k/h;e.points.push(j.Create(l.X-m*(c.Y-a.Y),l.Y+m*(c.X-a.X))),e.points.push(j.Create(l.X+m*(c.Y-a.Y),l.Y-m*(c.X-a.X)))}return e}function g(a,b,c,d,e,g,h){var i=f(a,b,c,d);if(i.points)for(var k=e/360*2*Math.PI,l=g/360*2*Math.PI,m=k>l?(k-l)/2:(l-k)/2,n=j.Create(c.X+Math.cos(k)*d,c.Y+Math.sin(k)*d),o=j.Create(c.X+Math.cos(l)*d,c.Y+Math.sin(l)*d),p=j.Create(c.X+Math.cos(m)*d,h?c.Y-Math.sin(m)*d:c.Y+Math.sin(m)*d),q=(Math.PI+Math.PI,0);q<=i.points.length-1;q++){var r=i.points[q].DistanceTo(c),s=d;if(r>=s-4&&s+4>=r){var t=c.AngleTo(n),u=c.AngleTo(p),v=c.AngleTo(o),w=c.AngleTo(i.points[q]);if(u>=t&&v>=u)return w>=t&&v>=w?!0:!1;if(u>=v&&t>=u)return h?w>=v&&t>=w?!0:!1:w>=v&&t>=w?!1:!0;if(u>=t&&u>=v){if(v>t)return h?w>t&&v>w?!1:!0:w>t&&v>w?!0:!1;if(t>v)return w>v&&t>w?!1:!0}else if(t>=u&&v>=u){if(v>t)return h?w>t&&v>w?!1:!0:w>t&&v>w?!0:!1;if(t>v)return w>v&&t>w?!1:!0}}return!1}return!1}function h(a,b,d,e,f,g){for(var h=[b*b,0,d*d,-2*b*b*a.X,-2*d*d*a.Y,b*b*a.X*a.X+d*d*a.Y*a.Y-d*d*b*b],j=[f*f,0,g*g,-2*f*f*e.X,-2*g*g*e.Y,f*f*e.X*e.X+g*g*e.Y*e.Y-g*g*f*f],k=c(h,j),l=k.getRoots(),m=.001,n=(h[0]*h[0]+2*h[1]*h[1]+h[2]*h[2])*m,o=(j[0]*j[0]+2*j[1]*j[1]+j[2]*j[2])*m,p=0;p<l.length;p++)for(var q=new i(h[0],h[3]+l[p]*h[1],h[5]+l[p]*(h[4]+l[p]*h[2])),r=q.getRoots(),s=0;s<r.length;s++){var t=(h[0]*r[s]+h[1]*l[p]+h[3])*r[s]+(h[2]*l[p]+h[4])*l[p]+h[5];if(Math.abs(t)<n&&(t=(j[0]*r[s]+j[1]*l[p]+j[3])*r[s]+(j[2]*l[p]+j[4])*l[p]+j[5],Math.abs(t)<o))return!0}return!1}var i=a("geometric/polynomial").Polynomial,j=a("geometric/point");b.CircleLine=d,b.CircleRectangle=e,b.CircleCircle=f,b.CircleArc=g,b.CircleEllipse=h}),b("geometric/point",["require","exports"],function(a,b){function c(a,b){this.X=a,this.Y=b}function d(a,b){return new c(a,b)}c.prototype={Sum:function(a){return new c(this.X+a.X,this.Y+a.Y)},Subtract:function(a){return new c(this.X-a.X,this.Y-a.Y)},MultiplY:function(a){return new c(this.X*a,this.Y*a)},DistanceTo:function(a){var b=this.X-a.X,c=this.Y-a.Y;return Math.sqrt(b*b+c*c)},MidTo:function(a){return new c(this.X+(a.X-this.X)/2,this.Y+(a.Y-this.Y)/2)},AngleTo:function(a){return Math.atan2(a.Y-this.Y,a.X-this.X)},InterpolationLinear:function(a,b){return new c(this.X+(a.X-this.X)*b,this.Y+(a.Y-this.Y)*b)}},b.Create=d}),b("geometric/polynomial",["require","exports"],function(a,b){function c(){this.init(arguments)}c.prototype.init=function(a){this.coefs=new Array;for(var b=a.length-1;b>=0;b--)this.coefs.push(a[b]);this._variable="t",this._s=0},c.prototype.simplify=function(){for(var a=this.getDegree();a>=0&&Math.abs(this.coefs[a])<=c.TOLERANCE;a--)this.coefs.pop()},c.prototype.getDegree=function(){return this.coefs.length-1},c.prototype.getLinearRoot=function(){var a=new Array,b=this.coefs[1];return 0!=b&&a.push(-this.coefs[0]/b),a},c.prototype.getQuadraticRoots=function(){var a=new Array;if(2==this.getDegree()){var b=this.coefs[2],c=this.coefs[1]/b,d=this.coefs[0]/b,e=c*c-4*d;if(e>0){var f=Math.sqrt(e);a.push(.5*(-c+f)),a.push(.5*(-c-f))}else 0==e&&a.push(.5*-c)}return a},c.prototype.getCubicRoots=function(){var a=new Array;if(3==this.getDegree()){var b=this.coefs[3],d=this.coefs[2]/b,e=this.coefs[1]/b,f=this.coefs[0]/b,g=(3*e-d*d)/3,h=(2*d*d*d-9*e*d+27*f)/27,i=d/3,j=h*h/4+g*g*g/27,k=h/2;if(Math.abs(j)<=c.TOLERANCE&&(j=0),j>0){var l,m,n=Math.sqrt(j);l=-k+n,m=l>=0?Math.pow(l,1/3):-Math.pow(-l,1/3),l=-k-n,l>=0?m+=Math.pow(l,1/3):m-=Math.pow(-l,1/3),a.push(m-i)}else if(0>j){var o=Math.sqrt(-g/3),p=Math.atan2(Math.sqrt(-j),-k)/3,q=Math.cos(p),r=Math.sin(p),s=Math.sqrt(3);a.push(2*o*q-i),a.push(-o*(q+s*r)-i),a.push(-o*(q-s*r)-i)}else{var l;l=k>=0?-Math.pow(k,1/3):Math.pow(-k,1/3),a.push(2*l-i),a.push(-l-i)}}return a},c.prototype.getQuarticRoots=function(){var a=new Array;if(4==this.getDegree()){var b=this.coefs[4],d=this.coefs[3]/b,e=this.coefs[2]/b,f=this.coefs[1]/b,g=this.coefs[0]/b,h=new c(1,-e,d*f-4*g,-d*d*g+4*e*g-f*f).getCubicRoots(),i=h[0],j=d*d/4-e+i;if(Math.abs(j)<=c.TOLERANCE&&(j=0),j>0){var k=Math.sqrt(j),l=3*d*d/4-k*k-2*e,m=(4*d*e-8*f-d*d*d)/(4*k),n=l+m,o=l-m;if(Math.abs(n)<=c.TOLERANCE&&(n=0),Math.abs(o)<=c.TOLERANCE&&(o=0),n>=0){var p=Math.sqrt(n);a.push(-d/4+(k+p)/2),a.push(-d/4+(k-p)/2)}if(o>=0){var p=Math.sqrt(o);a.push(-d/4+(p-k)/2),a.push(-d/4-(p+k)/2)}}else if(0>j);else{var m=i*i-4*g;if(m>=-c.TOLERANCE){if(0>m&&(m=0),m=2*Math.sqrt(m),l=3*d*d/4-2*e,l+m>=c.TOLERANCE){var q=Math.sqrt(l+m);a.push(-d/4+q/2),a.push(-d/4-q/2)}if(l-m>=c.TOLERANCE){var q=Math.sqrt(l-m);a.push(-d/4+q/2),a.push(-d/4-q/2)}}}}return a},c.prototype.getRoots=function(){var a;switch(this.simplify(),this.getDegree()){case 0:a=new Array;break;case 1:a=this.getLinearRoot();break;case 2:a=this.getQuadraticRoots();break;case 3:a=this.getCubicRoots();break;case 4:a=this.getQuarticRoots();break;default:a=new Array}return a},b.Polynomial=c}),b("geometric/shape",["require","exports"],function(a,b){function c(){}function d(a,b,c,d,e,g,n,o,p,q,r,s,t,u){var v={Uuid:a,Name:"Shape ".concat(a),Style:e,Locked:!1,Visible:!0,Status:null};switch(b){case"Line":return v.Points=[f.Create(c[0],c[1]),f.Create(d[0],d[1])],new k(v);case"Rectangle":return v.Point=f.Create(c,d),v.Height=r,v.Width=s,new m(v);case"Arc":return v.Point=f.Create(c,d),v.Radius=g,v.StartAngle=n,v.EndAngle=o,v.ClockWise=p,new h(v);case"Circle":return v.Point=f.Create(c,d),v.Radius=g,new i(v);case"Ellipse":return v.Point=f.Create(c,d),v.RadiusY=t,v.RadiusX=u,new j(v);case"Polygon":v.Point=f.Create(c,d),v.Points=[],v.Sides=q;for(var w=0;q>w;w++){var x=g*Math.cos(2*Math.PI/q*w)+c,y=g*Math.sin(2*Math.PI/q*w)+d;v.Points.push(f.Create(x,y))}return new l(v)}}var e=a("utility/types"),f=a("geometric/point"),g=a("geometric/intersection");c.prototype={Rotate:function(){return!0},get Scale(){return this._scale||1},set Scale(a){switch(this.Type){case"Arc":this.Point.X*=a,this.Point.Y*=a,this.Radius*=a;break;case"Circle":this.Point.X*=a,this.Point.Y*=a,this.Radius*=a;break;case"Ellipse":this.Point.X*=a,this.Point.Y*=a,this.RadiusX*=a,this.RadiusY*=a;break;case"Line":this.Points.forEach(function(b){b.X*=a,b.Y*=a});break;case"Polygon":this.Points.forEach(function(b){b.X*=a,b.Y*=a});break;case"Rectangle":this.Point.X*=a,this.Point.Y*=a,this.Height*=a,this.Width*=a}this._scale=a},MoveTo:function(a){if(a={X:a.X,Y:a.Y},this.Point)this.Point=this.Point.Sum(a);else for(var b=0;b<=this.Points.length-1;b++)this.Points[b]=this.Points[b].Sum(a);return!0},Contains:function(a){switch(this.Type){case"Line":var b=this.Points[0],c=this.Points[1];if(g.CircleLine(a,2,b,c))return!0;break;case"Rectangle":if(g.CircleRectangle(a,2,this.Point,this.Height,this.Width))return!0;break;case"Arc":if(a=f.Create(a.X,a.Y),g.CircleArc(a,2,this.Point,this.Radius,this.StartAngle,this.EndAngle,this.ClockWise))return!0;break;case"Circle":if(a=f.Create(a.X,a.Y),g.CircleCircle(a,2,this.Point,this.Radius))return!0;break;case"Ellipse":return g.CircleEllipse(a,2,2,this.Point,this.RadiusY,this.RadiusX);case"Polygon":for(var b=null,c=null,d=0;d<this.Points.length;d++)if(d+1==this.Points.length?(b=this.Points[d],c=this.Points[0]):(b=this.Points[d],c=this.Points[d+1]),g.CircleLine(a,2,pointOrigin,pointDestination))return!0}return!1},Render:function(a,b){switch("Over"==this.Status&&(a.strokeStyle="rgb(61, 142, 193)"),"Selected"==this.Status&&(a.strokeStyle="rgb(68, 121, 154)",this.Point&&a.strokeRect(this.Point.X-Math.round(2*b)/2,this.Point.Y-Math.round(2*b)/2,Math.round(2*b),Math.round(2*b)),this.Points&&this.Points.forEach(function(c){a.strokeRect(c.X-Math.round(2*b)/2,c.Y-Math.round(2*b)/2,Math.round(2*b),Math.round(2*b))})),this.Type){case"Arc":return a.translate(this.Point.X,this.Point.Y),a.arc(0,0,this.Radius,Math.PI/180*this.StartAngle,Math.PI/180*this.EndAngle,this.ClockWise),!0;case"Circle":return a.translate(this.Point.X,this.Point.Y),a.arc(0,0,this.Radius,0,2*Math.PI,!0),!0;case"Ellipse":return a.translate(this.Point.X,this.Point.Y),a.ellipse(0,0,this.RadiusX,this.RadiusY,0,0,2*Math.PI),!0;case"Line":return"Over"!=this.Status&&(a.lineWidth=this.Style&&this.Style.LineWidth?this.Style.LineWidth:a.LineWidth,a.strokeStyle=this.Style&&this.Style.LineColor?this.Style.LineColor:a.strokeStyle),a.moveTo(this.Points[0].X,this.Points[0].Y),a.lineTo(this.Points[1].X,this.Points[1].Y),!0;case"Polygon":return a.moveTo(this.Points[0].X,this.Points[0].Y),this.Points.forEach(function(b){a.lineTo(b.X,b.Y)}),a.closePath(),!0;case"Rectangle":return a.translate(this.Point.X,this.Point.Y),a.strokeRect(0,0,this.Width,this.Height),!0}},ToObject:function(){switch(this.Type){case"Arc":return{Uuid:this.Uuid,Type:this.Type,Name:this.Name,Locked:this.Locked,Visible:this.Visible,X:e.Math.ParseFloat(this.Point.X,5),Y:e.Math.ParseFloat(this.Point.Y,5),Radius:e.Math.ParseFloat(this.Radius,5),StartAngle:e.Math.ParseFloat(this.StartAngle,5),EndAngle:e.Math.ParseFloat(this.EndAngle,5),ClockWise:this.ClockWise};case"Circle":return{Uuid:this.Uuid,Type:this.Type,Name:this.Name,Locked:this.Locked,Visible:this.Visible,X:e.Math.ParseFloat(this.Point.X,5),Y:e.Math.ParseFloat(this.Point.Y,5),Radius:e.Math.ParseFloat(this.Radius,5)};case"Ellipse":return{Uuid:this.Uuid,Type:this.Type,Name:this.Name,Locked:this.Locked,Visible:this.Visible,X:e.Math.ParseFloat(this.Point.X,5),Y:e.Math.ParseFloat(this.Point.Y,5),RadiusX:e.Math.ParseFloat(this.RadiusX,5),RadiusY:e.Math.ParseFloat(this.RadiusY,5)};case"Line":return{Uuid:this.Uuid,Type:this.Type,Name:this.Name,Locked:this.Locked,Visible:this.Visible,X:[e.Math.ParseFloat(this.Points[0].X,5),e.Math.ParseFloat(this.Points[0].Y,5)],Y:[e.Math.ParseFloat(this.Points[1].X,5),e.Math.ParseFloat(this.Points[1].Y,5)]};case"Polygon":return{Uuid:this.Uuid,Type:this.Type,Name:this.Name,Locked:this.Locked,Visible:this.Visible,X:e.Math.ParseFloat(this.Point.X,5),Y:e.Math.ParseFloat(this.Point.Y,5),Sides:this.Sides};case"Rectangle":return{Uuid:this.Uuid,Type:this.Type,Name:this.Name,Locked:this.Locked,Visible:this.Visible,X:e.Math.ParseFloat(this.Point.X,5),Y:e.Math.ParseFloat(this.Point.Y,5),Height:e.Math.ParseFloat(this.Height,5),Width:e.Math.ParseFloat(this.Width,5)}}}};var h=e.Function.Inherits(function(a){this.Uuid=a.Uuid,this.Name=a.Name,this.Locked=a.Locked,this.Visible=a.Visible,this.Status=a.Status,this.Type="Arc",this.Point=a.Point,this.Radius=a.Radius,this.StartAngle=a.StartAngle,this.EndAngle=a.EndAngle,this.ClockWise=a.ClockWise},c),i=e.Function.Inherits(function(a){this.Uuid=a.Uuid,this.Name=a.Name,this.Locked=a.Locked,this.Visible=a.Visible,this.Status=a.Status,this.Type="Circle",this.Point=a.Point,this.Radius=a.Radius},c),j=e.Function.Inherits(function(a){this.Uuid=a.Uuid,this.Name=a.Name,this.Locked=a.Locked,this.Visible=a.Visible,this.Status=a.Status,this.Type="Ellipse",this.Point=a.Point,this.RadiusY=a.RadiusY,this.RadiusX=a.RadiusX},c),k=e.Function.Inherits(function(a){this.Uuid=a.Uuid,this.Name=a.Name,this.Locked=a.Locked,this.Visible=a.Visible,this.Status=a.Status,this.Type="Line",this.Points=a.Points,this.Style=a.Style},c),l=e.Function.Inherits(function(a){this.Uuid=a.Uuid,this.Name=a.Name,this.Locked=a.Locked,this.Visible=a.Visible,this.Status=a.Status,this.Type="Polygon",this.Point=a.Point,this.Points=a.Points,this.Sides=a.Sides},c),m=e.Function.Inherits(function(a){this.Uuid=a.Uuid,this.Name=a.Name,this.Locked=a.Locked,this.Visible=a.Visible,this.Status=a.Status,this.Type="Rectangle",this.Point=a.Point,this.Height=a.Height,this.Width=a.Width},c);b.Create=d}),b("plane",["require","exports"],function(a,b){function c(a,b,c,e,f,i){if(a){if(k)k.Shapes=new d.Data.Dictionary;else{var j={ViewPort:l,Name:"System - Grid",Style:{LineCap:"butt",LineJoin:"miter",BackgroundColor:m.BackgroundColor}};k=g.Create(j)}c=Math.round(f>1?c*f:c/f),b=Math.round(f>1?b*f:b/f);var o=0;if(i.X>0)for(var p=i.X*f;p>=0;p-=10*f){var q=h.Create(d.Math.Uuid(9,16),"Line",[p,0],[p,b],{LineColor:e,LineWidth:o%5==0?.8:.3});k.Shapes.Add(q.Uuid,q),o++}o=0;for(var p=i.X*f;c>=p;p+=10*f){var q=h.Create(d.Math.Uuid(9,16),"Line",[p,0],[p,b],{LineColor:e,LineWidth:o%5==0?.8:.3});k.Shapes.Add(q.Uuid,q),o++}if(o=0,i.Y>0)for(var r=i.Y*f;r>=0;r-=10*f){var q=h.Create(d.Math.Uuid(9,16),"Line",[0,r],[c,r],{LineColor:e,LineWidth:o%5==0?.8:.3});k.Shapes.Add(q.Uuid,q),o++}o=0;for(var r=i.Y*f;b>=r;r+=10*f){var q=h.Create(d.Math.Uuid(9,16),"Line",[0,r],[c,r],{LineColor:e,LineWidth:o%5==0?.8:.3});k.Shapes.Add(q.Uuid,q),o++}n.Update(k)}}var d=a("utility/types"),e=a("utility/import"),f=new d.Data.Dictionary,g=(new d.Data.Dictionary,a("structure/layer")),h=a("geometric/shape"),i=a("structure/tools"),j=null,k=null,l=null,m=null,n=d.Object.Extend(new d.Object.Event,{Initialize:function(a){if(null==a)throw new Error("Plane - Initialize - Config is not valid \n http://requirejs.org/docs/errors.html#errorCode");if("function"==typeof a)throw new Error("Plane - Initialize - Config is not valid \n http://requirejs.org/docs/errors.html#errorCode");if(null==a.ViewPort)throw new Error("Plane - Initialize - Config is not valid \n http://requirejs.org/docs/errors.html#errorCode");return l=a.ViewPort,m=d.Object.Merge({MetricSystem:"mm",BackgroundColor:"rgb(255, 255, 255)",GridEnable:!0,GridColor:"rgb(218, 222, 215)"},a.Settings||{}),l.onmousemove=function(a){j&&i.Event.Notify("onMouseMove",{Type:"onMouseMove",Position:d.Graphic.MousePosition(l,{X:a.clientX,Y:a.clientY}),Shapes:j.Shapes.List(),Scroll:n.Scroll,Update:n.Update})},l.onclick=function(a){j&&i.Event.Notify("onClick",{Type:"onClick",Position:d.Graphic.MousePosition(l,{X:a.clientX,Y:a.clientY}),Shapes:j.Shapes.List(),Scroll:n.Scroll,Update:n.Update})},c(m.GridEnable,l.clientHeight,l.clientWidth,m.GridColor,this.Zoom,this.Scroll),!0},Update:function(a){var b=a?a.Style:j.Style,c=a?a.Shapes.List():j.Shapes.List(),d=a?a.Render:j.Render,e=d.getContext("2d");return e.clearRect(0,0,l.clientWidth,l.clientHeight),e.lineCap=b.LineCap,e.lineJoin=b.LineJoin,c.forEach(function(a){e.save(),e.beginPath(),a.Render(e,n.Zoom),e.stroke(),e.restore()}),!0},Clear:function(){return n.Scroll={X:0,Y:0},n.Zoom=1,n.Layer.Delete(),c(m.GridEnable,l.clientHeight,l.clientWidth,m.GridColor,this.Zoom,this.Scroll),!0},Layer:d.Object.Extend(new d.Object.Event,{Create:function(a){a=d.Object.Union(a,{ViewPort:l});var b=g.Create(a);f.Add(b.Uuid,b),this.Active=b.Uuid},List:function(){return f.List()},Delete:function(){f.List().forEach(function(a){var b=document.getElementById(a.Render.id);b&&b.parentNode&&b.parentNode.removeChild(b),f.Delete(a.Uuid)})},get Active(){return j||{}},set Active(a){this.Notify("onDeactive",{type:"onDeactive",layer:j}),j=f.Find(a),this.Notify("onActive",{type:"onActive",layer:j})}}),Shape:{Create:function(a){if("function"==typeof a||null==a)throw new Error("Shape - Create - Attrs is not valid \n http://requirejs.org/docs/errors.html#errorCode");if(-1==["Polygon","Rectangle","Line","Arc","Circle","Ellipse"].indexOf(a.Type))throw new Error("Shape - Create - Type is not valid \n http://requirejs.org/docs/errors.html#errorCode");if(void 0==a.X||void 0==a.Y)throw new Error("Shape - Create - X and Y is not valid \n http://requirejs.org/docs/errors.html#errorCode");a=d.Object.Merge({Uuid:d.Math.Uuid(9,16)},a);var b=h.Create(a.Uuid,a.Type,a.X,a.Y,a.Style,a.Radius,a.StartAngle,a.EndAngle,a.ClockWise,a.Sides,a.Height,a.Width,a.RadiusY,a.RadiusX);return j.Shapes.Add(b.Uuid,b),!0}},Import:{FromJson:function(a){var b=JSON.parse(a);return n.Clear(),m=b.Settings,n.Zoom=b.Zoom,n.Scroll=b.Scroll,b.Layers.forEach(function(a){n.Layer.Create({Uuid:a.Uuid,Name:a.Name,Locked:a.Locked,Visible:a.Visible,Style:a.Style}),a.Shapes.forEach(function(a){n.Shape.Create(a)}),n.Update()}),!0},FromSvg:null,FromDxf:function(a){n.Clear();var b=e.FromDxf(a),c=JSON.parse(b.replace(/u,/g,"").replace(/undefined,/g,""));if(b){n.Layer.Create();for(var d in c)n.Shape.Create(c[d]);n.Update()}},FromDwg:null},Export:{ToJson:function(){var a={Settings:m,Zoom:d.Math.ParseFloat(n.Zoom,5),Scroll:n.Scroll,Layers:f.List().map(function(a){var b=a.ToObject();return b.Shapes=b.Shapes.map(function(a){return a.ToObject()}),b})};return JSON.stringify(a)}},get Zoom(){return this._zoom||1},set Zoom(a){c(m.GridEnable,l.clientHeight,l.clientWidth,m.GridColor,a,this.Scroll);var b=n.Layer.Active,d=a/n.Zoom;n.Layer.List().forEach(function(a){n.Layer.Active=a.Uuid,n.Layer.Active.Shapes.List().forEach(function(a){a.Scale=d}),n.Update()}),n.Layer.Active=b.Uuid,this._zoom=a},get Scroll(){return this._scroll||{X:0,Y:0}},set Scroll(a){var b=n.Layer.Active,d={X:a.X+this.Scroll.X,Y:a.Y+this.Scroll.Y};a.X=a.X*this.Zoom,a.Y=a.Y*this.Zoom,c(m.GridEnable,l.clientHeight,l.clientWidth,m.GridColor,this.Zoom,d),n.Layer.List().forEach(function(b){n.Layer.Active=b.Uuid,n.Layer.Active.Shapes.List().forEach(function(b){b.MoveTo(a)}),n.Update()}),n.Layer.Active=b.Uuid,this._scroll=d}});b.PlaneApi=n}),b("structure/layer",["require","exports"],function(a,b){function c(a){if("function"==typeof a)throw new Error("Layer - Create - Attrs is not valid \n http://requirejs.org/docs/errors.html#errorCode");var b=d.Math.Uuid(9,16),c=document.createElement("canvas");c.id=d.Math.Uuid(9,16),c.width=a.ViewPort.clientWidth,c.height=a.ViewPort.clientHeight,c.style.position="absolute",c.style.backgroundColor=a.Style&&a.Style.BackgroundColor?a.Style.BackgroundColor:"transparent";var f=c.getContext("2d");f.translate(0,c.height),f.scale(1,-1),a=d.Object.Merge({Uuid:b,Name:"New Layer ".concat(b),Style:{fillColor:"rgb(0,0,0)",lineCap:"butt",lineJoin:"miter",lineWidth:.7,lineColor:"rgb(0, 0, 0)"},Locked:!1,Visible:!0,Shapes:new d.Data.Dictionary,Render:c},a);var g=new e(a);return a.ViewPort.appendChild(g.Render),g}var d=a("utility/types"),e=d.Function.Inherits(function(a){this.Uuid=a.Uuid,this.Name=a.Name,this.Locked=a.Locked,this.Visible=a.Visible,this.Style=a.Style,this.Render=a.Render,this.Shapes=a.Shapes},d.Object.Event);e.prototype.ToObject=function(){return{Uuid:this.Uuid,Name:this.Name,Locked:this.Locked,Visible:this.Visible,Style:this.Style,Shapes:this.Shapes.List()}},b.Create=c}),b("structure/tools",["require","exports"],function(a,b){function c(a){this.uuid=a.uuid,this.name=a.name,this.__defineGetter__("active",function(){return this._active||!1}),this.__defineSetter__("active",function(a){this.notify(a?"onActive":"onDeactive",{type:a?"onActive":"onDeactive",now:(new Date).toISOString()}),this._active=a}),utility.object.event.call(this)}function d(a){if("function"==typeof a)throw new Error("Tool - Create - Attrs is not valid \n http://requirejs.org/docs/errors.html#errorCode");a=e.Object.Merge({uuid:e.Math.Uuid(9,16),name:"Tool ".concat(f.count())},a);var b=c.Create(a.uuid,a.name);return toolStore.add(a.uuid,b),!0}var e=a("utility/types"),f=new e.Data.Dictionary;c.prototype=e.Object.Event.prototype;var g=new e.Object.Event;g.Listen("onMouseMove",function(a){a.Shapes.forEach(function(b){"Selected"!=b.Status&&(b.Status=b.Contains(a.Position)?"Over":"Out")}),a.Update()}),g.Listen("onClick",function(a){a.Shapes.forEach(function(b){b.Contains(a.Position)&&(b.Status="Selected"!=b.Status?"Selected":"Over")}),a.Update()}),b.Event=g,b.Create=d}),b("utility/export",["require","exports"],function(a,b){function c(){return!0}function d(){return!0}function e(){return!0}function f(){return!0}function g(){return!0}b.ToJson=c,b.ToSvg=d,b.ToDxf=e,b.ToPng=f,b.ToPdf=g}),b("utility/import",["require","exports"],function(a,b){function c(a){function b(a){switch(a.type){case"LINE":var b='{ "Type": "Line", "X": [{0}, {1}], "Y": [{2}, {3}] }';return b.format(a.x,a.y,a.x1,a.y1);case"CIRCLE":var c='{ "Type": "Circle", "X": {0}, "Y": {1}, "Radius": {2} }';return c.format(a.x,a.y,a.r);case"ARC":var d='{"Type": "Arc", "X": {0}, "Y": {1}, "Radius": {2},"StartAngle": {3}, "EndAngle": {4}, "ClockWise": {5} }';return d.format(a.x,a.y,a.r,a.a0,a.a1,!1);case"ELLIPSE":var e='{"Type": "Ellipse", "X": {0}, "Y": {1}, "RadiusY": {2},"RadiusX": {3} }',f=Math.abs(a.x1),g=f*a.r;return e.format(a.x,a.y,g,f)}}String.prototype.format||(String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,c){return"undefined"!=typeof a[c]?a[c]:b})}),String.prototype.contains||(String.prototype.contains=function(){return-1!==String.prototype.indexOf.apply(this,arguments)});var c={0:"entityType",2:"blockName",10:"x",11:"x1",20:"y",21:"y1",40:"r",50:"a0",51:"a1"},d=["LINE","CIRCLE","ARC","ELLIPSE"],e=0,f=null,g=!1,h={},i="[";return a=a.replace(/\r\n/g,"\n"),a=a.replace(/\r/g,"\n"),a.split("\n").forEach(function(a){if(a=a.trim(),e++%2===0)f=parseInt(a);else{var j=a,k=c[f];"blockName"===k&&"ENTITIES"===j?g=!0:g&&("entityType"===k?(h.type&&(i+="["==i.substring(i.length-1,i.length)?"":",",i+=b(h)),h=d.indexOf(j)>-1?{type:j}:{},"ENDSEC"===j&&(g=!1)):h.type&&"undefined"!=typeof k&&(h[k]=parseFloat(j)))}}),i+="]"}function d(){return!0}function e(){return!0}function f(){return!0}b.FromDxf=c,b.FromDwg=d,b.FromJson=e,b.FromSvg=f}),b("utility/types",["require","exports"],function(a,b){var c={Uuid:function(a,b){var c,d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),e=[];if(b=b||d.length,a)for(c=0;a>c;c++)e[c]=d[0|Math.random()*b];else{var f;for(e[8]=e[13]=e[18]=e[23]="-",e[14]="4",c=0;36>c;c++)e[c]||(f=0|16*Math.random(),e[c]=d[19==c?3&f|8:f])}return e.join("").toLowerCase()},ParseFloat:function(a,b){return Number(parseFloat(a).toFixed(b))}},d={Format:function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,c){return"undefined"!=typeof a[c]?a[c]:b})},Contains:function(){return-1!==d.prototype.indexOf.apply(this,arguments)}},e={MousePosition:function(a,b){var c=a.getBoundingClientRect(),d=(b.X-c.left)*(a.clientWidth/c.width),e=(b.Y-c.top)*(a.clientHeight/c.height);return e=-1*(e-a.clientHeight),{X:d,Y:e}}},f={Dictionary:function(){function a(){this.store=new Array}return a.prototype={Add:function(a,b){this.store[a]=b},Find:function(a){return this.store[a]},Delete:function(a){delete this.store[a]},Count:function(){return Object.keys(this.store).length},List:function(){var a=this;return Object.keys(this.store).map(function(b){return a.store[b]})}},a}()},g={Inherits:function(a,b){return a.prototype=new b,a}},h={Extend:function(a,b){for(var c in b)Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c));return a},Merge:function(a,b){for(var c in b)a.hasOwnProperty[c]||(a[c]=b[c]);return a},Restrict:function(a,b){for(var c in a)c in b||delete a[c];return a},Subtract:function(a,b){for(var c in b)delete a[c];return a},Union:function(a,b){return h.Extend(h.Extend({},a),b)},Intersection:function(a,b){return Restrict(extend({},a),b)},Keys:function(a){if("object"!=typeof a)throw TypeError();var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},Event:function(){function a(){this.listeners={}}return a.prototype.Listen=function(a,b){void 0===this.listeners[a]&&(this.listeners[a]=[]),this.listeners[a].push(b)},a.prototype.Notify=function(a,b){if(void 0!==this.listeners[a])for(var c in this.listeners[a])this.listeners[a][c].call(this,b)},a.prototype.Unlisten=function(a,b){if(void 0!==this.listeners[a]){var c=this.listeners[a].indexOf(b);-1!==c&&this.listeners[a].splice(c,1)}},a}()};b.Math=c,b.String=d,b.Graphic=e,b.Data=f,b.Object=h,b.Function=g}),a.Plane=c("plane").PlaneApi}(window);