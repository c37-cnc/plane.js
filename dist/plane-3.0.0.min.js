/*!
 * C37 in 21-08-2014 at 11:36:47 
 *
 * plane version: 3.0.0
 * licensed by Creative Commons Attribution-ShareAlike 3.0
 *
 * Copyright - C37 http://c37.co - 2014
 */
!function(a){"use strict";var b,c;!function(){var a={},d={};b=function(b,c,d){a[b]={dependencies:c,callback:d}},c=function(b){if(d[b])return d[b];d[b]={};var e=a[b];if(!e)throw new Error("Module '"+b+"' not found.");for(var f=e.dependencies,g=e.callback,h=[],i={},j=0,k=f.length;k>j;j++)h.push("require"==f[j]?c:"exports"==f[j]?i:c(f[j]));var l=g.apply(this,h);return d[b]=i||l}}(),b("data/exporter",["require","exports"],function(a,b){function c(){return!0}function d(){return!0}function e(){return!0}function f(){var a={layers:layerManager.list().map(function(a){var b=a.toObject();return b.shapes=b.shapes.map(function(a){return a.toObject()}),b})};return JSON.stringify(a)}function g(){return!0}b.toJson=f,b.toSvg=g,b.toDxf=c,b.toPng=d,b.toPdf=e}),b("data/importer",["require","exports"],function(a,b){function c(a){function b(a){switch(a.type){case"line":var b='{ "type": "line", "a": [{0}, {1}], "b": [{2}, {3}] },';return g.string.format(b,[a.x,a.y,a.x1,a.y1]);case"spline":var b='{ "type": "line", "a": [{0}, {1}], "b": [{2}, {3}] },';return g.string.format(b,[a.x,a.y,a.x1,a.y1]);case"circle":var c='{ "type": "circle", "x": {0}, "y": {1}, "radius": {2} },';return g.string.format(c,[a.x,a.y,a.r]);case"arc":var d='{"type": "arc", "x": {0}, "y": {1}, "radius": {2},"startAngle": {3}, "endAngle": {4}, "clockWise": {5} },';return g.string.format(d,[a.x,a.y,a.r,a.a0,a.a1,!1]);case"ellipse":var e='{"type": "ellipse", "x": {0}, "y": {1}, "radiusY": {2},"radiusX": {3} },',f=Math.abs(a.x1),h=f*a.r;return g.string.format(e,[a.x,a.y,h,f]);case"lwpolyline":if(a.vertices){for(var i='{"type": "polyline", "points": [{0}]},',j="",k=0;k<a.vertices.length;k++){var l=k==a.vertices.length-1?'{"x": {0}, "y": {1}}':'{"x": {0}, "y": {1}},';j+=g.string.format(l,[a.vertices[k].x,a.vertices[k].y])}return g.string.format(i,[j])}return"";case"polyline":if(a.vertices){for(var i='{"type": "polyline", "points": [{0}]},',j="",k=0;k<a.vertices.length;k++){var l=k==a.vertices.length-1?'{"x": {0}, "y": {1}}':'{"x": {0}, "y": {1}},';j+=g.string.format(l,[a.vertices[k].x,a.vertices[k].y])}return g.string.format(i,[j])}return""}}a=a.replace(/\r\n/g,"\n").replace(/\r/g,"\n");for(var c=["line","circle","arc","ellipse","lwpolyline","polyline","spline"],d=!1,e=null,f="",h="",i="",j=a.split("\n"),k=0;k<=j.length-1;k++)i=j[k].toLowerCase(),d=d?d:"entities"==i,d&&(c.indexOf(i)>-1?e={type:i}:e&&(" 10"!=f?" 10"!=i?" 11"!=f?" 11"!=i?" 20"!=f?" 20"!=i?" 21"!=f?" 21"!=i?" 40"!=f?" 40"!=i?" 50"!=f?" 50"!=i?" 51"!=f?" 51"!=i?(e&&e.type&&"polyline"!=e.type&&"  0"==j[k]&&(h+=b(e),e=null),e&&e.type&&"polyline"==e.type&&"SEQEND"==j[k]&&(h+=b(e),e=null)):f=i:(e.a1=g.math.parseFloat(i,5),f=""):f=i:(e.a0=g.math.parseFloat(i,5),f=""):f=i:(e.r=g.math.parseFloat(i,5),f=""):f=i:(e.y1=g.math.parseFloat(i,5),f=""):f=i:("spline"==e.type&&e.y?e.y1=g.math.parseFloat(i,5):e.y=g.math.parseFloat(i,5),("lwpolyline"==e.type||"polyline"==e.type)&&e.x&&e.y&&(e.vertices=e.vertices||[],e.vertices.push({x:e.x,y:e.y})),f=""):f=i:(e.x1=g.math.parseFloat(i,5),f=""):f=i:("spline"==e.type&&e.x?e.x1=g.math.parseFloat(i,5):e.x=g.math.parseFloat(i,5),f="")));return h?"["+h.substring(0,h.length-1)+"]":"[]"}function d(){return!0}function e(){return!0}function f(){return!0}var g=a("utility/types");b.parseDxf=c,b.fromDwg=d,b.fromJson=e,b.fromSvg=f}),b("geometric/intersection",["require","exports"],function(a,b){function c(a,b){var c=a[0]*b[1]-b[0]*a[1],d=a[0]*b[2]-b[0]*a[2],e=a[0]*b[3]-b[0]*a[3],f=a[0]*b[4]-b[0]*a[4],g=a[0]*b[5]-b[0]*a[5],h=a[1]*b[2]-b[1]*a[2],i=a[1]*b[4]-b[1]*a[4],k=a[1]*b[5]-b[1]*a[5],l=a[2]*b[3]-b[2]*a[3],m=a[3]*b[4]-b[3]*a[4],n=a[3]*b[5]-b[3]*a[5],o=k+m,p=i-l;return j.create(c*h-d*d,c*p+e*h-2*d*f,c*o+e*p-f*f-2*d*g,c*n+e*o-2*f*g,e*n-g*g)}function d(a,b,c,d){var e,f=(d.x-c.x)*(d.x-c.x)+(d.y-c.y)*(d.y-c.y),g=2*((d.x-c.x)*(c.x-a.x)+(d.y-c.y)*(c.y-a.y)),h=a.x*a.x+a.y*a.y+c.x*c.x+c.y*c.y-2*(a.x*c.x+a.y*c.y)-b*b,i=g*g-4*f*h;if(0>i)e=!1;else if(0==i)e=!1;else{var j=Math.sqrt(i),k=(-g+j)/(2*f),l=(-g-j)/(2*f);e=(0>k||k>1)&&(0>l||l>1)?0>k&&0>l||k>1&&l>1?!1:!1:!0}return e}function e(a,b,c,e,f){var g=k.create(c.x+f,c.y),h=k.create(c.x+f,c.y+e),i=k.create(c.x,c.y+e),j=k.create(c.x,c.y),l=d(a,b,g,h),m=d(a,b,h,i),n=d(a,b,i,j),o=d(a,b,j,g);return l||m||n||o}function f(a,b,c,d){var e,f=b+d,g=Math.abs(b-d),h=a.distanceTo(c);if(h>f)e=!1;else if(g>h)e=!1;else{e={points:[]};var i=(b*b-d*d+h*h)/(2*h),j=Math.sqrt(b*b-i*i),l=a.interpolationLinear(c,i/h),m=j/h;e.points.push(k.create(l.x-m*(c.y-a.y),l.y+m*(c.x-a.x))),e.points.push(k.create(l.x+m*(c.y-a.y),l.y-m*(c.x-a.x)))}return e}function g(a,b,c,d,e,g,h){var i=f(a,b,c,d);if(i.points)for(var j=e/360*2*Math.PI,l=g/360*2*Math.PI,m=j>l?(j-l)/2:(l-j)/2,n=k.create(c.x+Math.cos(j)*d,c.y+Math.sin(j)*d),o=k.create(c.x+Math.cos(l)*d,c.y+Math.sin(l)*d),p=k.create(c.x+Math.cos(m)*d,h?c.y-Math.sin(m)*d:c.y+Math.sin(m)*d),q=(Math.PI+Math.PI,0);q<=i.points.length-1;q++){var r=i.points[q].distanceTo(c),s=d;if(r>=s-4&&s+4>=r){var t=c.angleTo(n),u=c.angleTo(p),v=c.angleTo(o),w=c.angleTo(i.points[q]);if(u>=t&&v>=u)return w>=t&&v>=w?!0:!1;if(u>=v&&t>=u)return h?w>=v&&t>=w?!0:!1:w>=v&&t>=w?!1:!0;if(u>=t&&u>=v){if(v>t)return h?w>t&&v>w?!1:!0:w>t&&v>w?!0:!1;if(t>v)return w>v&&t>w?!1:!0}else if(t>=u&&v>=u){if(v>t)return h?w>t&&v>w?!1:!0:w>t&&v>w?!0:!1;if(t>v)return w>v&&t>w?!1:!0}}return!1}return!1}function h(a,b,d,e,f,g){for(var h=[b*b,0,d*d,-2*b*b*a.x,-2*d*d*a.y,b*b*a.x*a.x+d*d*a.y*a.y-d*d*b*b],i=[f*f,0,g*g,-2*f*f*e.x,-2*g*g*e.y,f*f*e.x*e.x+g*g*e.y*e.y-g*g*f*f],k=c(h,i),l=k.getRoots(),m=.001,n=(h[0]*h[0]+2*h[1]*h[1]+h[2]*h[2])*m,o=(i[0]*i[0]+2*i[1]*i[1]+i[2]*i[2])*m,p=0;p<l.length;p++)for(var q=j.create(h[0],h[3]+l[p]*h[1],h[5]+l[p]*(h[4]+l[p]*h[2])),r=q.getRoots(),s=0;s<r.length;s++){var t=(h[0]*r[s]+h[1]*l[p]+h[3])*r[s]+(h[2]*l[p]+h[4])*l[p]+h[5];if(Math.abs(t)<n&&(t=(i[0]*r[s]+i[1]*l[p]+i[3])*r[s]+(i[2]*l[p]+i[4])*l[p]+i[5],Math.abs(t)<o))return!0}return!1}function i(a,b,c,d,e,f){var g,h,i,l,m,n={};g=b.multiply(-2),i=a.sum(g.sum(c)),g=a.multiply(-2),h=b.multiply(2),l=g.sum(h),m=k.create(a.x,a.y);var o=e,p=f,q=j.create(p*i.x*i.x+o*i.y*i.y,2*(p*i.x*l.x+o*i.y*l.y),p*(2*i.x*m.x+l.x*l.x)+o*(2*i.y*m.y+l.y*l.y)-2*(p*d.x*i.x+o*d.y*i.y),2*(p*l.x*(m.x-d.x)+o*l.y*(m.y-d.y)),p*(m.x*m.x+d.x*d.x)+o*(m.y*m.y+d.y*d.y)-2*(p*d.x*m.x+o*d.y*m.y)-o*p).getRoots();if(q.length>1){n.points=[];for(var r=0;r<q.length;r++){var s=q[r];s>=0&&1>=s&&n.points.push(i.multiply(s*s).sum(l.multiply(s).sum(m)))}return n.points.length>0}return!1}var j=a("geometric/polynomial"),k=a("structure/point");b.circleLine=d,b.circleRectangle=e,b.circleCircle=f,b.circleArc=g,b.circleEllipse=h,b.circleBezier=i}),b("geometric/matrix",["require","exports"],function(a,b){function c(a,b,c,d,e,f){this.a=a||1,this.c=c||0,this.b=b||0,this.d=d||1,this.tx=e||0,this.ty=f||0}function d(a){return a.a*a.d-a.b*a.c}function e(a,b,c){return c?{x:b[0]*a.x+b[1]*a.y,y:b[2]*a.x+b[3]*a.y}:{x:b[0]*a.x+b[1]*a.y+b[4],y:b[2]*a.x+b[3]*a.y+b[5]}}function f(){return new c}c.prototype={rotate:function(a,b,c){var d=Math.cos(a),e=Math.sin(a);return this.transform(d,e,-e,d,b-b*d+c*e,c-b*e-c*d)},scale:function(a,b){return b&&this.translate(b.x,b.y),this.a*=a.x,this.c*=a.x,this.b*=a.y,this.d*=a.y,b&&this.translate(-b.x,-b.y),this},translate:function(a,b){return this.tx+=a*this.a+b*this.b,this.ty+=a*this.c+b*this.d,this},reset:function(){return this.a=this.d=1,this.c=this.b=this.tx=this.ty=0,this},clone:function(){return new c(this.a,this.b,this.c,this.d,this.tx,this.ty)},concate:function(a){var b=this.a,c=this.b,d=this.c,e=this.d,f=a.a,g=a.b,h=a.c,i=a.d,j=a.tx,k=a.ty;return this.a=f*b+h*c,this.b=g*b+i*c,this.c=f*d+h*e,this.d=g*d+i*e,this.tx+=j*b+k*c,this.ty+=j*d+k*e,this},shear:function(a,b){b&&this.translate(b.x,b.y);var c=this.a,d=this.c;return this.a+=a.y*this.b,this.c+=a.y*this.d,this.b+=a.x*c,this.d+=a.x*d,b&&this.translate(-b.x,-b.y),this},skew:function(a,b){var c=Math.PI/180,d={x:Math.tan(a.x*c),y:Math.tan(a.y*c)};return this.shear(d,b)},inverse:function(){var a=this.toArray(),b=1/(this.a*this.d-this.b*this.c);a=[b*this.d,-b*this.b,-b*this.c,b*this.a,0,0];var c=e({x:this.tx,y:this.ty},a);return a[4]=-c.x,a[5]=-c.y,a},inverted:function(){var a=d(this);return a&&new c(this.d/a,-this.c/a,-this.b/a,this.a/a,(this.b*this.ty-this.d*this.tx)/a,(this.c*this.tx-this.a*this.ty)/a)},inverseTransform:function(a){var b=d(this),c=a.x-this.tx,e=a.y-this.ty;return{x:(c*this.d-e*this.b)/b,y:(e*this.a-c*this.c)/b}},transform:function(a,b,c,d,e,f){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=e,this.ty=f,this},toCenter:function(){},toArray:function(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]},_transformCoordinates:function(a,b,c){for(var d=0,e=0,f=2*c;f>d;){var g=a[d++],h=a[d++];b[e++]=g*this._a+h*this._b+this._tx,b[e++]=g*this._c+h*this._d+this._ty}return b},_transformCorners:function(a){var b=a.x,c=a.y,d=b+a.width,e=c+a.height,f=[b,c,d,c,d,e,b,e];return this._transformCoordinates(f,f,4)},_transformBounds:function(a,b,c){for(var d=this._transformCorners(a),e=d.slice(0,2),f=d.slice(),g=2;8>g;g++){var h=d[g],i=1&g;h<e[i]?e[i]=h:h>f[i]&&(f[i]=h)}return b||(b=new Rectangle),b.set(e[0],e[1],f[0]-e[0],f[1]-e[1],c)}},b.create=f,b.toPoint=e}),b("geometric/polynomial",["require","exports"],function(a,b){function c(a){this.coefs=new Array;for(var b=a.length-1;b>=0;b--)this.coefs.push(a[b]);this._variable="t",this._s=0}function d(){return new c(arguments)}c.prototype.simplify=function(){for(var a=this.getDegree();a>=0&&Math.abs(this.coefs[a])<=c.TOLERANCE;a--)this.coefs.pop()},c.prototype.getDegree=function(){return this.coefs.length-1},c.prototype.getLinearRoot=function(){var a=new Array,b=this.coefs[1];return 0!=b&&a.push(-this.coefs[0]/b),a},c.prototype.getQuadraticRoots=function(){var a=new Array;if(2==this.getDegree()){var b=this.coefs[2],c=this.coefs[1]/b,d=this.coefs[0]/b,e=c*c-4*d;if(e>0){var f=Math.sqrt(e);a.push(.5*(-c+f)),a.push(.5*(-c-f))}else 0==e&&a.push(.5*-c)}return a},c.prototype.getCubicRoots=function(){var a=new Array;if(3==this.getDegree()){var b=this.coefs[3],d=this.coefs[2]/b,e=this.coefs[1]/b,f=this.coefs[0]/b,g=(3*e-d*d)/3,h=(2*d*d*d-9*e*d+27*f)/27,i=d/3,j=h*h/4+g*g*g/27,k=h/2;if(Math.abs(j)<=c.TOLERANCE&&(j=0),j>0){var l,m,n=Math.sqrt(j);l=-k+n,m=l>=0?Math.pow(l,1/3):-Math.pow(-l,1/3),l=-k-n,l>=0?m+=Math.pow(l,1/3):m-=Math.pow(-l,1/3),a.push(m-i)}else if(0>j){var o=Math.sqrt(-g/3),p=Math.atan2(Math.sqrt(-j),-k)/3,q=Math.cos(p),r=Math.sin(p),s=Math.sqrt(3);a.push(2*o*q-i),a.push(-o*(q+s*r)-i),a.push(-o*(q-s*r)-i)}else{var l;l=k>=0?-Math.pow(k,1/3):Math.pow(-k,1/3),a.push(2*l-i),a.push(-l-i)}}return a},c.prototype.getQuarticRoots=function(){var a=new Array;if(4==this.getDegree()){var b=this.coefs[4],e=this.coefs[3]/b,f=this.coefs[2]/b,g=this.coefs[1]/b,h=this.coefs[0]/b,i=d(1,-f,e*g-4*h,-e*e*h+4*f*h-g*g).getCubicRoots(),j=i[0],k=e*e/4-f+j;if(Math.abs(k)<=c.TOLERANCE&&(k=0),k>0){var l=Math.sqrt(k),m=3*e*e/4-l*l-2*f,n=(4*e*f-8*g-e*e*e)/(4*l),o=m+n,p=m-n;if(Math.abs(o)<=c.TOLERANCE&&(o=0),Math.abs(p)<=c.TOLERANCE&&(p=0),o>=0){var q=Math.sqrt(o);a.push(-e/4+(l+q)/2),a.push(-e/4+(l-q)/2)}if(p>=0){var q=Math.sqrt(p);a.push(-e/4+(q-l)/2),a.push(-e/4-(q+l)/2)}}else if(0>k);else{var n=j*j-4*h;if(n>=-c.TOLERANCE){if(0>n&&(n=0),n=2*Math.sqrt(n),m=3*e*e/4-2*f,m+n>=c.TOLERANCE){var r=Math.sqrt(m+n);a.push(-e/4+r/2),a.push(-e/4-r/2)}if(m-n>=c.TOLERANCE){var r=Math.sqrt(m-n);a.push(-e/4+r/2),a.push(-e/4-r/2)}}}}return a},c.prototype.getRoots=function(){var a;switch(this.simplify(),this.getDegree()){case 0:a=new Array;break;case 1:a=this.getLinearRoot();break;case 2:a=this.getQuadraticRoots();break;case 3:a=this.getCubicRoots();break;case 4:a=this.getQuarticRoots();break;default:a=new Array}return a},b.create=d}),b("plane",["require","exports"],function(a,b){function c(a){if(null==a)throw new Error("plane - initialize - config is not valid \n http://requirejs.org/docs/errors.html#errorCode");if("function"==typeof a)throw new Error("plane - initialize - config is not valid \n http://requirejs.org/docs/errors.html#errorCode");if(null==a.viewPort)throw new Error("plane - initialize - config is not valid \n http://requirejs.org/docs/errors.html#errorCode");o=a.viewPort;var b=document.createElement("canvas");return b.id=f.math.uuid(9,16),b.width=o.clientWidth,b.height=o.clientHeight,b.style.position="absolute",b.style.backgroundColor="transparent",o.appendChild(b),p.context=b.getContext("2d"),p.context.translate(0,o.clientHeight),p.context.scale(1,-1),p.transform=g.create(),p.center=p.center.sum(i.create(o.clientWidth/2,o.clientHeight/2)),p.size.height=o.clientHeight,p.size.width=o.clientWidth,h.initialize({select:r}),j.initialize({select:r}),l.initialize({viewPort:o,select:r,view:p}),!0}function d(){return p.reset(),h.remove(),!0}function e(){var a=p.context,b=p.transform;a.clearRect(0,0,o.clientWidth+1,o.clientHeight+1);for(var c=h.list(),d=c.length;d--;){var e=c[d].children.list(),f=e.length;for(a.lineCap=c[d].style.lineCap,a.lineJoin=c[d].style.lineJoin;f--;)e[f].render(a,b)}return this}var f=a("utility/types"),g=a("geometric/matrix"),h=a("structure/layer"),i=a("structure/point"),j=a("structure/shape"),k=a("structure/group"),l=a("structure/tool"),m=a("data/importer"),n=a("data/exporter"),o=null,p={context:null,transform:null,zoom:1,center:i.create(0,0),size:{height:0,width:0},bounds:{x:0,y:0,height:0,width:0},reset:function(){}},q={get zoom(){return p.zoom},set zoom(a){var b;return b=a/p.zoom,p.transform.scale({x:b,y:b},p.center),p.zoom=a,e(),!0},zoomTo:function(a,b){var c;c=a/p.zoom,p.transform.scale({x:c,y:c},p.center),p.zoom=a;var d=b.subtract(p.center);d=d.negate();var f=g.create();return f.translate(d.x,d.y),p.transform.concate(f),p.center=b,e(),!0},get center(){return p.center},set center(a){var b=a.subtract(p.center);b=b.negate();var c=g.create();return c.translate(b.x,b.y),p.transform.concate(c),p.center=a,e(),!0},get bounds(){var a=Math.sqrt(p.transform.a*p.transform.d);return{x:p.transform.tx,y:p.transform.ty,height:p.size.height*a,width:p.size.width*a}},get size(){return p.size}},r=function(){var a=null,b=f.data.dictionary.create(),c=f.data.dictionary.create();return{get layer(){return a},set layer(d){this.events.notify("onDeactivated",{type:"onDeactivated",layer:a}),a=h.find(d),b.clear(),c.clear(),this.events.notify("onActivated",{type:"onActivated",layer:a})},get shapes(){return b},set shapes(a){return b.add(a.uuid,a)},get groups(){return c.list()},set groups(a){return c.add(a.uuid,a)},events:f.object.event.create()}}();b.initialize=c,b.update=e,b.clear=d,b.view=q,b.select=r,b.point=i,b.shape=j,b.group=k,b.layer={create:h.create,list:h.list,find:h.find,remove:h.remove},b.tool={create:l.create,list:l.list,find:l.find,remove:l.remove},b.importer={fromDxf:function(a){d();var b=m.parseDxf(a),c=JSON.parse(b);if(b){h.create();for(var f in c)j.create(c[f]);e()}}},b.exporter=n}),b("structure/group",["require","exports"],function(a,b){function c(){}function d(a){if("function"==typeof a)throw new Error("Tool - create - attrs is not valid \n http://requirejs.org/docs/errors.html#errorCode");return new c}c.prototype={},b.create=d}),b("structure/layer",["require","exports"],function(a,b){function c(a){this.uuid=a.uuid,this.name=a.name,this.status=a.status,this.style=a.style,this.children=a.children,this.events=a.events}function d(a){return k=a.select,!0}function e(a){if("function"==typeof a)throw new Error("layer - create - attrs is not valid \n http://requirejs.org/docs/errors.html#errorCode");var b=i.math.uuid(9,16);a=i.object.merge({uuid:b,name:"New Layer ".concat(b),style:{lineCap:"butt",lineJoin:"miter",lineWidth:.7,lineColor:"rgb(0, 0, 0)"},status:"visible",children:i.data.dictionary.create(),events:i.object.event.create()},a);var d=new c(a);return j.add(d.uuid,d),k.layer=d.uuid,this}function f(){return j.list()}function g(a){return j.find(a)}function h(a){return j.remove(a)}var i=a("utility/types"),j=i.data.dictionary.create(),k=null;c.prototype.toObject=function(){return{uuid:this.uuid,name:this.name,status:this.status,style:this.style,children:this.children.list()}},b.initialize=d,b.create=e,b.list=f,b.find=g,b.remove=h}),b("structure/point",["require","exports"],function(a,b){function c(a,b){this.x=a,this.y=b}function d(){if(2==arguments.length&&null!=arguments[0]&&null!=arguments[1])return new c(arguments[0],arguments[1]);if(1==arguments.length&&"object"==typeof arguments&&null!=arguments[0].x&&null!=arguments[0].y)return new c(arguments[0].x,arguments[0].y);throw new Error("Point - create - attrs is not valid \n http://requirejs.org/docs/errors.html#errorCode")}c.prototype={sum:function(a){return new c(this.x+a.x,this.y+a.y)},subtract:function(a){return new c(this.x-a.x,this.y-a.y)},negate:function(){return new c(-this.x,-this.y)},multiply:function(a){return new c(this.x*a,this.y*a)},distanceTo:function(a){var b=this.x-a.x,c=this.y-a.y;return Math.sqrt(b*b+c*c)},midTo:function(a){return new c(this.x+(a.x-this.x)/2,this.y+(a.y-this.y)/2)},angleTo:function(a){return Math.atan2(a.y-this.y,a.x-this.x)},interpolationLinear:function(a,b){return new c(this.x+(a.x-this.x)*b,this.y+(a.y-this.y)*b)}},b.create=d}),b("structure/shape",["require","exports"],function(a,b){function c(){}function d(a){return m=a.select,!0}function e(a){if("function"==typeof a||null==a)throw new Error("shape - create - attrs is not valid \n http://requirejs.org/docs/errors.html#errorCode");if(-1==["polyline","polygon","rectangle","line","arc","circle","ellipse","bezier"].indexOf(a.type))throw new Error("shape - create - type is not valid \n http://requirejs.org/docs/errors.html#errorCode");if("polyline"!=a.type&&"bezier"!=a.type&&"line"!=a.type&&(void 0==a.x||void 0==a.y))throw new Error("shape - create - x and y is not valid \n http://requirejs.org/docs/errors.html#errorCode");var b=i.math.uuid(9,16),c=null;switch(a=i.object.merge({uuid:b,name:"shape ".concat(b),style:null,transform:k.create(),status:null},a),a.type){case"line":a.points=[l.create(a.a[0],a.a[1]),l.create(a.b[0],a.b[1])],c=new r(a);break;case"bezier":a.points=a.points.map(function(a){return{a:l.create(a.a[0],a.a[1]),b:l.create(a.b[0],a.b[1]),c:l.create(a.c[0],a.c[1])}}),c=new o(a);break;case"rectangle":a.point=l.create(a.x,a.y),a.height=a.height,a.width=a.width,c=new u(a);break;case"arc":a.point=l.create(a.x,a.y),a.radius=a.radius,a.startAngle=a.startAngle,a.endAngle=a.endAngle,a.clockWise=a.clockWise,c=new n(a);break;case"circle":a.point=l.create(a.x,a.y),a.radius=a.radius,c=new p(a);break;case"ellipse":a.point=l.create(a.x,a.y),a.radiusY=a.radiusY,a.radiusX=a.radiusX,c=new q(a);break;case"polygon":a.point=l.create(a.x,a.y),a.points=[];for(var d=0;d<a.sides;d++){var e=a.radius*Math.cos(2*Math.PI/a.sides*d)+a.point.x,f=a.radius*Math.sin(2*Math.PI/a.sides*d)+a.point.y;a.points.push(l.create(e,f))}c=new s(a);break;case"polyline":for(var d=0;d<a.points.length;d++)a.points[d]=l.create(a.points[d].x,a.points[d].y);c=new t(a)}return m.layer.children.add(c.uuid,c)}function f(){}function g(){}function h(){}var i=a("utility/types"),j=a("geometric/intersection"),k=a("geometric/matrix"),l=a("structure/point"),m=(a("structure/layer"),null);c.prototype={rotateTo:function(){return"arc"==this.type||"bezier"==this.type||"circle"==this.type||"ellipse"==this.type||"line"==this.type||"polygon"==this.type||"polyline"==this.type||"rectangle"==this.type,!0},scaleTo:function(a){if("arc"==this.type)this.point.x*=a,this.point.y*=a,this.radius*=a;else if("bezier"==this.type)this.points.forEach(function(b){b.a=b.a.multiply(a),b.b=b.b.multiply(a),b.c=b.c.multiply(a)});else if("circle"==this.type)this.point.x*=a,this.point.y*=a,this.radius*=a;else if("ellipse"==this.type)this.point.x*=a,this.point.y*=a,this.radiusX*=a,this.radiusY*=a;else if("line"==this.type)for(var b=0;b<=this.points.length-1;b++)this.points[b]=this.points[b].multiply(a);else"polygon"==this.type?(this.point.x*=a,this.point.y*=a,this.points.forEach(function(b){b.x*=a,b.y*=a})):"polyline"==this.type?this.points.forEach(function(b){b.x*=a,b.y*=a}):"rectangle"==this.type&&(this.point.x*=a,this.point.y*=a,this.height*=a,this.width*=a)},moveTo:function(a){if(this.point&&(this.point=this.point.sum(a)),this.points&&"bezier"!=this.type)for(var b=0;b<=this.points.length-1;b++)this.points[b]=this.points[b].sum(a);if(this.points&&"bezier"==this.type)for(var b=0;b<=this.points.length-1;b++)this.points[b].a=this.points[b].a.sum(a),this.points[b].b=this.points[b].b.sum(a),this.points[b].c=this.points[b].c.sum(a);return!0},contains:function(a,b){var c=Math.sqrt(b.a*b.d),d=l.create(b.tx,b.ty);if("arc"==this.type)return j.circleArc(a,3,this.point.multiply(c).sum(d),this.radius*c,this.startAngle,this.endAngle,this.clockWise);if("bezier"==this.type){for(var e=0;e<this.points.length;e++)if(j.circleBezier(this.points[e].a,this.points[e].b,this.points[e].c,l,3,3))return!0}else{if("circle"==this.type){var f=this.point.multiply(c).sum(d);return j.circleCircle(a,3,f,this.radius*c)}if("ellipse"==this.type)return j.circleEllipse(a,3,3,this.point.multiply(c).sum(d),this.radiusY*c,this.radiusX*c);if("line"==this.type)return j.circleLine(a,3,this.points[0].multiply(c).sum(d),this.points[1].multiply(c).sum(d));if("polygon"==this.type){for(var g=null,h=null,e=0;e<this.points.length;e++)if(e+1==this.points.length?(g=this.points[e],h=this.points[0]):(g=this.points[e],h=this.points[e+1]),j.circleLine(a,3,g,h))return!0}else if("polyline"==this.type){for(var g=null,h=null,e=0;e<this.points.length;e++)if(e+1==this.points.length?(g=this.points[e],h=this.points[0]):(g=this.points[e],h=this.points[e+1]),j.circleLine(a,3,g,h))return!0}else if("rectangle"==this.type){var f=this.point.multiply(c).sum(d);return console.log(f),j.circleRectangle(a,3,this.point.multiply(c).sum(d),this.height*c,this.width*c)}}return!1},render:function(a,b){var c=Math.sqrt(b.a*b.d),d={x:b.tx,y:b.ty};if(this.style&&this.style.lineWidth&&(a.save(),a.lineWidth=this.style.lineWidth,a.strokeStyle=this.style.lineColor),a.beginPath(),"arc"==this.type)a.arc(this.point.x*c+d.x,this.point.y*c+d.y,this.radius*c,Math.PI/180*this.startAngle,Math.PI/180*this.endAngle,this.clockWise);else if("bezier"==this.type)this.points.forEach(function(b){var e=b.c.x*c+d.x,f=b.c.y*c+d.y;a.bezierCurveTo(b.a.x*c+d.x,b.a.y*c+d.y,b.b.x*c+d.x,b.b.y*c+d.y,e,f)});else if("circle"==this.type)a.arc(this.point.x*c+d.x,this.point.y*c+d.y,this.radius*c,0,2*Math.PI,!0);else if("ellipse"==this.type)for(var e=0,f=0*Math.PI;f<2*Math.PI;f+=.01){var g=this.point.x-this.radiusY*Math.sin(f)*Math.sin(e*Math.PI)+this.radiusX*Math.cos(f)*Math.cos(e*Math.PI),h=this.point.y+this.radiusX*Math.cos(f)*Math.sin(e*Math.PI)+this.radiusY*Math.sin(f)*Math.cos(e*Math.PI);0==f?a.moveTo(g*c+d.x,h*c+d.y):a.lineTo(g*c+d.x,h*c+d.y)}else"line"==this.type?(a.lineWidth=this.style&&this.style.lineWidth?this.style.lineWidth:a.lineWidth,a.strokeStyle=this.style&&this.style.lineColor?this.style.lineColor:a.strokeStyle,a.moveTo(this.points[0].x*c+d.x,this.points[0].y*c+d.y),a.lineTo(this.points[1].x*c+d.x,this.points[1].y*c+d.y)):"polygon"==this.type?(a.moveTo(this.points[0].x*c+d.x,this.points[0].y*c+d.y),this.points.forEach(function(b){a.lineTo(b.x*c+d.x,b.y*c+d.y)}),a.closePath()):"polyline"==this.type?(a.moveTo(this.points[0].x*c+d.x,this.points[0].y*c+d.y),this.points.forEach(function(b){a.lineTo(b.x*c+d.x,b.y*c+d.y)})):"rectangle"==this.type&&a.strokeRect(this.point.x*c+d.x,this.point.y*c+d.y,this.width*c,this.height*c);return a.stroke(),this.style&&this.style.lineWidth&&a.restore(),!0},toObject:function(){switch(this.type){case"arc":return{uuid:this.uuid,type:this.type,name:this.name,status:this.status,x:i.math.parseFloat(this.point.x,5),y:i.math.parseFloat(this.point.y,5),radius:i.math.parseFloat(this.radius,5),startAngle:i.math.parseFloat(this.startAngle,5),endAngle:i.math.parseFloat(this.endAngle,5),clockWise:this.clockWise};case"bezier":return{uuid:this.uuid,type:this.type,name:this.name,status:this.status,points:this.points.map(function(a){return{a:[i.math.parseFloat(a.a.x,5),i.math.parseFloat(a.a.y,5)],b:[i.math.parseFloat(a.b.x,5),i.math.parseFloat(a.b.y,5)],c:[i.math.parseFloat(a.c.x,5),i.math.parseFloat(a.c.y,5)]}})};case"circle":return{uuid:this.uuid,type:this.type,name:this.name,status:this.status,x:i.math.parseFloat(this.point.x,5),y:i.math.parseFloat(this.point.y,5),radius:i.math.parseFloat(this.radius,5)};case"ellipse":return{uuid:this.uuid,type:this.type,name:this.name,status:this.status,x:i.math.parseFloat(this.point.x,5),y:i.math.parseFloat(this.point.y,5),radiusX:i.math.parseFloat(this.radiusX,5),radiusY:i.math.parseFloat(this.radiusY,5)};case"line":return{uuid:this.uuid,type:this.type,name:this.name,status:this.status,a:[i.math.parseFloat(this.points[0].x,5),i.math.parseFloat(this.points[0].y,5)],b:[i.math.parseFloat(this.points[1].x,5),i.math.parseFloat(this.points[1].y,5)]};case"polygon":return{uuid:this.uuid,type:this.type,name:this.name,status:this.status,x:i.math.parseFloat(this.point.x,5),y:i.math.parseFloat(this.point.y,5),sides:this.sides};case"polyline":return{uuid:this.uuid,type:this.type,name:this.name,status:this.status,points:this.points.map(function(a){return{x:i.math.parseFloat(a.x,5),y:i.math.parseFloat(a.y,5)}})};case"rectangle":return{uuid:this.uuid,type:this.type,name:this.name,status:this.status,x:i.math.parseFloat(this.point.x,5),y:i.math.parseFloat(this.point.y,5),height:i.math.parseFloat(this.height,5),width:i.math.parseFloat(this.width,5)}}}};var n=i.object.inherits(function(a){this.uuid=a.uuid,this.name=a.name,this.transform=a.transform,this.status=a.status,this.type="arc",this.point=a.point,this.radius=a.radius,this.startAngle=a.startAngle,this.endAngle=a.endAngle,this.clockWise=a.clockWise},c),o=i.object.inherits(function(a){this.uuid=a.uuid,this.name=a.name,this.transform=a.transform,this.status=a.status,this.type="bezier",this.points=a.points},c),p=i.object.inherits(function(a){this.uuid=a.uuid,this.name=a.name,this.transform=a.transform,this.status=a.status,this.type="circle",this.point=a.point,this.radius=a.radius},c),q=i.object.inherits(function(a){this.uuid=a.uuid,this.name=a.name,this.transform=a.transform,this.status=a.status,this.type="ellipse",this.point=a.point,this.radiusY=a.radiusY,this.radiusX=a.radiusX},c),r=i.object.inherits(function(a){this.uuid=a.uuid,this.name=a.name,this.transform=a.transform,this.status=a.status,this.type="line",this.points=a.points,this.style=a.style},c),s=i.object.inherits(function(a){this.uuid=a.uuid,this.name=a.name,this.transform=a.transform,this.status=a.status,this.type="polygon",this.point=a.point,this.points=a.points,this.sides=a.sides},c),t=i.object.inherits(function(a){this.uuid=a.uuid,this.name=a.name,this.transform=a.transform,this.status=a.status,this.type="polyline",this.points=a.points},c),u=i.object.inherits(function(a){this.uuid=a.uuid,this.name=a.name,this.transform=a.transform,this.status=a.status,this.type="rectangle",this.point=a.point,this.height=a.height,this.width=a.width},c);b.initialize=d,b.create=e,b.remove=f,b.list=g,b.find=h}),b("structure/tool",["require","exports"],function(a,b){function c(a){this.uuid=a.uuid,this.name=a.name,this.events=a.events,Object.defineProperty(this,"active",{get:function(){return this._active||!1},set:function(a){this.events.notify(a?"onActive":"onDeactive",{type:a?"onActive":"onDeactive",Now:(new Date).toISOString()}),this._active=a}}),this.active=a.active}function d(a){function b(a){var b=i.graphic.mousePosition(l,a.x,a.y),c=i.graphic.canvasPosition(l,a.x,a.y),d=n.transform.inverseTransform(b),e=k.create(d);b=k.create(b),h=k.create(d);var f=[].some.call(n.context.getImageData(c.x,c.y,3,3).data,function(a){return a>0});if(f)for(var g=m.layer.children.list(),p=g.length;p--;){if(g[p].contains(b,n.transform)){o.add(g[p].uuid,g[p]);break}o.remove(g[p].uuid)}else o.clear();a={type:"onMouseDown",point:e,shapes:o.list(),Now:(new Date).toISOString()};for(var q=j.list(),r=q.length;r--;)q[r].active&&q[r].events.notify("onMouseDown",a)}function c(){h=null}function d(a){if(h){var b=i.graphic.mousePosition(l,a.x,a.y),c=n.transform.inverseTransform(b);a={type:"onMouseDrag",pointFirst:h,pointLast:k.create(c),now:(new Date).toISOString()};for(var d=j.list(),e=d.length;e--;)d[e].active&&d[e].events.notify("onMouseDrag",a)}}function e(a){var b=i.graphic.mousePosition(l,a.x,a.y),c=i.graphic.canvasPosition(l,a.x,a.y),d=n.transform.inverseTransform(b),e=k.create(d);b=k.create(b);var f=[].some.call(n.context.getImageData(c.x,c.y,3,3).data,function(a){return a>0});if(f)for(var g=m.layer.children.list(),h=g.length;h--;){if(g[h].contains(b,n.transform)){p.add(g[h].uuid,g[h]);break}p.remove(g[h].uuid)}else p.clear();a={type:"onMouseMove",point:e,shapes:p.list(),Now:(new Date).toISOString()};for(var o=j.list(),q=o.length;q--;)o[q].active&&o[q].events.notify("onMouseMove",a)}function f(){}function g(a){var b=i.graphic.mousePosition(l,a.x,a.y),c=n.transform.inverseTransform(b);a={type:"onMouseWheel",delta:a.deltaY,point:k.create(c),now:(new Date).toISOString()};for(var d=j.list(),e=d.length;e--;)d[e].active&&d[e].events.notify("onMouseWheel",a)}l=a.viewPort,m=a.select,n=a.view;var h,o=m.shapes,p=i.data.dictionary.create();return l.onmousedown=b,l.onmouseup=c,l.addEventListener("mousemove",e,!1),l.addEventListener("mousemove",d,!1),l.onmouseleave=f,l.onmousewheel=g,!0}function e(a){if("function"==typeof a)throw new Error("Tool - create - attrs is not valid \n http://requirejs.org/docs/errors.html#errorCode");var b=i.math.uuid(9,16);a=i.object.merge({uuid:b,name:"Tool ".concat(b),events:i.object.event.create(),active:!1},a);var d=new c(a);return j.add(d.uuid,d),d}function f(){return j.list()}function g(a){return j.find(a)}function h(a){return j.remove(a)}var i=a("utility/types"),j=i.data.dictionary.create(),k=a("structure/point"),l=null,m=null,n=null;b.initialize=d,b.create=e,b.list=f,b.find=g,b.remove=h}),b("structure/view",["require","exports"],function(a,b){function c(a){f=a.viewPort;var b=document.createElement("canvas");return b.id=d.math.uuid(9,16),b.width=f.clientWidth,b.height=f.clientHeight,b.style.position="absolute",b.style.backgroundColor="transparent",f.appendChild(b),g.context=b.getContext("2d"),g.transform=e.create(),!0}{var d=a("utility/types"),e=a("geometric/matrix"),f=null,g={context:null,transform:null};!function(){var a=e.create(),b=null,c=1,d={x:0,y:0},f={bottom:0,height:0,left:0,right:0,top:0,width:0},g={height:0,width:0};return{initialize:function(a){return b=a.viewPort,f.height=b.clientHeight,f.width=b.clientWidth,d.x=b.clientWidth/2,d.y=b.clientHeight/2,g.height=b.clientHeight,g.width=b.clientWidth,!0},get zoom(){return c},set zoom(a){return this.zoomTo(a,{x:0,y:0}),!0},zoomTo:function(b,d){var e,f;e=b/c,a.scale({x:e,y:e},d),f={x:a.tx,y:a.ty},c=b;var g=layer.list(),h=layer.list().length-1;do{var i=g[h].shapes.list(),j=i.length-1;do i[j].scaleTo(b),i[j].moveTo(f);while(j--)}while(h--);return layer.update(),!0},moveTo:function(){return!0},center:{get position(){return d},add:function(){return!0},reset:function(){return!0}},get bounds(){return f},get size(){return g},reset:function(){return a.reset(),zoom=1,f.height=b.clientHeight,f.width=b.clientWidth,d.x=b.clientWidth/2,d.y=b.clientHeight/2,g.height=b.clientHeight,g.width=b.clientWidth,!0}}}()}b.initialize=c,b.canvas=g}),b("utility/types",["require","exports"],function(a,b){var c={uuid:function(a,b){var c,d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),e=[];if(b=b||d.length,a)for(c=0;a>c;c++)e[c]=d[0|Math.random()*b];else{var f;for(e[8]=e[13]=e[18]=e[23]="-",e[14]="4",c=0;36>c;c++)e[c]||(f=0|16*Math.random(),e[c]=d[19==c?3&f|8:f])}return e.join("").toLowerCase()},parseFloat:function(a,b){return Number(parseFloat(a).toFixed(b))}},d={format:function(a,b){return a.replace(/{(\d+)}/g,function(a,c){return"undefined"!=typeof b[c]?b[c]:a})},contains:function(){return-1!==String.prototype.indexOf.apply(this,arguments)}},e={mousePosition:function(a,b,c){var d=a.getBoundingClientRect();return b=(b-d.left)*(a.clientWidth/d.width),c=(c-d.top)*(a.clientHeight/d.height),c=-1*(c-a.clientHeight),{x:b,y:c}
},canvasPosition:function(a,b,c){var d=a.getBoundingClientRect();return b=(b-d.left)*(a.clientWidth/d.width),c=(c-d.top)*(a.clientHeight/d.height),{x:b,y:c}}},f={dictionary:function(){function a(){this.store=[]}return a.prototype={add:function(a,b){this.store[a]=b},find:function(a){return this.store[a]},remove:function(a){delete this.store[a]},count:function(){return Object.keys(this.store).length},clear:function(){return this.store=new Array},list:function(){var a=this;return Object.keys(this.store).map(function(b){return a.store[b]})}},a.create=function(){return new a},a}(),list:function(){function a(){this.store=[],this.size=0,this.position=0}return a.prototype={add:function(a){this.store[this.size++]=a},find:function(a){for(var b=0;b<this.store.length;++b)if(this.store[b]==a)return b;return-1},remove:function(a){var b=this.find(a);return b>-1?(this.store.splice(b,1),--this.size,!0):!1},contains:function(a){for(var b=0;b<this.store.length;++b)if(this.store[b]==a)return!0;return!1},length:function(){return this.size},clear:function(){delete this.store,this.store=[],this.size=this.position=0},list:function(){return this.store},first:function(){this.position=0},last:function(){this.position=this.size-1},previous:function(){this.position>0&&--this.position},next:function(){this.position<this.size-1&&++this.position},currentPosition:function(){return this.position},moveTo:function(a){this.position=a},getElement:function(){return this.store[this.position]}},a.create=function(){return new a},a}()},g={inherits:function(a,b){return a.prototype=new b,a},extend:function(a,b){for(var c in b){var d=Object.getOwnPropertyDescriptor(b,c);d?Object.defineProperty(a,c,d):a[c]=b[c]}return a},merge:function(a,b){for(var c in b)a.hasOwnProperty[c]||(a[c]=b[c]);return a},restrict:function(a,b){for(var c in a)c in b||delete a[c];return a},subtract:function(a,b){for(var c in b)delete a[c];return a},union:function(a,b){return g.extend(g.extend({},a),b)},intersection:function(a,b){return g.restrict(g.extend({},a),b)},keys:function(a){if("object"!=typeof a)throw typeError();var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},event:function(){function a(){this.listeners={}}return a.prototype.listen=function(a,b){(this.listeners[a]=this.listeners[a]||[]).push(b)},a.prototype.notify=function(a,b){if(void 0!==this.listeners[a])for(var c in this.listeners[a])this.listeners[a][c].call(this,b)},a.prototype.unListen=function(a,b){if(void 0!==this.listeners[a]){var c=this.listeners[a].indexOf(b);-1!==c&&this.listeners[a].splice(c,1)}},a.create=function(){return new a},a}()};b.math=c,b.string=d,b.graphic=e,b.data=f,b.object=g}),a.plane=c("plane")}(window);