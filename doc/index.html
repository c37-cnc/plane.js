<!doctype html>
<html>

    <head>
        <meta charset="utf-8">

        <title>Plane</title>

        <style>
            /* html structure */

            html,
            body {
                height: 100%;
                margin: 0px;
                padding: 0px;
            }
            /* html structure */
            /* application structure */

            div[id="viewPort"] {
                position: absolute;
                top: 0px;
                left: 0px;
                right: 200px;
                bottom: 0px;
                background-color: rgb(255, 255, 255);
            }

            div[id="right"] {
                position: absolute;
                top: 0px;
                right: 0px;
                bottom: 0px;
                width: 200px;
                background-color: rgb(244, 233, 233);
            }
            /* application structure */
        </style>

        <script src="../lib/module.js"></script>
        <script src="../lib/utility.js"></script>
        <script src="../dist/plane.js"></script>

        <script>
            window.onload = function () {
                var viewPort = document.getElementById("viewPort");

                // plane - initialize
                plane.initialize({
                    viewPort: viewPort
                });
                // plane - initialize

                plane.shape.create({
                    type: 'arc',
                    center: [701.4343434, 250.4343434],
                    //center: [701, 250],
                    radius: 1,
                    startAngle: 90,
                    endAngle: 270
                });
//                plane.shape.create({
//                    type: 'arc',
//                    center: [1200, 300],
//                    radius: 30,
//                    startAngle: 360,
//                    endAngle: 90
//                });

                plane.shape.create({
                    type: 'bezier-cubic',
                    points: [[60, 190], [80, 10], [500, 10], [520, 190]]
                });

                var shapes = [];

                shapes.push(plane.shape.create({
                    type: 'bezier-quadratic',
                    points: [[700, 100], [860, 0], [1000, 100]]
                }));

                plane.shape.create({
                    type: 'circle',
                    center: [1200, 100],
                    radius: 50
                });

                plane.shape.create({
                    type: 'ellipse',
                    center: [400, 300],
                    radiusY: 50,
                    radiusX: 100
                });

                plane.shape.create({
                    type: 'line',
                    from: [150, 450],
                    to: [600, 450]
                });
                plane.shape.create({
                    type: 'line',
                    from: [50, 50],
                    to: [50, 320],
                    style: {
                        lineColor: 'rgb(32, 184, 96)',
                        lineDash: true
                    }
                });

                plane.shape.create({
                    type: 'polygon',
                    center: [900, 400],
                    radius: 70,
                    sides: 5
                });

                plane.shape.create({
                    type: 'polyline',
                    points: [[700, 100], [860, 0], [1000, 100]]
                });
                plane.shape.create({
                    type: 'polyline',
                    points: [[60, 190], [80, 10], [500, 10], [520, 190]]
                });

                plane.shape.create({
                    type: 'rectangle',
                    from: [0, 0],
                    to: [viewPort.clientWidth, viewPort.clientHeight]
                });
                plane.shape.create({
                    type: 'rectangle',
                    from: [1350, 100],
                    to: [1550, 300]
                });

                plane.shape.create({
                    type: 'spline',
                    degree: 3,
                    knots: [0, 0, 0, 0, 1, 2, 3, 4, 4, 4, 4],
                    points: [
                        [1099.987144430972, 649.9876187248264],
                        [1110.097044818745, 670.0304621818222],
                        [1120.20695803644, 649.9876187248264],
                        [1129.990734674595, 692.028699594638],
                        [1140.426771641907, 650.1505693076124],
                        [1149.884424530442, 669.7045610162513],
                        [1159.668201168597, 650.3135198903983]
                    ]
                });
                plane.shape.create({
                    type: 'polyline',
                    points: [
                        [1099.987144430972, 649.9876187248264],
                        [1110.097044818745, 670.0304621818222],
                        [1120.20695803644, 649.9876187248264],
                        [1129.990734674595, 692.028699594638],
                        [1140.426771641907, 650.1505693076124],
                        [1149.884424530442, 669.7045610162513],
                        [1159.668201168597, 650.3135198903983]
                    ]
                });


//                plane.shape.create({
//                    type: 'line',
//                    from: [50, 50],
//                    to: [300, 720],
//                    style: {
//                        lineColor: 'rgb(32, 184, 96)',
//                        lineDash: true
//                    }
//                });
//                plane.shape.create({
//                    type: 'text',
//                    from: [50, 50],
//                    to: [300, 720],
//                    size: 25,
//                    value: 'Andréa Fabiana de Oliveira Maciel'
//                });

                var shapeText = plane.shape.create({
                    type: 'text',
                    from: [50, 850],
                    //to: [300, 850],
                    to: [300, 720],
                    size: 35,
                    value: 'Andréa Fabiana de Oliveira Maciel'
                });
                plane.shape.create({
                    type: 'line',
                    from: [50, 850],
                    to: [300, 850],
                    //to: [300, 720],
                    style: {
                        lineColor: 'rgb(32, 184, 96)',
                        lineDash: true
                    }
                });

                plane.shape.create({
                    type: 'line',
                    from: [226, 602],
                    to: [800, 502]
                });
                plane.shape.create({
                    type: 'quote',
                    from: [226, 602],
                    to: [800, 502],
                    height: 20
                });

                plane.shape.create({
                    type: 'line',
                    from: [100, 50],
                    to: [100, 500]
                });
                plane.shape.create({
                    type: 'quote',
                    from: [100, 50],
                    to: [100, 500],
                    height: -15
                });


                shapes.push(plane.shape.create({
                    type: 'line',
                    from: [130, 900],
                    to: [200, 900]
                }));
                plane.shape.create({
                    type: 'quote',
                    from: [130, 900],
                    to: [200, 900],
                    height: 15
                });


                shapes.push(plane.shape.create({
                    type: 'line',
                    from: [130, 870],
                    to: [230, 870]
                }));
                plane.shape.create({
                    type: 'quote',
                    from: [130, 870],
                    to: [230, 870],
                    height: 15
                });


                var group = plane.group.create(shapes);

                console.log(group);

                plane.shape.create({
                    type: 'polyline',
                    points: [group.bounds.bottomLeft, group.bounds.topLeft, group.bounds.topRight, group.bounds.bottomRight, group.bounds.bottomLeft],
                    style: {
                        lineColor: '#666699',
                        lineDash: true
                    }
                });

                group.children.forEach(function (shape) {
                    shape.style = {
                        lineColor: '#666699',
                        lineDash: true
                    }
                });



                plane.view.update();


                var toolZoomWheel = plane.tool.create({
                    active: true
                });
                toolZoomWheel.events.listen('onMouseWheel', function (event) {

                    var position = event.point,
                        zoomNew = event.delta < 0 ? plane.view.zoom / .83 : plane.view.zoom * .83,
                        zoomFactor = plane.view.zoom / zoomNew;

                    var centerFactor = position.subtract(plane.view.center);
                    var centerSum = position.subtract(centerFactor.multiply(zoomFactor)).subtract(plane.view.center);
                    var centerNew = plane.view.center.sum(centerSum);

                    plane.view.zoomTo(zoomNew, centerNew);

//                    console.log('nº de shapes - ' + plane.shape.search({
//                        type: 'inView'
//                    }).length);

//                    console.log(shapeText.fromSnap(pointCheck, 3));


                });

                document.getElementById('inputFileManager').addEventListener('change', function () {

                    var file = this.files[0],
                        filename = file.name;

                    var lastDotPosition = filename.lastIndexOf('.'),
                        bareFilename = filename.substr(0, lastDotPosition),
                        fileExtension = filename.substr(lastDotPosition + 1).toLowerCase();

                    var reader = new FileReader();
                    reader.onload = function (event) {

                        var fileData = event.target.result;

                        switch (fileExtension) {
                            case 'dxf':
                                plane.importer.fromDxf(fileData);
                                break;
                            case 'json':
                                plane.importer.fromJson(fileData);
                                break;
                            default:
                                return;
                        }
                        plane.view.update();
                    };
                    reader.readAsText(file);

                    this.value = '';
                });

                document.getElementById('buttonExportJson').addEventListener('click', function (event) {
                    console.log(plane.exporter.toJson());
                });

                document.getElementById('buttonExportObject').addEventListener('click', function (event) {
                    console.log(plane.exporter.toObject());
                });

            };
        </script>

    </head>

    <body>
        <div id="viewPort">

        </div>
        <div id="right">
            <div id="toolsPanel">
                <input id="inputFileManager" type="file" style="width:190px"></input>
                <br>
                <br>
                <button id="buttonExportJson">Export Json</button>
                <button id="buttonExportObject">Export Object</button>
            </div>
        </div>
    </body>

</html>